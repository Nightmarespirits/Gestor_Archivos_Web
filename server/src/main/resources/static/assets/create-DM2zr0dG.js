import{aw as D,a as L,r as u,A as F,aF as h,o as N,b as k,c as P,w as t,V as j,d as B,e as l,f as M,g as $,y as O,G as y,h as g,j as G,aq as Y,C as r,D as U,E as w}from"./index-DTzO7a71.js";import{u as z}from"./inventarios-mEqQ-Uto.js";import{V as H}from"./VForm-Cr0IhdhJ.js";import{V as s,a as n}from"./VRow-DteDp9R7.js";import{V as A}from"./VDatePicker-CEVfHtFV.js";import{V as J}from"./VTextarea-BbRLHrOO.js";import"./VSheet-D3msx1cx.js";const le={__name:"create",setup(K){const q=z(),f=D(),x=L(),E=k(),i=u({show:!1,text:"",color:"success",timeout:3e3}),c=u(!1),v=u(!1),V=u(!1),p=u(!1),b=u(!1),S=F(()=>o.fechaTransferencia?new Date(o.fechaTransferencia).toLocaleDateString():""),I=F(()=>o.fechaInicial?new Date(o.fechaInicial).toLocaleDateString():""),R=F(()=>o.fechaFinal?new Date(o.fechaFinal).toLocaleDateString():""),T=u(null);u(!1),u(!1),N(()=>{x.hasPermission("DOCUMENT_UPDATE")||(i.value.show=!0,i.value.text="No tienes permiso para crear inventarios",i.value.color="error",E.push({name:"inventario-list"})),f.user&&(o.responsable=`${f.user.nombre} ${f.user.apellido}`,o.cargoResponsable=f.user.cargo||""),o.anio=new Date().getFullYear()});const o=h({titulo:"",unidadAdministrativa:"",numeroAnioRemision:"",seccion:"",fechaTransferencia:null,totalVolumen:0,lugarFechaEntrega:"",lugarFechaRecepcion:"",firmaSelloAutoridadEntrega:"",firmaSelloAutoridadRecibe:"",fechaInicial:null,fechaFinal:null,estadoConservacion:"",observaciones:"",estado:"BORRADOR",documentoIds:[],detalles:[]});async function C(){if(T.value.validate())try{c.value=!0;const m=await q.createInventario(o);m&&m.id?(i.value.show=!0,i.value.text="Inventario creado correctamente",i.value.color="success",E.push({name:"inventario-edit",params:{id:m.id}})):(i.value.show=!0,i.value.text="Error al crear el inventario",i.value.color="error")}catch(m){i.value.show=!0,i.value.text="Error: "+(m.message||"No se pudo crear el inventario"),i.value.color="error",console.error("Error al crear inventario:",m)}finally{c.value=!1}}return(m,e)=>(B(),P(j,{fluid:""},{default:t(()=>[l(M,null,{default:t(()=>[l($,{class:"d-flex justify-space-between align-center"},{default:t(()=>[e[25]||(e[25]=O("span",null,"Crear Nuevo Inventario",-1)),l(y,{color:"secondary","prepend-icon":"mdi-arrow-left",to:{name:"inventario-list"}},{default:t(()=>e[24]||(e[24]=[g(" Volver ")])),_:1})]),_:1}),l(G,null,{default:t(()=>[l(H,{ref_key:"form",ref:T,modelValue:v.value,"onUpdate:modelValue":e[23]||(e[23]=a=>v.value=a),onSubmit:Y(C,["prevent"])},{default:t(()=>[l(s,null,{default:t(()=>[l(n,{cols:"12",sm:"6"},{default:t(()=>[l(r,{modelValue:o.titulo,"onUpdate:modelValue":e[0]||(e[0]=a=>o.titulo=a),label:"Título del inventario",rules:[a=>!!a||"El título es requerido"],required:"",variant:"outlined",density:"comfortable"},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"12",sm:"6"},{default:t(()=>[l(r,{modelValue:o.unidadAdministrativa,"onUpdate:modelValue":e[1]||(e[1]=a=>o.unidadAdministrativa=a),label:"Unidad Administrativa",rules:[a=>!!a||"La unidad administrativa es requerida"],required:"",variant:"outlined",density:"comfortable"},null,8,["modelValue","rules"])]),_:1})]),_:1}),l(s,null,{default:t(()=>[l(n,{cols:"12",sm:"6"},{default:t(()=>[l(r,{modelValue:o.numeroAnioRemision,"onUpdate:modelValue":e[2]||(e[2]=a=>o.numeroAnioRemision=a),label:"Número y Año de Remisión",hint:"Formato: Número-Año","persistent-hint":"",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1}),l(n,{cols:"12",sm:"6"},{default:t(()=>[l(r,{modelValue:o.seccion,"onUpdate:modelValue":e[3]||(e[3]=a=>o.seccion=a),label:"Sección",hint:"Sección a la que pertenece el inventario","persistent-hint":"",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1})]),_:1}),l(s,null,{default:t(()=>[l(n,{cols:"12",sm:"6"},{default:t(()=>[l(U,{modelValue:V.value,"onUpdate:modelValue":e[7]||(e[7]=a=>V.value=a),"close-on-content-click":!1,transition:"scale-transition","min-width":"auto"},{activator:t(({props:a})=>[l(r,w({modelValue:S.value,"onUpdate:modelValue":e[4]||(e[4]=d=>S.value=d),label:"Fecha de Transferencia","prepend-icon":"mdi-calendar",readonly:""},a,{variant:"outlined",density:"comfortable"}),null,16,["modelValue"])]),default:t(()=>[l(A,{modelValue:o.fechaTransferencia,"onUpdate:modelValue":[e[5]||(e[5]=a=>o.fechaTransferencia=a),e[6]||(e[6]=a=>V.value=!1)]},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(n,{cols:"12",sm:"6"},{default:t(()=>[l(r,{modelValue:o.totalVolumen,"onUpdate:modelValue":e[8]||(e[8]=a=>o.totalVolumen=a),modelModifiers:{number:!0},label:"Volumen Total (m3)",type:"number",step:"0.01",variant:"outlined",density:"comfortable",rules:[a=>a!==null||"El volumen total es requerido",a=>a>=0||"El volumen debe ser un número positivo"],required:""},null,8,["modelValue","rules"])]),_:1})]),_:1}),l(s,null,{default:t(()=>[l(n,{cols:"12",sm:"6"},{default:t(()=>[l(U,{modelValue:p.value,"onUpdate:modelValue":e[12]||(e[12]=a=>p.value=a),"close-on-content-click":!1,transition:"scale-transition","min-width":"auto"},{activator:t(({props:a})=>[l(r,w({modelValue:I.value,"onUpdate:modelValue":e[9]||(e[9]=d=>I.value=d),label:"Fecha Inicial","prepend-icon":"mdi-calendar",readonly:"",variant:"outlined",density:"comfortable"},a,{rules:[d=>!!o.fechaInicial||"La fecha inicial es requerida"],required:""}),null,16,["modelValue","rules"])]),default:t(()=>[l(A,{modelValue:o.fechaInicial,"onUpdate:modelValue":[e[10]||(e[10]=a=>o.fechaInicial=a),e[11]||(e[11]=a=>p.value=!1)]},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(n,{cols:"12",sm:"6"},{default:t(()=>[l(U,{modelValue:b.value,"onUpdate:modelValue":e[16]||(e[16]=a=>b.value=a),"close-on-content-click":!1,transition:"scale-transition","min-width":"auto"},{activator:t(({props:a})=>[l(r,w({modelValue:R.value,"onUpdate:modelValue":e[13]||(e[13]=d=>R.value=d),label:"Fecha Final","prepend-icon":"mdi-calendar",readonly:"",variant:"outlined",density:"comfortable"},a,{rules:[d=>!!o.fechaFinal||"La fecha final es requerida",d=>!o.fechaInicial||o.fechaFinal>=o.fechaInicial||"La fecha final debe ser posterior a la fecha inicial"],required:""}),null,16,["modelValue","rules"])]),default:t(()=>[l(A,{modelValue:o.fechaFinal,"onUpdate:modelValue":[e[14]||(e[14]=a=>o.fechaFinal=a),e[15]||(e[15]=a=>b.value=!1)]},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(s,null,{default:t(()=>[l(n,{cols:"12",sm:"6"},{default:t(()=>[l(r,{modelValue:o.lugarFechaEntrega,"onUpdate:modelValue":e[17]||(e[17]=a=>o.lugarFechaEntrega=a),label:"Lugar y Fecha de Entrega",hint:"Ej: Lima, 01 de junio de 2023","persistent-hint":"",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1}),l(n,{cols:"12",sm:"6"},{default:t(()=>[l(r,{modelValue:o.lugarFechaRecepcion,"onUpdate:modelValue":e[18]||(e[18]=a=>o.lugarFechaRecepcion=a),label:"Lugar y Fecha de Recepción",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1})]),_:1}),l(s,null,{default:t(()=>[l(n,{cols:"12",sm:"6"},{default:t(()=>[l(r,{modelValue:o.firmaSelloAutoridadEntrega,"onUpdate:modelValue":e[19]||(e[19]=a=>o.firmaSelloAutoridadEntrega=a),label:"Firma/Sello de Autoridad que Entrega",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1}),l(n,{cols:"12",sm:"6"},{default:t(()=>[l(r,{modelValue:o.firmaSelloAutoridadRecibe,"onUpdate:modelValue":e[20]||(e[20]=a=>o.firmaSelloAutoridadRecibe=a),label:"Firma/Sello de Autoridad que Recibe",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1})]),_:1}),l(s,null,{default:t(()=>[l(n,{cols:"12",sm:"6"},{default:t(()=>[l(r,{modelValue:o.estadoConservacion,"onUpdate:modelValue":e[21]||(e[21]=a=>o.estadoConservacion=a),label:"Estado de Conservación",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1}),l(n,{cols:"12",sm:"6"},{default:t(()=>[l(J,{modelValue:o.observaciones,"onUpdate:modelValue":e[22]||(e[22]=a=>o.observaciones=a),label:"Observaciones",rows:"3","auto-grow":"",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1})]),_:1}),l(s,{class:"mt-4"},{default:t(()=>[l(n,{cols:"12",class:"d-flex justify-end"},{default:t(()=>[l(y,{color:"secondary",class:"mr-4",to:{name:"inventario-list"}},{default:t(()=>e[26]||(e[26]=[g(" Cancelar ")])),_:1}),l(y,{color:"primary",type:"submit",loading:c.value,disabled:!v.value},{default:t(()=>e[27]||(e[27]=[g(" Guardar Inventario ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{le as default};
