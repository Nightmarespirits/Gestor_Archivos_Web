import{_ as U,aw as x,r as m,A as k,o as S,k as _,e as o,w as r,I,b as R,d as q,f as E,g as A,y as T,G as c,i as $,h as d,j as B,aq as D,C as f,av as F,l as G,H as g,v as L}from"./index-DTzO7a71.js";import{u as M}from"./users-Dkic-ruu.js";import{V as b,a as n}from"./VRow-DteDp9R7.js";import{V as P}from"./VForm-Cr0IhdhJ.js";import{V as j}from"./VSelect-DrkOLv1H.js";import"./VChip-Bftqh3Dm.js";const H={__name:"create",setup(z){const i=M(),w=x(),C=R(),p=m(null),N=k(()=>!0),s=m({username:"",fullName:"",email:"",password:"",roleId:null}),v=m([]),t=m({show:!1,text:"",color:"success",timeout:3e3});S(async()=>{try{await y()}catch(l){u(`Error al cargar datos: ${l.message}`,"error")}});async function y(){try{console.log("Cargando roles disponibles...");const l=await i.fetchRoles();console.log("Roles cargados desde API:",l),v.value=l.map(e=>({...e,displayName:e.name.charAt(0).toUpperCase()+e.name.slice(1).toLowerCase()+(e.description?` - ${e.description}`:"")})),console.log("Roles procesados para mostrar:",v.value)}catch(l){console.error("Error al cargar roles:",l),u(`Error al cargar roles: ${l.message}`,"error")}}async function V(){try{if(!p.value)return;if(!(await p.value.validate()).valid)return u("Por favor completa correctamente todos los campos requeridos","warning");if(console.log("Creando usuario con datos:",s.value),!localStorage.getItem("authToken"))return u("No tienes una sesión válida, vuelve a iniciar sesión","error"),w.logout();await i.createUser(s.value),u("Usuario creado exitosamente","success"),C.push("/users")}catch(l){console.error("Error al crear usuario:",l),l.message&&l.message.includes("403")?u("No tienes permisos para crear usuarios. Contacta al administrador.","error"):u(`Error al crear usuario: ${l.message}`,"error")}}function u(l,e="success",a=3e3){t.value={show:!0,text:l,color:e,timeout:a}}return(l,e)=>(q(),_("div",null,[o(b,null,{default:r(()=>[o(n,{cols:"12"},{default:r(()=>[o(E,null,{default:r(()=>[o(A,{class:"d-flex align-center"},{default:r(()=>[o(c,{icon:"",class:"mr-4",to:"/users"},{default:r(()=>[o($,null,{default:r(()=>e[7]||(e[7]=[d("mdi-arrow-left")])),_:1})]),_:1}),e[8]||(e[8]=T("span",{class:"text-h5"},"Crear Nuevo Usuario",-1))]),_:1}),o(B,null,{default:r(()=>[o(P,{ref_key:"form",ref:p,onSubmit:D(V,["prevent"])},{default:r(()=>[o(b,null,{default:r(()=>[o(n,{cols:"12",md:"6"},{default:r(()=>[o(f,{modelValue:s.value.username,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value.username=a),label:"Nombre de Usuario",rules:[a=>!!a||"Nombre de usuario es obligatorio"],required:"",autocomplete:"off"},null,8,["modelValue","rules"])]),_:1}),o(n,{cols:"12",md:"6"},{default:r(()=>[o(f,{modelValue:s.value.fullName,"onUpdate:modelValue":e[1]||(e[1]=a=>s.value.fullName=a),label:"Nombre Completo",rules:[a=>!!a||"Nombre completo es obligatorio"],required:""},null,8,["modelValue","rules"])]),_:1}),o(n,{cols:"12",md:"6"},{default:r(()=>[o(f,{modelValue:s.value.email,"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.email=a),label:"Correo Electrónico",type:"email",rules:[a=>!!a||"Correo electrónico es obligatorio",a=>/.+@.+\..+/.test(a)||"Correo electrónico debe ser válido"],required:""},null,8,["modelValue","rules"])]),_:1}),o(n,{cols:"12",md:"6"},{default:r(()=>[o(f,{modelValue:s.value.password,"onUpdate:modelValue":e[3]||(e[3]=a=>s.value.password=a),label:"Contraseña",type:"password",rules:[a=>!!a||"Contraseña es obligatoria",a=>a.length>=6||"La contraseña debe tener al menos 6 caracteres"],required:"",autocomplete:"new-password"},null,8,["modelValue","rules"])]),_:1}),o(n,{cols:"12",md:"6"},{default:r(()=>[o(j,{modelValue:s.value.roleId,"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.roleId=a),items:v.value,"item-title":"displayName","item-value":"id",label:"Rol",rules:[a=>!!a||"Rol es obligatorio"],required:""},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),o(F,null,{default:r(()=>[o(G),o(c,{color:"error",variant:"outlined",to:"/users"},{default:r(()=>e[9]||(e[9]=[d(" Cancelar ")])),_:1}),o(c,{color:"primary",onClick:V,loading:g(i).loading,disabled:!N.value||g(i).loading},{default:r(()=>e[10]||(e[10]=[d(" Guardar Usuario ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),o(I,{modelValue:t.value.show,"onUpdate:modelValue":e[6]||(e[6]=a=>t.value.show=a),color:t.value.color,timeout:t.value.timeout},{actions:r(()=>[o(c,{variant:"text",onClick:e[5]||(e[5]=a=>t.value.show=!1)},{default:r(()=>e[11]||(e[11]=[d(" Cerrar ")])),_:1})]),default:r(()=>[d(L(t.value.text)+" ",1)]),_:1},8,["modelValue","color","timeout"])]))}},Y=U(H,[["__scopeId","data-v-263c56c2"]]);export{Y as default};
