import{J as Z,r as A,u as _,bb as B,K as p}from"./index-DTzO7a71.js";const K=Z("inventarios",()=>{const r=A([]),s=A(null),i=A(!1),g=A(null),w=_(),D=A(["BORRADOR","FINALIZADO","APROBADO"]),$=(t,e)=>e==="pdf"?`${B}/inventarios/general/${t}/pdf`:e==="excel"?`${B}/inventarios/general/${t}/excel`:`${B}/inventarios/general/${t}/download`,S=()=>r.value||[],T=()=>s.value;function b(){return i.value}function z(){return g.value}function N(){return D.value}function L(t){switch(t){case"BORRADOR":return"grey";case"FINALIZADO":return"blue";case"APROBADO":default:return"green"}}const o=A({page:0,size:10,totalItems:0,totalPages:0}),d=A({sortBy:"id",direction:"desc"});async function O(){try{i.value=!0;const t=await p.get("/inventarios/general",{debug:!0});return r.value=Array.isArray(t)?t:[],console.log("fetchInventarios result:",r.value),{items:r.value}}catch(t){return g.value=t.message,console.error("fetchInventarios Error:",t),r.value=[],{items:[]}}finally{i.value=!1}}async function x(t={}){try{i.value=!0;const{page:e=o.value.page,size:n=o.value.size,sortBy:f=d.value.sortBy,direction:l=d.value.direction,filters:y={}}=t;o.value.page=e,o.value.size=n,d.value.sortBy=f,d.value.direction=l;const a=await p.get("/inventarios/general",{params:{page:e,size:n,sortBy:f,sortDirection:l,...y},debug:!0});let c=[],I=0,m=0;return Array.isArray(a)?(c=a,I=a.length,m=1):a&&typeof a=="object"&&(Array.isArray(a.content)?(c=a.content,I=a.totalElements||a.content.length,m=a.totalPages||1):(c=Array.isArray(a.items)?a.items:[],I=a.totalItems||c.length,m=a.totalPages||1)),console.log("fetchPaginatedInventarios content:",c),r.value=c,o.value.totalItems=I,o.value.totalPages=m,{items:r.value,pagination:{...o.value}}}catch(e){return g.value=e.message,console.error("fetchPaginatedInventarios Error:",e),r.value=[],{items:[],pagination:{...o.value,totalItems:0,totalPages:0}}}finally{i.value=!1}}async function F(t={},e={}){try{i.value=!0;const{titulo:n,unidadAdministrativa:f,fechaInicio:l,fechaFin:y,estado:a}=t,{page:c=o.value.page,size:I=o.value.size,sortBy:m=d.value.sortBy,direction:j=d.value.direction}=e,v={};n&&(v.titulo=n),f&&(v.unidadAdministrativa=f),l&&(v.fechaInicio=l),y&&(v.fechaFin=y),a&&(v.estado=a),v.page=c,v.size=I,v.sortBy=m,v.sortDirection=j,console.log("Searching with params:",v);const u=await p.get("/inventarios/general",{params:v,debug:!0});let h=[],E=0,P=0;return Array.isArray(u)?(h=u,E=u.length,P=1):u&&typeof u=="object"?Array.isArray(u.content)?(h=u.content,E=u.totalElements||u.content.length,P=u.totalPages||1):Array.isArray(u)?(h=u,E=h.length,P=1):(h=[],E=0,P=0,console.error("Formato de respuesta desconocido:",u)):console.error("Respuesta vacía o no válida"),r.value=h,o.value.page=c,o.value.size=I,o.value.totalItems=E,o.value.totalPages=P,{items:r.value,pagination:{...o.value}}}catch(n){return g.value=n.message,console.error("searchInventariosPaginated Error:",n),r.value=[],{items:[],pagination:{...o.value,totalItems:0,totalPages:0}}}finally{i.value=!1}}async function R(t){try{i.value=!0;const e=await p.get(`/inventarios/general/${t}`);return s.value=e,e}catch(e){return g.value=e.message,console.error("fetchInventarioById Error:",e),null}finally{i.value=!1}}async function C(t){try{i.value=!0;const e=await p.post("/inventarios/general",t);return e&&e.id&&(await O(),await w.logActivity({action:"CREATE",entityType:"INVENTARIO",entityId:e.id,details:`Inventario "${e.titulo}" creado`})),e}catch(e){throw g.value=e.message,console.error("createInventario Error:",e),e}finally{i.value=!1}}async function U(t,e){try{i.value=!0;const n=s.value||await R(t),f=n?n.estado:null,l=await p.put(`/inventarios/general/${t}`,e);if(l){s.value&&s.value.id===t&&(s.value=l);const y=r.value.findIndex(c=>c.id===t);y!==-1&&(r.value[y]=l);let a=`Inventario "${l.titulo}" actualizado`;f&&l.estado&&f!==l.estado&&(a+=`. Estado cambiado de ${f} a ${l.estado}`),await w.logActivity({action:"UPDATE",entityType:"INVENTARIO",entityId:t,details:a})}return l}catch(n){throw g.value=n.message,console.error("updateInventario Error:",n),n}finally{i.value=!1}}async function V(t){try{i.value=!0;const e=r.value.find(n=>n.id===t)||(s.value&&s.value.id===t?s.value:null);return await p.delete(`/inventarios/general/${t}`),r.value=r.value.filter(n=>n.id!==t),s.value&&s.value.id===t&&(s.value=null),e&&await w.logActivity({action:"DELETE",entityType:"INVENTARIO",entityId:t,details:`Inventario "${e.titulo}" eliminado`}),!0}catch(e){return g.value=e.message,console.error("deleteInventario Error:",e),!1}finally{i.value=!1}}return{inventarios:r,currentInventario:s,loading:i,error:g,pagination:o,sortOptions:d,inventarioStates:D,getInventarios:S,getCurrentInventario:T,isLoading:b,getError:z,getInventarioStates:N,getInventarioStateColor:L,fetchInventarios:O,fetchPaginatedInventarios:x,searchInventariosPaginated:F,fetchInventarioById:R,createInventario:C,updateInventario:U,deleteInventario:V,getInventarioDownloadUrl:$}});export{K as u};
