import{_ as S,aw as _,r as d,A as $,o as D,aU as R,b as A,k as U,e as l,w as r,I as B,d as V,f as T,g as j,y as N,G as p,i as q,h as f,j as z,c as L,m as P,aq as F,C as v,as as M,av as G,l as H,H as x,v as J}from"./index-DTzO7a71.js";import{u as K}from"./users-Dkic-ruu.js";import{V as b,a as i}from"./VRow-DteDp9R7.js";import{V as O}from"./VForm-Cr0IhdhJ.js";import{V as Q}from"./VSelect-DrkOLv1H.js";import{V as W}from"./VSwitch-DBlCe_KO.js";import"./VChip-Bftqh3Dm.js";const X={key:0,class:"d-flex justify-center align-center",style:{"min-height":"300px"}},Y={__name:"edit",setup(Z){const m=K();_();const w=A(),E=R(),y=d(null),I=$(()=>!0),n=d(!0),s=d({id:null,username:"",fullName:"",email:"",status:!0,roleId:null}),c=d(""),g=d([]),t=d({show:!1,text:"",color:"success",timeout:3e3});D(async()=>{try{const o=E.params.id;await k(),await h(o)}catch(o){u(`Error al cargar datos: ${o.message}`,"error"),setTimeout(()=>w.push("/users"),2e3)}finally{n.value=!1}});async function k(){try{const o=await m.fetchRoles();g.value=o.map(e=>({...e,displayName:e.name.charAt(0).toUpperCase()+e.name.slice(1).toLowerCase()+(e.description?` - ${e.description}`:"")}))}catch(o){console.error("Error al cargar roles:",o),u(`Error al cargar roles: ${o.message}`,"error")}}async function h(o){try{const e=await m.fetchUserById(o);if(!e)throw new Error("No se encontró el usuario");let a=null;e.role?typeof e.role=="object"?a=e.role.id:typeof e.role=="number"&&(a=e.role):e.roleId&&(a=e.roleId),s.value={id:e.id,username:e.username||"",fullName:e.fullName||"",email:e.email||"",status:e.status!==void 0?e.status:!0,roleId:a}}catch(e){throw console.error(`Error al cargar usuario con ID ${o}:`,e),u(`Error al cargar usuario: ${e.message}`,"error"),e}}async function C(){try{const{valid:o}=await y.value.validate();if(!o){u("Por favor, corrige los errores en el formulario","error");return}const e={fullName:s.value.fullName,email:s.value.email,status:s.value.status,roleId:s.value.roleId};c.value&&(e.password=c.value),n.value=!0;try{const a=await m.updateUser(s.value.id,e);u("Usuario actualizado exitosamente","success"),setTimeout(()=>{w.push("/users")},1500)}catch(a){u(`Error al actualizar usuario: ${a.message||"Error desconocido"}`,"error")}finally{n.value=!1}}catch(o){u(`Error al actualizar usuario: ${o.message||"Error desconocido"}`,"error"),n.value=!1}}function u(o,e="success",a=3e3){t.value={show:!0,text:o,color:e,timeout:a}}return(o,e)=>(V(),U("div",null,[l(b,null,{default:r(()=>[l(i,{cols:"12"},{default:r(()=>[l(T,null,{default:r(()=>[l(j,{class:"d-flex align-center"},{default:r(()=>[l(p,{icon:"",class:"mr-4",to:"/users"},{default:r(()=>[l(q,null,{default:r(()=>e[8]||(e[8]=[f("mdi-arrow-left")])),_:1})]),_:1}),e[9]||(e[9]=N("span",{class:"text-h5"},"Editar Usuario",-1))]),_:1}),l(z,null,{default:r(()=>[n.value?(V(),U("div",X,[l(P,{indeterminate:"",color:"primary"})])):(V(),L(O,{key:1,ref_key:"form",ref:y,onSubmit:F(C,["prevent"])},{default:r(()=>[l(b,null,{default:r(()=>[l(i,{cols:"12",md:"6"},{default:r(()=>[l(v,{modelValue:s.value.username,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value.username=a),label:"Nombre de Usuario",disabled:"",hint:"El nombre de usuario no puede ser modificado","persistent-hint":""},null,8,["modelValue"])]),_:1}),l(i,{cols:"12",md:"6"},{default:r(()=>[l(v,{modelValue:s.value.fullName,"onUpdate:modelValue":e[1]||(e[1]=a=>s.value.fullName=a),label:"Nombre Completo",rules:[a=>!!a||"Nombre completo es obligatorio"],required:""},null,8,["modelValue","rules"])]),_:1}),l(i,{cols:"12",md:"6"},{default:r(()=>[l(v,{modelValue:s.value.email,"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.email=a),label:"Correo Electrónico",type:"email",rules:[a=>!!a||"Correo electrónico es obligatorio",a=>/.+@.+\..+/.test(a)||"Correo electrónico debe ser válido"],required:""},null,8,["modelValue","rules"])]),_:1}),l(i,{cols:"12",md:"6"},{default:r(()=>[l(Q,{modelValue:s.value.roleId,"onUpdate:modelValue":e[3]||(e[3]=a=>s.value.roleId=a),items:g.value,"item-title":"displayName","item-value":"id",label:"Rol",rules:[a=>!!a||"Rol es obligatorio"],required:""},null,8,["modelValue","items","rules"])]),_:1}),l(i,{cols:"12",md:"6"},{default:r(()=>[l(W,{modelValue:s.value.status,"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.status=a),color:"success",label:"Estado: Activo/Inactivo",hint:"Los usuarios inactivos no pueden acceder al sistema","persistent-hint":""},null,8,["modelValue"])]),_:1})]),_:1}),l(M,{class:"my-6"}),l(b,null,{default:r(()=>[l(i,{cols:"12"},{default:r(()=>[e[10]||(e[10]=N("h3",{class:"text-h6 mb-4"},"Cambiar Contraseña (opcional)",-1)),l(v,{modelValue:c.value,"onUpdate:modelValue":e[5]||(e[5]=a=>c.value=a),label:"Nueva Contraseña",type:"password",autocomplete:"new-password",rules:[c.value?a=>a.length>=6||"La contraseña debe tener al menos 6 caracteres":()=>!0],hint:"Deja en blanco si no deseas cambiar la contraseña","persistent-hint":""},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512))]),_:1}),l(G,null,{default:r(()=>[l(H),l(p,{color:"error",variant:"outlined",to:"/users"},{default:r(()=>e[11]||(e[11]=[f(" Cancelar ")])),_:1}),l(p,{color:"primary",onClick:C,loading:x(m).loading,disabled:n.value||!I.value||x(m).loading},{default:r(()=>e[12]||(e[12]=[f(" Actualizar Usuario ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),l(B,{modelValue:t.value.show,"onUpdate:modelValue":e[7]||(e[7]=a=>t.value.show=a),color:t.value.color,timeout:t.value.timeout},{actions:r(()=>[l(p,{variant:"text",onClick:e[6]||(e[6]=a=>t.value.show=!1)},{default:r(()=>e[13]||(e[13]=[f(" Cerrar ")])),_:1})]),default:r(()=>[f(J(t.value.text)+" ",1)]),_:1},8,["modelValue","color","timeout"])]))}},ue=S(Y,[["__scopeId","data-v-7a8a980c"]]);export{ue as default};
