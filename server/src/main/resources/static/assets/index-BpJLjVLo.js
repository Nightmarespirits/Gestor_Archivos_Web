import{_ as re,r as s,a as se,o as ne,c as ie,w as o,V as ue,d as de,y as q,e as l,f as x,g as T,h as r,i as L,l as k,ao as h,v as U,j as C,C as R,av as _,G as f,E as j,I as ce}from"./index-DTzO7a71.js";import{_ as V}from"./PermissionButton-DANkCNxj.js";import{V as me,a as H}from"./VRow-DteDp9R7.js";import{V as J}from"./VForm-Cr0IhdhJ.js";import{V as K}from"./VTextarea-BbRLHrOO.js";import{V as Q}from"./VDataTable-BAdSe95_.js";import{V as pe}from"./VTooltip-ZPSecc-u.js";import"./VSelect-DrkOLv1H.js";import"./VChip-Bftqh3Dm.js";import"./VTable-Dw3FHTEb.js";import"./filter-C-DwuyMR.js";const ve={class:"text-h6"},fe={class:"text-h6"},ye={__name:"index",setup(ge){const w="/api",W=()=>{const a=localStorage.getItem("authToken");return a||console.warn("No se encontró token de autenticación"),a},b=(a=!0)=>{const e=W(),t={Authorization:e?`Bearer ${e}`:""};return a&&(t["Content-Type"]="application/json",t.Accept="application/json"),t},I=async a=>{if(!a.ok)try{const e=await a.json();throw{status:a.status,data:e}}catch{try{const t=await a.text();throw t.includes("<!DOCTYPE html>")?(console.error("Recibiendo HTML en lugar de JSON. Verificar URL de API:",w),{status:a.status,data:"Error de conexión con la API. Posible URL incorrecta."}):{status:a.status,data:t||a.statusText}}catch{throw{status:a.status,data:a.statusText}}}return a.json()},c={async get(a){try{const e=await fetch(`${w}${a}`,{headers:b(!1)});return I(e)}catch(e){throw console.error(`Error en GET ${a}:`,e),e}},async post(a,e){try{const t=await fetch(`${w}${a}`,{method:"POST",headers:b(),body:JSON.stringify(e)});return I(t)}catch(t){throw console.error(`Error en POST ${a}:`,t),t}},async put(a,e){try{const t=await fetch(`${w}${a}`,{method:"PUT",headers:b(),body:JSON.stringify(e)});return I(t)}catch(t){throw console.error(`Error en PUT ${a}:`,t),t}},async delete(a){try{const e=await fetch(`${w}${a}`,{method:"DELETE",headers:b()});return I(e)}catch(e){throw console.error(`Error en DELETE ${a}:`,e),e}}},p=s([]),v=s([]),y=s({tags:!1,types:!1}),S=s(!1),$=s(!1),E=s(!1),A=s(null),G=s(null),D=s(!1),N=s(!1),P={id:null,name:""},B={id:null,name:"",description:""},i=s({...P}),u=s({...B}),m=s(-1),F=s({type:"",item:null}),X=[{title:"ID",key:"id",width:"20%"},{title:"Nombre",key:"name",width:"60%"},{title:"Descripción",key:"description",width:"35%"},{title:"Acciones",key:"actions",width:"20%",sortable:!1}],Z=[{title:"ID",key:"id",width:"15%"},{title:"Nombre",key:"name",width:"35%"},{title:"Descripción",key:"description",width:"35%"},{title:"Acciones",key:"actions",width:"15%",sortable:!1}],g=s({show:!1,text:"",color:"success"});se();const z=a=>a==="tag"?m.value===-1?"Nueva Etiqueta":"Editar Etiqueta":m.value===-1?"Nuevo Tipo de Documento":"Editar Tipo de Documento";ne(async()=>{await ee(),await te()});const ee=async()=>{y.value.tags=!0;try{const a=await c.get("/tags");p.value=a}catch(a){console.error("Error al cargar etiquetas:",a),n("Error al cargar etiquetas","error")}finally{y.value.tags=!1}},te=async()=>{y.value.types=!0;try{const a=await c.get("/document-types");v.value=a}catch(a){console.error("Error al cargar tipos de documentos:",a),n("Error al cargar tipos de documentos","error")}finally{y.value.types=!1}},ae=async()=>{if(D.value)try{let a;m.value===-1?(a=await c.post("/tags",i.value),p.value.push(a),n("Etiqueta creada correctamente","success")):(a=await c.put(`/tags/${i.value.id}`,i.value),Object.assign(p.value[m.value],a),n("Etiqueta actualizada correctamente","success")),O("tag")}catch(a){console.error("Error al guardar etiqueta:",a),n(a.data||"Error al guardar etiqueta","error")}},le=async()=>{if(N.value)try{let a;m.value===-1?(a=await c.post("/document-types",u.value),v.value.push(a),n("Tipo de documento creado correctamente","success")):(a=await c.put(`/document-types/${u.value.id}`,u.value),Object.assign(v.value[m.value],a),n("Tipo de documento actualizado correctamente","success")),O("type")}catch(a){console.error("Error al guardar tipo de documento:",a),n(a.data||"Error al guardar tipo de documento","error")}},M=(a,e)=>{m.value=a==="tag"?p.value.findIndex(t=>t.id===e.id):v.value.findIndex(t=>t.id===e.id),a==="tag"?(i.value=Object.assign({},e),S.value=!0):(u.value=Object.assign({},e),$.value=!0)},Y=(a,e)=>{F.value={type:a,item:e},E.value=!0},oe=async()=>{try{const{type:a,item:e}=F.value;if(a==="tag"){await c.delete(`/tags/${e.id}`);const t=p.value.findIndex(d=>d.id===e.id);t!==-1&&p.value.splice(t,1),n("Etiqueta eliminada correctamente","success")}else{await c.delete(`/document-types/${e.id}`);const t=v.value.findIndex(d=>d.id===e.id);t!==-1&&v.value.splice(t,1),n("Tipo de documento eliminado correctamente","success")}}catch(a){console.error("Error al eliminar elemento:",a),n(a.data||"Error al eliminar elemento","error")}finally{E.value=!1,F.value={type:"",item:null}}},O=a=>{a==="tag"?(S.value=!1,i.value=Object.assign({},P)):($.value=!1,u.value=Object.assign({},B)),m.value=-1,setTimeout(()=>{var e,t;(e=A.value)==null||e.reset(),(t=G.value)==null||t.reset()},300)},n=(a,e="success")=>{g.value={show:!0,text:a,color:e}};return(a,e)=>(de(),ie(ue,null,{default:o(()=>[e[29]||(e[29]=q("h1",{class:"text-h4 mb-6"},"Gestión de Etiquetas y Tipos de Documentos",-1)),l(me,null,{default:o(()=>[l(H,{cols:"12",md:"6"},{default:o(()=>[l(x,null,{default:o(()=>[l(T,{class:"d-flex align-center"},{default:o(()=>[l(L,{class:"mr-2"},{default:o(()=>e[14]||(e[14]=[r("mdi-tag-multiple")])),_:1}),e[18]||(e[18]=r(" Etiquetas ")),l(k),l(h,{modelValue:S.value,"onUpdate:modelValue":e[4]||(e[4]=t=>S.value=t),"max-width":"500px"},{activator:o(({props:t})=>[l(V,j({permissions:["SYSTEM_CONFIG"],prependIcon:"mdi-plus",color:"primary"},t,{size:"small"}),{default:o(()=>e[15]||(e[15]=[r(" Nueva ")])),_:2},1040)]),default:o(()=>[l(x,null,{default:o(()=>[l(T,null,{default:o(()=>[q("span",ve,U(z("tag")),1)]),_:1}),l(C,null,{default:o(()=>[l(J,{ref_key:"tagForm",ref:A,modelValue:D.value,"onUpdate:modelValue":e[2]||(e[2]=t=>D.value=t)},{default:o(()=>[l(R,{modelValue:i.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>i.value.name=t),label:"Nombre de etiqueta",rules:[t=>!!t||"El nombre es requerido"],required:""},null,8,["modelValue","rules"]),l(K,{modelValue:i.value.description,"onUpdate:modelValue":e[1]||(e[1]=t=>i.value.description=t),label:"Descripción",rows:"3","auto-grow":""},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(_,null,{default:o(()=>[l(k),l(f,{color:"grey",variant:"text",onClick:e[3]||(e[3]=t=>O("tag"))},{default:o(()=>e[16]||(e[16]=[r(" Cancelar ")])),_:1}),l(f,{color:"primary",variant:"text",onClick:ae,disabled:!D.value},{default:o(()=>e[17]||(e[17]=[r(" Guardar ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(C,null,{default:o(()=>[l(Q,{headers:X,items:p.value,loading:y.value.tags,"items-per-page":10,class:"elevation-1"},{"item.actions":o(({item:t})=>[l(V,{permissions:["SYSTEM_CONFIG"],prependIcon:"mdi-pencil",iconButton:!0,color:"primary",size:"small",onClick:d=>M("tag",t),tooltip:"Editar",variant:"plain"},null,8,["onClick"]),l(V,{permissions:["SYSTEM_CONFIG"],prependIcon:"mdi-delete",iconButton:!0,color:"error",size:"small",onClick:d=>Y("tag",t),tooltip:"Eliminar",variant:"plain"},null,8,["onClick"])]),_:1},8,["items","loading"])]),_:1})]),_:1})]),_:1}),l(H,{cols:"12",md:"6"},{default:o(()=>[l(x,null,{default:o(()=>[l(T,{class:"d-flex align-center"},{default:o(()=>[l(L,{class:"mr-2"},{default:o(()=>e[19]||(e[19]=[r("mdi-file-document-outline")])),_:1}),e[23]||(e[23]=r(" Tipos de Documentos ")),l(k),l(h,{modelValue:$.value,"onUpdate:modelValue":e[9]||(e[9]=t=>$.value=t),"max-width":"500px"},{activator:o(({props:t})=>[l(V,j({permissions:["SYSTEM_CONFIG"],prependIcon:"mdi-plus",color:"primary"},t,{size:"small"}),{default:o(()=>e[20]||(e[20]=[r(" Nuevo ")])),_:2},1040)]),default:o(()=>[l(x,null,{default:o(()=>[l(T,null,{default:o(()=>[q("span",fe,U(z("type")),1)]),_:1}),l(C,null,{default:o(()=>[l(J,{ref_key:"typeForm",ref:G,modelValue:N.value,"onUpdate:modelValue":e[7]||(e[7]=t=>N.value=t)},{default:o(()=>[l(R,{modelValue:u.value.name,"onUpdate:modelValue":e[5]||(e[5]=t=>u.value.name=t),label:"Nombre del tipo",rules:[t=>!!t||"El nombre es requerido"],required:""},null,8,["modelValue","rules"]),l(K,{modelValue:u.value.description,"onUpdate:modelValue":e[6]||(e[6]=t=>u.value.description=t),label:"Descripción",rows:"3","auto-grow":""},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(_,null,{default:o(()=>[l(k),l(f,{color:"grey",variant:"text",onClick:e[8]||(e[8]=t=>O("type"))},{default:o(()=>e[21]||(e[21]=[r(" Cancelar ")])),_:1}),l(f,{color:"primary",variant:"text",onClick:le,disabled:!N.value},{default:o(()=>e[22]||(e[22]=[r(" Guardar ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(C,null,{default:o(()=>[l(Q,{headers:Z,items:v.value,loading:y.value.types,"items-per-page":10,class:"elevation-1"},{"item.description":o(({item:t})=>[l(pe,{location:"bottom",text:t.description},{activator:o(({props:d})=>[q("span",j(d,{class:"text-truncate d-inline-block",style:{"max-width":"200px"}}),U(t.description||"Sin descripción"),17)]),_:2},1032,["text"])]),"item.actions":o(({item:t})=>[l(V,{permissions:["SYSTEM_CONFIG"],prependIcon:"mdi-pencil",iconButton:!0,color:"primary",size:"small",onClick:d=>M("type",t),tooltip:"Editar",variant:"plain"},null,8,["onClick"]),l(V,{permissions:["SYSTEM_CONFIG"],prependIcon:"mdi-delete",iconButton:!0,color:"error",size:"small",onClick:d=>Y("type",t),tooltip:"Eliminar",variant:"plain"},null,8,["onClick"])]),_:1},8,["items","loading"])]),_:1})]),_:1})]),_:1})]),_:1}),l(h,{modelValue:E.value,"onUpdate:modelValue":e[11]||(e[11]=t=>E.value=t),"max-width":"400px"},{default:o(()=>[l(x,null,{default:o(()=>[l(T,{class:"text-h6"},{default:o(()=>e[24]||(e[24]=[r(" ¿Está seguro que desea eliminar este elemento? ")])),_:1}),l(C,null,{default:o(()=>e[25]||(e[25]=[r(" Esta acción no se puede revertir. ")])),_:1}),l(_,null,{default:o(()=>[l(k),l(f,{color:"grey",variant:"text",onClick:e[10]||(e[10]=t=>E.value=!1)},{default:o(()=>e[26]||(e[26]=[r("Cancelar")])),_:1}),l(f,{color:"error",variant:"text",onClick:oe},{default:o(()=>e[27]||(e[27]=[r("Confirmar")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(ce,{modelValue:g.value.show,"onUpdate:modelValue":e[13]||(e[13]=t=>g.value.show=t),color:g.value.color,timeout:"3000"},{actions:o(()=>[l(f,{variant:"text",onClick:e[12]||(e[12]=t=>g.value.show=!1)},{default:o(()=>e[28]||(e[28]=[r("Cerrar")])),_:1})]),default:o(()=>[r(U(g.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1}))}},De=re(ye,[["__scopeId","data-v-aee90ec6"]]);export{De as default};
