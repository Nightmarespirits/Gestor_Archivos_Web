import{L as M,M as N,a6 as te,aa as we,O as q,e as a,aI as ke,ac as Se,a4 as H,a0 as oe,ag as Te,aJ as Ie,ai as ne,aK as De,A as w,a1 as _e,aL as ie,i as F,aM as Le,aN as Z,a8 as he,aO as Ae,aP as Be,a3 as se,aQ as Fe,ad as je,aR as ze,a5 as Re,Z as Ue,W as Me,al as Ne,aj as x,a2 as qe,aS as Ge,aT as $e,aw as Ke,r as y,aU as He,o as Je,B as Qe,c as L,w as t,V as We,b as Ze,d as h,f as G,g as O,h as m,G as T,y as f,m as Oe,j as X,aq as Xe,C as Y,s as Ye,E as ea,v as E,p as ee,as as aa,H as la,ao as ta,av as oa,l as na,I as ia}from"./index-DTzO7a71.js";import{u as sa}from"./documents-Dm54GYRR.js";import{V as B,a as C}from"./VRow-DteDp9R7.js";import{V as ae}from"./VForm-Cr0IhdhJ.js";import{V as le}from"./VSelect-DrkOLv1H.js";import{V as ua}from"./VChip-Bftqh3Dm.js";import{V as ra}from"./VTextarea-BbRLHrOO.js";import{V as da}from"./VAutocomplete-cGRAN60C.js";import{V as U}from"./VAlert-WIuVYfyH.js";import{V as ca}from"./VFileInput-DzCX-g5H.js";import"./filter-C-DwuyMR.js";const j=Symbol.for("vuetify:v-expansion-panel"),ue=N({...H(),...Se()},"VExpansionPanelText"),$=M()({name:"VExpansionPanelText",props:ue(),setup(l,v){let{slots:s}=v;const n=te(j);if(!n)throw new Error("[Vuetify] v-expansion-panel-text needs to be placed inside v-expansion-panel");const{hasContent:b,onAfterLeave:V}=we(l,n.isSelected);return q(()=>a(ke,{onAfterLeave:V},{default:()=>{var P;return[oe(a("div",{class:["v-expansion-panel-text",l.class],style:l.style},[s.default&&b.value&&a("div",{class:"v-expansion-panel-text__wrapper"},[(P=s.default)==null?void 0:P.call(s)])]),[[Te,n.isSelected.value]])]}})),{}}}),re=N({color:String,expandIcon:{type:Z,default:"$expand"},collapseIcon:{type:Z,default:"$collapse"},hideActions:Boolean,focusable:Boolean,static:Boolean,ripple:{type:[Boolean,Object],default:!1},readonly:Boolean,...H(),...Le()},"VExpansionPanelTitle"),K=M()({name:"VExpansionPanelTitle",directives:{Ripple:Ie},props:re(),setup(l,v){let{slots:s}=v;const n=te(j);if(!n)throw new Error("[Vuetify] v-expansion-panel-title needs to be placed inside v-expansion-panel");const{backgroundColorClasses:b,backgroundColorStyles:V}=ne(l,"color"),{dimensionStyles:P}=De(l),u=w(()=>({collapseIcon:l.collapseIcon,disabled:n.disabled.value,expanded:n.isSelected.value,expandIcon:l.expandIcon,readonly:l.readonly})),I=w(()=>n.isSelected.value?l.collapseIcon:l.expandIcon);return q(()=>{var k;return oe(a("button",{class:["v-expansion-panel-title",{"v-expansion-panel-title--active":n.isSelected.value,"v-expansion-panel-title--focusable":l.focusable,"v-expansion-panel-title--static":l.static},b.value,l.class],style:[V.value,P.value,l.style],type:"button",tabindex:n.disabled.value?-1:void 0,disabled:n.disabled.value,"aria-expanded":n.isSelected.value,onClick:l.readonly?void 0:n.toggle},[a("span",{class:"v-expansion-panel-title__overlay"},null),(k=s.default)==null?void 0:k.call(s,u.value),!l.hideActions&&a(ie,{defaults:{VIcon:{icon:I.value}}},{default:()=>{var g;return[a("span",{class:"v-expansion-panel-title__icon"},[((g=s.actions)==null?void 0:g.call(s,u.value))??a(F,null,null)])]}})]),[[_e("ripple"),l.ripple]])}),{}}}),de=N({title:String,text:String,bgColor:String,...ze(),...je(),...Fe(),...se(),...re(),...ue()},"VExpansionPanel"),ma=M()({name:"VExpansionPanel",props:de(),emits:{"group:selected":l=>!0},setup(l,v){let{slots:s}=v;const n=he(l,j),{backgroundColorClasses:b,backgroundColorStyles:V}=ne(l,"bgColor"),{elevationClasses:P}=Ae(l),{roundedClasses:u}=Be(l),I=w(()=>(n==null?void 0:n.disabled.value)||l.disabled),k=w(()=>n.group.items.value.reduce((p,c,D)=>(n.group.selected.value.includes(c.id)&&p.push(D),p),[])),g=w(()=>{const p=n.group.items.value.findIndex(c=>c.id===n.id);return!n.isSelected.value&&k.value.some(c=>c-p===1)}),z=w(()=>{const p=n.group.items.value.findIndex(c=>c.id===n.id);return!n.isSelected.value&&k.value.some(c=>c-p===-1)});return Re(j,n),q(()=>{const p=!!(s.text||l.text),c=!!(s.title||l.title),D=K.filterProps(l),R=$.filterProps(l);return a(l.tag,{class:["v-expansion-panel",{"v-expansion-panel--active":n.isSelected.value,"v-expansion-panel--before-active":g.value,"v-expansion-panel--after-active":z.value,"v-expansion-panel--disabled":I.value},u.value,b.value,l.class],style:[V.value,l.style]},{default:()=>[a("div",{class:["v-expansion-panel__shadow",...P.value]},null),a(ie,{defaults:{VExpansionPanelTitle:{...D},VExpansionPanelText:{...R}}},{default:()=>{var A;return[c&&a(K,{key:"title"},{default:()=>[s.title?s.title():l.title]}),p&&a($,{key:"text"},{default:()=>[s.text?s.text():l.text]}),(A=s.default)==null?void 0:A.call(s)]}})]})}),{groupItem:n}}}),va=["default","accordion","inset","popout"],pa=N({flat:Boolean,...$e(),...Ge(de(),["bgColor","collapseIcon","color","eager","elevation","expandIcon","focusable","hideActions","readonly","ripple","rounded","tile","static"]),...qe(),...H(),...se(),variant:{type:String,default:"default",validator:l=>va.includes(l)}},"VExpansionPanels"),fa=M()({name:"VExpansionPanels",props:pa(),emits:{"update:modelValue":l=>!0},setup(l,v){let{slots:s}=v;const{next:n,prev:b}=Ue(l,j),{themeClasses:V}=Me(l),P=w(()=>l.variant&&`v-expansion-panels--variant-${l.variant}`);return Ne({VExpansionPanel:{bgColor:x(l,"bgColor"),collapseIcon:x(l,"collapseIcon"),color:x(l,"color"),eager:x(l,"eager"),elevation:x(l,"elevation"),expandIcon:x(l,"expandIcon"),focusable:x(l,"focusable"),hideActions:x(l,"hideActions"),readonly:x(l,"readonly"),ripple:x(l,"ripple"),rounded:x(l,"rounded"),static:x(l,"static")}}),q(()=>a(l.tag,{class:["v-expansion-panels",{"v-expansion-panels--flat":l.flat,"v-expansion-panels--tile":l.tile},V.value,P.value,l.class],style:l.style},{default:()=>{var u;return[(u=s.default)==null?void 0:u.call(s,{prev:b,next:n})]}})),{next:n,prev:b}}}),xa={class:"d-flex align-center"},ya={class:"text-subtitle-1"},Va={class:"text-caption"},ga={class:"d-flex align-center"},ba={class:"d-flex align-center"},Pa={class:"text-caption"},Ca={class:"d-flex justify-end"},Ea={class:"text-center"},wa={class:"mb-4"},ja={__name:"edit",setup(l){const v=sa(),s=He(),n=Ze(),b=Ke(),V=y(null),P=y(null),u=y(null),I=y([]),k=y([]),g=y(!0),z=y(!1),p=y(!1),c=y({show:!1,text:"",color:"success",timeout:3e3}),D=y(!1),R=y(""),A=w(()=>s.params.id),i=y({title:"",description:"",type:"",tags:[],file:null,security:{accessLevel:"Privado"}}),ce=w(()=>v.getAccessLevels());Je(async()=>{try{g.value=!0;const[o,e,d]=await Promise.all([me(),v.fetchDocumentTypes(),v.fetchTags()]);I.value=e,k.value=d}catch(o){_("Error al cargar los datos iniciales: "+o.message)}finally{g.value=!1}}),Qe(u,o=>{var e;o&&(i.value={title:o.title||"no encontrado",description:o.description||"",type:o.documentType||null,tags:o.tags||[],file:null,security:{accessLevel:((e=o.security)==null?void 0:e.accessLevel)||"Privado"}})},{immediate:!0});async function me(){try{u.value=await v.fetchDocumentById(A.value)}catch(o){_("Error al cargar el documento: "+o.message),u.value=null}}async function ve(){if(!i.value.type)throw new Error("El tipo de documento es obligatorio");if(i.value.file&&i.value.file.size>20971520)throw new Error("El archivo excede el tamaño máximo permitido de 20MB");if(!I.value.find(e=>e.name===i.value.type))throw new Error("El tipo de documento seleccionado no es válido");return!0}async function pe(){if(!ve()){_("Por favor, completa los campos obligatorios.");return}const o=s.params.id,e={title:i.value.title,description:i.value.description||"",...i.value.type&&typeof i.value.type=="object"&&i.value.type.id?{documentTypeId:i.value.type.id}:{},tags:i.value.tags?i.value.tags.map(d=>d.name||d):[],file:i.value.file||null,security:i.value.security};console.log("Datos enviados al store (plainData):",e);try{const d=await v.updateDocument(o,e);console.log("[submitForm] Documento actualizado:",d),W("Documento actualizado correctamente."),n.push({name:"DocumentDetail",params:{id:o}})}catch(d){_("Error al actualizar el documento. Revisa la consola para más detalles."),console.error("[submitForm] Error:",d)}}function fe(){var o;u.value&&(i.value={title:u.value.title||"",description:u.value.description||"",type:u.value.type?u.value.type.name:null,tags:u.value.tags||[],file:null,security:{accessLevel:((o=u.value.security)==null?void 0:o.accessLevel)||"Privado"}}),V.value&&V.value.resetValidation()}function xe(o){if(!o)return;const e=20*1024*1024;o.size>e&&(_("El archivo es demasiado grande. El tamaño máximo es 20MB."),i.value.file=null)}function J(){n.back()}function ye(){p.value=!0}async function Ve(){try{g.value=!0,await v.deleteDocument(A.value),W(`Documento "${u.value.title}" eliminado correctamente.`),p.value=!1,setTimeout(()=>{n.push("/search-documents")},1500)}catch(o){_("Error al eliminar el documento: "+o.message)}finally{g.value=!1}}function Q(o){if(!o)return"mdi-file-outline";let e;return typeof o=="string"?e=o.toLowerCase():e=o.name.split(".").pop().toLowerCase(),{pdf:"mdi-file-pdf-box",doc:"mdi-file-word-outline",docx:"mdi-file-word-outline",xls:"mdi-file-excel-outline",xlsx:"mdi-file-excel-outline",ppt:"mdi-file-powerpoint-outline",pptx:"mdi-file-powerpoint-outline",jpg:"mdi-file-image-outline",jpeg:"mdi-file-image-outline",png:"mdi-file-image-outline",txt:"mdi-file-document-outline"}[e]||"mdi-file-outline"}function ge(o){return o?o<1024?o+" bytes":o<1024*1024?(o/1024).toFixed(2)+" KB":(o/(1024*1024)).toFixed(2)+" MB":""}function W(o){c.value={show:!0,text:o,color:"success",timeout:3e3}}function be(o){return v.getSecurityLevelColor(o)}function Pe(o){switch(o){case"Publico":return"mdi-earth";case"Limitado":return"mdi-account-group-outline";case"Confidencial":return"mdi-shield-lock-outline";case"Privado":default:return"mdi-lock-outline"}}function Ce(o){switch(o){case"Publico":return"Accesible para todos los usuarios";case"Limitado":return"Accesible para grupos específicos";case"Confidencial":return"Accesible solo para personal autorizado";case"Privado":default:return"Accesible solo para el autor y administradores"}}function _(o){c.value={show:!0,text:o,color:"error",timeout:5e3}}return(o,e)=>(h(),L(We,{fluid:""},{default:t(()=>[a(B,null,{default:t(()=>[a(C,{cols:"12"},{default:t(()=>[a(G,{class:"mb-4"},{default:t(()=>[a(O,{class:"d-flex align-center"},{default:t(()=>[a(T,{variant:"text","prepend-icon":"mdi-arrow-left",onClick:J,class:"mr-4"},{default:t(()=>e[12]||(e[12]=[m(" Volver ")])),_:1}),a(F,{class:"mr-2"},{default:t(()=>e[13]||(e[13]=[m("mdi-file-edit-outline")])),_:1}),e[14]||(e[14]=m(" Editar Documento "))]),_:1})]),_:1})]),_:1})]),_:1}),g.value&&!u.value?(h(),L(B,{key:0},{default:t(()=>[a(C,{cols:"12",class:"d-flex justify-center align-center pa-8"},{default:t(()=>[a(Oe,{indeterminate:"",color:"primary",size:"64"}),e[15]||(e[15]=f("span",{class:"ml-4 text-h6"},"Cargando documento...",-1))]),_:1})]),_:1})):u.value?(h(),L(B,{key:1},{default:t(()=>[a(C,{cols:"12"},{default:t(()=>[a(G,null,{default:t(()=>[a(X,null,{default:t(()=>[a(ae,{ref_key:"form",ref:V,onSubmit:Xe(pe,["prevent"])},{default:t(()=>{var d,S;return[a(B,null,{default:t(()=>[a(C,{cols:"12",md:"6"},{default:t(()=>[a(Y,{modelValue:i.value.title,"onUpdate:modelValue":e[0]||(e[0]=r=>i.value.title=r),label:"Título del documento *","item-title":"name","item-value":"name",variant:"outlined",rules:[r=>!!r||"El título es obligatorio"],required:""},null,8,["modelValue","rules"])]),_:1}),a(C,{cols:"12",md:"6"},{default:t(()=>[a(le,{modelValue:i.value.security.accessLevel,"onUpdate:modelValue":e[1]||(e[1]=r=>i.value.security.accessLevel=r),items:ce.value,label:"Nivel de acceso *",variant:"outlined",rules:[r=>!!r||"El nivel de acceso es obligatorio"],required:""},{selection:t(({item:r})=>[a(ua,{color:be(r.value),size:"small",class:"mr-2"},{default:t(()=>[m(E(r.value),1)]),_:2},1032,["color"])]),item:t(({item:r,props:Ee})=>[a(Ye,ea(Ee,{title:r.value,"prepend-icon":Pe(r.value),subtitle:Ce(r.value)}),null,16,["title","prepend-icon","subtitle"])]),_:1},8,["modelValue","items","rules"])]),_:1}),a(C,{cols:"12",md:"6"},{default:t(()=>[a(le,{modelValue:i.value.type,"onUpdate:modelValue":e[2]||(e[2]=r=>i.value.type=r),"item-title":"name","item-value":"name",items:I.value,label:"Tipo de documento *",variant:"outlined",rules:[r=>!!r||"El tipo de documento es obligatorio"],required:""},null,8,["modelValue","items","rules"])]),_:1}),a(C,{cols:"12"},{default:t(()=>[a(ra,{modelValue:i.value.description,"onUpdate:modelValue":e[3]||(e[3]=r=>i.value.description=r),label:"Descripción",variant:"outlined",rows:"3","auto-grow":""},null,8,["modelValue"])]),_:1}),a(C,{cols:"12"},{default:t(()=>[a(da,{modelValue:i.value.tags,"onUpdate:modelValue":e[4]||(e[4]=r=>i.value.tags=r),items:k.value,label:"Etiquetas",variant:"outlined",chips:"",multiple:"","closable-chips":"","return-object":"","item-title":"name","item-value":"id"},null,8,["modelValue","items"])]),_:1}),a(C,{cols:"12"},{default:t(()=>[a(U,{type:"info",variant:"tonal",class:"mb-4"},{default:t(()=>[f("div",xa,[a(F,{class:"mr-2"},{default:t(()=>[m(E(Q(u.value.format)),1)]),_:1}),f("div",null,[f("div",ya,"Archivo actual: "+E(u.value.filePath.split("/").pop()),1),f("div",Va,"Formato: "+E(u.value.format),1)])])]),_:1}),a(fa,{variant:"accordion"},{default:t(()=>[a(ma,null,{default:t(()=>[a(K,null,{default:t(()=>[f("div",ga,[a(F,{class:"mr-2"},{default:t(()=>e[16]||(e[16]=[m("mdi-file-replace-outline")])),_:1}),e[17]||(e[17]=m(" Reemplazar archivo "))])]),_:1}),a($,null,{default:t(()=>[a(ca,{modelValue:i.value.file,"onUpdate:modelValue":e[5]||(e[5]=r=>i.value.file=r),label:"Nuevo archivo",variant:"outlined",accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.txt","show-size":"","prepend-icon":"mdi-file-upload-outline",onChange:xe},null,8,["modelValue"]),i.value.file?(h(),L(U,{key:0,type:"info",variant:"tonal",class:"mt-2"},{default:t(()=>[f("div",ba,[a(F,{class:"mr-2"},{default:t(()=>[m(E(Q(i.value.file)),1)]),_:1}),f("div",null,[f("div",null,E(i.value.file.name),1),f("div",Pa,E(ge(i.value.file.size)),1)])])]),_:1})):ee("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(aa,{class:"my-4"}),f("div",Ca,[((S=(d=la(b).user)==null?void 0:d.role)==null?void 0:S.name)==="ADMIN"?(h(),L(T,{key:0,variant:"text",color:"error",onClick:ye,class:"mr-auto"},{default:t(()=>e[18]||(e[18]=[m(" Eliminar Documento ")])),_:1})):ee("",!0),a(T,{variant:"text",onClick:fe,class:"mr-2"},{default:t(()=>e[19]||(e[19]=[m(" Cancelar ")])),_:1}),a(T,{color:"primary",type:"submit",loading:z.value,disabled:z.value},{default:t(()=>e[20]||(e[20]=[m(" Guardar Cambios ")])),_:1},8,["loading","disabled"])])]}),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})):(h(),L(B,{key:2},{default:t(()=>[a(C,{cols:"12"},{default:t(()=>[a(U,{type:"error",title:"Error",text:"No se pudo encontrar el documento solicitado.",class:"mb-4"}),f("div",Ea,[a(T,{color:"primary","prepend-icon":"mdi-arrow-left",onClick:J},{default:t(()=>e[21]||(e[21]=[m(" Volver a la lista de documentos ")])),_:1})])]),_:1})]),_:1})),a(ta,{modelValue:p.value,"onUpdate:modelValue":e[9]||(e[9]=d=>p.value=d),"max-width":"500px"},{default:t(()=>[a(G,null,{default:t(()=>[a(O,{class:"text-h5"},{default:t(()=>e[22]||(e[22]=[m("Confirmar eliminación")])),_:1}),a(X,null,{default:t(()=>{var d;return[f("p",wa,'¿Está seguro que desea eliminar el documento "'+E((d=u.value)==null?void 0:d.title)+'"?',1),a(U,{type:"warning",variant:"tonal",class:"mb-4"},{default:t(()=>e[23]||(e[23]=[m(" Esta acción no se puede deshacer. ")])),_:1}),a(ae,{ref_key:"deleteForm",ref:P,modelValue:D.value,"onUpdate:modelValue":e[7]||(e[7]=S=>D.value=S)},{default:t(()=>[a(Y,{modelValue:R.value,"onUpdate:modelValue":e[6]||(e[6]=S=>R.value=S),label:"Contraseña de administrador",type:"password",rules:[S=>!!S||"La contraseña es requerida"],required:""},null,8,["modelValue","rules"])]),_:1},8,["modelValue"])]}),_:1}),a(oa,null,{default:t(()=>[a(na),a(T,{color:"primary",variant:"text",onClick:e[8]||(e[8]=d=>p.value=!1)},{default:t(()=>e[24]||(e[24]=[m(" Cancelar ")])),_:1}),a(T,{color:"error",variant:"elevated",onClick:Ve,loading:g.value,disabled:!D.value},{default:t(()=>e[25]||(e[25]=[m(" Eliminar ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(ia,{modelValue:c.value.show,"onUpdate:modelValue":e[11]||(e[11]=d=>c.value.show=d),color:c.value.color,timeout:c.value.timeout},{actions:t(()=>[a(T,{variant:"text",onClick:e[10]||(e[10]=d=>c.value.show=!1)},{default:t(()=>e[26]||(e[26]=[m(" Cerrar ")])),_:1})]),default:t(()=>[m(E(c.value.text)+" ",1)]),_:1},8,["modelValue","color","timeout"])]),_:1}))}};export{ja as default};
