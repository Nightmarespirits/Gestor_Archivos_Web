import{aw as z,A as R,aU as G,r as Z,o as M,c as i,w as r,V as U,b as q,d as s,e as t,f as w,g as O,y as V,p as d,G as f,h as a,j as C,k as H,F as J,v as o,as as _,n as T,ap as B,s as p,t as v,x as g,i as c}from"./index-DTzO7a71.js";import{u as K}from"./registro-transferencia-D8l4MZon.js";import{V as Q}from"./VAlert-WIuVYfyH.js";import{V as W}from"./VSkeletonLoader-DHz2ZGEv.js";import{V as X}from"./VChip-Bftqh3Dm.js";import{V as S,a as k}from"./VRow-DteDp9R7.js";const Y={class:"d-flex justify-space-between align-center mb-4"},h={class:"text-h5"},ee={class:"d-flex flex-wrap gap-3"},ie={__name:"index",setup(re){const F=G(),L=q(),m=K(),b=z(),y=R(()=>F.params.id),N=R(()=>m.isLoading()),u=Z(null),l=R(()=>m.getCurrentRegistroTransferencia()),$=R(()=>b.hasPermission("APROBAR_REGISTROS")),A=R(()=>b.hasPermission("EDITAR_REGISTROS")||l.value&&l.value.createdBy===b.getUserId());M(async()=>{try{await m.fetchRegistroTransferenciaById(y.value),l.value||(u.value="No se encontró el registro de transferencia solicitado")}catch(n){u.value=`Error al cargar el registro: ${n.message}`,console.error("Error:",n)}});async function x(n){try{if(!l.value)return;const e={...l.value,estado:n};await m.updateRegistroTransferencia(y.value,e),alert(`Estado actualizado a ${n}`)}catch(e){u.value=`Error al cambiar estado: ${e.message}`,console.error("Error:",e)}}async function E(n){try{await m.downloadInventario(y.value,n)}catch(e){u.value=`Error al descargar: ${e.message}`,console.error("Error:",e)}}async function P(){if(l.value&&confirm("¿Está seguro que desea eliminar este registro de transferencia?"))try{await m.deleteRegistroTransferencia(y.value)&&(alert("Registro eliminado correctamente"),L.push({name:"registro-transferencia-list"}))}catch(n){u.value=`Error al eliminar: ${n.message}`,console.error("Error:",n)}}function I(n){if(!n)return"N/A";try{const e=new Date(n);return new Intl.DateTimeFormat("es-ES",{year:"numeric",month:"long",day:"numeric"}).format(e)}catch{return n}}function j(n){switch(n){case"BORRADOR":return"grey";case"FINALIZADO":return"primary";case"APROBADO":return"success";default:return"grey"}}return(n,e)=>(s(),i(U,{fluid:""},{default:r(()=>[t(w,null,{default:r(()=>[t(O,{class:"d-flex justify-space-between"},{default:r(()=>[e[6]||(e[6]=V("span",null,"Detalle de Registro de Transferencia",-1)),V("div",null,[A.value?(s(),i(f,{key:0,color:"warning","prepend-icon":"mdi-pencil",to:{name:"registro-transferencia-edit",params:{id:y.value}},class:"mr-2"},{default:r(()=>e[4]||(e[4]=[a(" Editar ")])),_:1},8,["to"])):d("",!0),t(f,{color:"primary","prepend-icon":"mdi-arrow-left",to:{name:"registro-transferencia-list"}},{default:r(()=>e[5]||(e[5]=[a(" Volver ")])),_:1})])]),_:1}),t(C,null,{default:r(()=>[u.value?(s(),i(Q,{key:0,type:"error",title:"Error",text:u.value,class:"mb-4"},null,8,["text"])):d("",!0),N.value&&!l.value?(s(),i(W,{key:1,type:"card-heading, list-item-three-line, list-item-three-line, list-item-three-line, list-item-three-line"})):l.value?(s(),H(J,{key:2},[V("div",Y,[V("h2",h,o(l.value.codigo)+" - "+o(l.value.numero),1),t(X,{color:j(l.value.estado),"text-color":"white"},{default:r(()=>[a(o(l.value.estado),1)]),_:1},8,["color"])]),t(_,{class:"mb-4"}),t(S,null,{default:r(()=>[t(k,{cols:"12",md:"6"},{default:r(()=>[t(T,null,{default:r(()=>[t(B,null,{default:r(()=>e[7]||(e[7]=[a("Información de Registro")])),_:1}),t(p,null,{prepend:r(()=>[t(c,{icon:"mdi-calendar"})]),default:r(()=>[t(v,null,{default:r(()=>e[8]||(e[8]=[a("Fecha")])),_:1}),t(g,null,{default:r(()=>[a(o(I(l.value.fecha)),1)]),_:1})]),_:1}),t(p,null,{prepend:r(()=>[t(c,{icon:"mdi-office-building"})]),default:r(()=>[t(v,null,{default:r(()=>e[9]||(e[9]=[a("Dependencia de Origen")])),_:1}),t(g,null,{default:r(()=>[a(o(l.value.dependenciaOrigen),1)]),_:1})]),_:1}),t(p,null,{prepend:r(()=>[t(c,{icon:"mdi-office-building-outline"})]),default:r(()=>[t(v,null,{default:r(()=>e[10]||(e[10]=[a("Dependencia de Destino")])),_:1}),t(g,null,{default:r(()=>[a(o(l.value.dependenciaDestino),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(k,{cols:"12",md:"6"},{default:r(()=>[t(T,null,{default:r(()=>[t(B,null,{default:r(()=>e[11]||(e[11]=[a("Responsables y Detalles")])),_:1}),t(p,null,{prepend:r(()=>[t(c,{icon:"mdi-account"})]),default:r(()=>[t(v,null,{default:r(()=>e[12]||(e[12]=[a("Responsable")])),_:1}),t(g,null,{default:r(()=>[a(o(l.value.responsable),1)]),_:1})]),_:1}),t(p,null,{prepend:r(()=>[t(c,{icon:"mdi-file-document-multiple"})]),default:r(()=>[t(v,null,{default:r(()=>e[13]||(e[13]=[a("Total de Documentos")])),_:1}),t(g,null,{default:r(()=>[a(o(l.value.totalDocumentos||0),1)]),_:1})]),_:1}),t(p,null,{prepend:r(()=>[t(c,{icon:"mdi-calendar-clock"})]),default:r(()=>[t(v,null,{default:r(()=>e[14]||(e[14]=[a("Fecha Creación")])),_:1}),t(g,null,{default:r(()=>[a(o(I(l.value.createdAt)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l.value.observaciones?(s(),i(S,{key:0},{default:r(()=>[t(k,{cols:"12"},{default:r(()=>[t(w,{variant:"outlined",color:"background"},{default:r(()=>[t(O,{class:"text-subtitle-1"},{default:r(()=>[t(c,{start:"",icon:"mdi-information-outline"}),e[15]||(e[15]=a(" Observaciones "))]),_:1}),t(C,{class:"text-body-1"},{default:r(()=>[a(o(l.value.observaciones),1)]),_:1})]),_:1})]),_:1})]),_:1})):d("",!0),t(_,{class:"my-4"}),V("div",ee,[l.value.estado==="BORRADOR"&&A.value?(s(),i(f,{key:0,color:"success","prepend-icon":"mdi-check",onClick:e[0]||(e[0]=D=>x("FINALIZADO"))},{default:r(()=>e[16]||(e[16]=[a(" Finalizar ")])),_:1})):d("",!0),l.value.estado==="FINALIZADO"&&$.value?(s(),i(f,{key:1,color:"success","prepend-icon":"mdi-check-all",onClick:e[1]||(e[1]=D=>x("APROBADO"))},{default:r(()=>e[17]||(e[17]=[a(" Aprobar ")])),_:1})):d("",!0),t(f,{color:"primary","prepend-icon":"mdi-printer",onClick:e[2]||(e[2]=D=>E("pdf"))},{default:r(()=>e[18]||(e[18]=[a(" Imprimir PDF ")])),_:1}),t(f,{color:"success","prepend-icon":"mdi-microsoft-excel",onClick:e[3]||(e[3]=D=>E("excel"))},{default:r(()=>e[19]||(e[19]=[a(" Descargar Excel ")])),_:1}),A.value?(s(),i(f,{key:2,color:"error","prepend-icon":"mdi-delete",onClick:P},{default:r(()=>e[20]||(e[20]=[a(" Eliminar ")])),_:1})):d("",!0)])],64)):d("",!0)]),_:1})]),_:1})]),_:1}))}};export{ie as default};
