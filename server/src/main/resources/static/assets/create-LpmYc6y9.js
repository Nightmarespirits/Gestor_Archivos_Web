import{aw as q,r as c,A as P,o as R,c as C,w as o,V as z,b as G,d as S,e as l,f as D,g as O,h as i,G as y,i as _,j as J,aq as $,y as v,C as K,s as H,E as Q,v as V,p as W,as as X,I as Y}from"./index-DTzO7a71.js";import{u as Z}from"./documents-Dm54GYRR.js";import{_ as ee}from"./PermissionButton-DANkCNxj.js";import{V as x,a as u}from"./VRow-DteDp9R7.js";import{V as te}from"./VForm-Cr0IhdhJ.js";import{V as k}from"./VSelect-DrkOLv1H.js";import{V as le}from"./VChip-Bftqh3Dm.js";import{V as ae}from"./VTextarea-BbRLHrOO.js";import{V as oe}from"./VAutocomplete-cGRAN60C.js";import{V as se}from"./VFileInput-DzCX-g5H.js";import{V as ie}from"./VAlert-WIuVYfyH.js";import"./filter-C-DwuyMR.js";const re={class:"d-flex align-center"},ue={class:"text-caption"},ne={class:"d-flex justify-end"},Ce={__name:"create",setup(de){const m=Z(),f=q(),b=G(),p=c(null),w=c([]),h=c([]),n=c(!1),r=c({show:!1,text:"",color:"success",timeout:3e3}),a=c({title:"",description:"",type:null,tags:[],file:null,security:{accessLevel:"Privado"},authorId:null}),E=P(()=>m.getAccessLevels());R(async()=>{try{n.value=!0,w.value=await m.fetchDocumentTypes(),h.value=await m.fetchTags(),f.user&&f.user.id&&(a.value.authorId=f.user.id)}catch(s){g("Error al cargar los datos iniciales: "+s.message)}finally{n.value=!1}});async function T(){if(!p.value)return;const{valid:s}=await p.value.validate();if(!s){g("Por favor, complete todos los campos obligatorios.");return}if(!a.value.type){g("El tipo de documento es obligatorio.");return}try{n.value=!0;const e=new FormData;a.value.file&&e.append("file",a.value.file[0]||a.value.file),e.append("title",a.value.title),e.append("description",a.value.description||""),e.append("authorId",a.value.authorId),e.append("type",a.value.type),e.append("security",JSON.stringify(a.value.security)),a.value.tags&&a.value.tags.length>0&&a.value.tags.forEach(d=>{e.append("tags",d.name)}),console.log("Datos enviados a la api: ",JSON.stringify(a.value.security));const t=await m.createDocument(e);j("Documento creado correctamente."),b.push({name:"DocumentDetail",params:{id:t.id}})}catch(e){g("Error al crear el documento: "+e.message)}finally{n.value=!1}}function L(){a.value={title:"",description:"",type:null,tags:[],file:null,security:{accessLevel:"Privado"},authorId:f.user?f.user.id:null},p.value&&p.value.reset()}function F(s){console.log("Archivo seleccionado:",s)}function I(){b.back()}function N(s){if(!s)return"mdi-file-question-outline";switch((s.name||"").split(".").pop().toLowerCase()){case"pdf":return"mdi-file-pdf-box";case"doc":case"docx":return"mdi-file-word-outline";case"xls":case"xlsx":return"mdi-file-excel-outline";case"ppt":case"pptx":return"mdi-file-powerpoint-outline";case"jpg":case"jpeg":case"png":return"mdi-file-image-outline";case"txt":return"mdi-file-document-outline";default:return"mdi-file-outline"}}function B(s){if(s===0)return"0 Bytes";const e=1024,t=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(s)/Math.log(e));return parseFloat((s/Math.pow(e,d)).toFixed(2))+" "+t[d]}function A(s){return m.getSecurityLevelColor(s)}function M(s){switch(s){case"Secreto":return"mdi-shield-lock";case"Reservado":return"mdi-shield-alert";case"Privado":default:return"mdi-shield-check"}}function U(s){switch(s){case"Secreto":return"Solo visible para administradores";case"Reservado":return"Visible para gestores y administradores";case"Privado":default:return"Visible para todos los usuarios"}}function j(s){r.value={show:!0,text:s,color:"success",timeout:3e3}}function g(s){r.value={show:!0,text:s,color:"error",timeout:5e3}}return(s,e)=>(S(),C(z,{fluid:""},{default:o(()=>[l(x,null,{default:o(()=>[l(u,{cols:"12"},{default:o(()=>[l(D,{class:"mb-4"},{default:o(()=>[l(O,{class:"d-flex align-center"},{default:o(()=>[l(y,{variant:"text","prepend-icon":"mdi-arrow-left",onClick:I,class:"mr-4"},{default:o(()=>e[8]||(e[8]=[i(" Volver ")])),_:1}),l(_,{class:"mr-2"},{default:o(()=>e[9]||(e[9]=[i("mdi-file-plus-outline")])),_:1}),e[10]||(e[10]=i(" Crear Nuevo Documento "))]),_:1})]),_:1})]),_:1})]),_:1}),l(x,null,{default:o(()=>[l(u,{cols:"12"},{default:o(()=>[l(D,null,{default:o(()=>[l(J,null,{default:o(()=>[l(te,{ref_key:"form",ref:p,onSubmit:$(T,["prevent"])},{default:o(()=>[l(x,null,{default:o(()=>[l(u,{cols:"12",md:"6"},{default:o(()=>[l(K,{modelValue:a.value.title,"onUpdate:modelValue":e[0]||(e[0]=t=>a.value.title=t),label:"Título del documento *",variant:"outlined",rules:[t=>!!t||"El título es obligatorio"],required:""},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(k,{modelValue:a.value.type,"onUpdate:modelValue":e[1]||(e[1]=t=>a.value.type=t),items:w.value,"item-title":"name","item-value":"name",label:"Tipo de documento *",variant:"outlined",rules:[t=>!!t||"El tipo de documento es obligatorio"],required:""},null,8,["modelValue","items","rules"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(k,{modelValue:a.value.security.accessLevel,"onUpdate:modelValue":e[2]||(e[2]=t=>a.value.security.accessLevel=t),items:E.value,label:"Nivel de acceso *",variant:"outlined",rules:[t=>!!t||"El nivel de acceso es obligatorio"],required:""},{selection:o(({item:t})=>[l(le,{color:A(t.value),size:"small",class:"mr-2"},{default:o(()=>[i(V(t.value),1)]),_:2},1032,["color"])]),item:o(({item:t,props:d})=>[l(H,Q(d,{title:t.value,"prepend-icon":M(t.value),subtitle:U(t.value)}),null,16,["title","prepend-icon","subtitle"])]),_:1},8,["modelValue","items","rules"])]),_:1}),l(u,{cols:"12"},{default:o(()=>[l(ae,{modelValue:a.value.description,"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.description=t),label:"Descripción",variant:"outlined",rows:"3","auto-grow":""},null,8,["modelValue"])]),_:1}),l(u,{cols:"12"},{default:o(()=>[l(oe,{modelValue:a.value.tags,"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.tags=t),items:h.value,"item-title":"name","item-value":"id",label:"Etiquetas",variant:"outlined",chips:"",multiple:"","closable-chips":"","return-object":""},null,8,["modelValue","items"])]),_:1}),l(u,{cols:"12"},{default:o(()=>[l(se,{modelValue:a.value.file,"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.file=t),label:"Archivo del documento *",variant:"outlined",accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.txt",rules:[t=>!!t||"El archivo es obligatorio"],required:"","show-size":"","prepend-icon":"mdi-file-upload-outline",onChange:F},null,8,["modelValue","rules"]),a.value.file?(S(),C(ie,{key:0,type:"info",variant:"tonal",class:"mt-2"},{default:o(()=>[v("div",re,[l(_,{class:"mr-2"},{default:o(()=>[i(V(N(a.value.file)),1)]),_:1}),v("div",null,[v("div",null,V(a.value.file.name),1),v("div",ue,V(B(a.value.file.size)),1)])])]),_:1})):W("",!0)]),_:1})]),_:1}),l(X,{class:"my-4"}),v("div",ne,[l(y,{variant:"text",onClick:L,class:"mr-2"},{default:o(()=>e[11]||(e[11]=[i(" Limpiar ")])),_:1}),l(ee,{permissions:["DOCUMENT_CREATE"],color:"primary",type:"submit",loading:n.value,disabled:n.value,class:"ml-2"},{default:o(()=>e[12]||(e[12]=[i(" Guardar Documento ")])),_:1},8,["loading","disabled"])])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),l(Y,{modelValue:r.value.show,"onUpdate:modelValue":e[7]||(e[7]=t=>r.value.show=t),color:r.value.color,timeout:r.value.timeout},{actions:o(()=>[l(y,{variant:"text",onClick:e[6]||(e[6]=t=>r.value.show=!1)},{default:o(()=>e[13]||(e[13]=[i(" Cerrar ")])),_:1})]),default:o(()=>[i(V(r.value.text)+" ",1)]),_:1},8,["modelValue","color","timeout"])]),_:1}))}};export{Ce as default};
