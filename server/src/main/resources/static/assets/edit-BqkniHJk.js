import{aw as ve,r as m,A as z,aU as ce,aF as Q,B as pe,o as be,b as Ve,c as y,w as o,V as ye,d as b,k as ge,e as l,f as D,y as V,m as Ee,F as Ce,g as S,G as c,h as d,j as B,aq as De,p as F,C as s,D as W,E as T,i as j,v as J,ao as X,av as Y,l as Z}from"./index-DTzO7a71.js";import{u as Ie}from"./inventarios-mEqQ-Uto.js";import{V as _}from"./VForm-Cr0IhdhJ.js";import{V as p,a as i}from"./VRow-DteDp9R7.js";import{V as h}from"./VDatePicker-CEVfHtFV.js";import{V as ee}from"./VTextarea-BbRLHrOO.js";import{V as Ue}from"./VDataTable-BAdSe95_.js";import{V as le}from"./VTooltip-ZPSecc-u.js";import{V as ke}from"./VChip-Bftqh3Dm.js";import{V as xe}from"./VSelect-DrkOLv1H.js";import"./VSheet-D3msx1cx.js";import"./VTable-Dw3FHTEb.js";import"./filter-C-DwuyMR.js";const we={class:"text-center pa-5"},qe={class:"text-h5"},Me={__name:"edit",setup(Fe){const C=Ie(),I=ve(),ae=m({show:!1,text:"",color:"success",timeout:3e3});function v(t,e="success",a=3e3){ae.value={show:!0,text:t,color:e,timeout:a}}const oe=ce(),te=Ve(),g=m(!1),G=m(!1),L=m(!1),U=z(()=>Number(oe.params.id)),E=z(()=>C.getCurrentInventario()),P=m(!1),K=m(null),O=m(!1),R=m(!1),k=m(!1),x=m(!1),$=m(!1),A=m(null),w=m(null),q=m(null),ne=["BUENO","REGULAR","MALO"],n=Q({titulo:"",dependencia:"",numeroIdentificacion:"",organoGenerador:"",unidadOrganizacion:"",anio:"",fechaInicio:"",fechaFin:"",responsable:"",cargoResponsable:"",observaciones:"",estado:"",detalles:[]}),r=Q({codigo:"",serieDocumental:"",titulo:"",anosExtremos:"",estadoConservacion:"BUENO",ubicacion:"",soporte:"",observaciones:""}),re=[{title:"Código",key:"codigo",sortable:!0},{title:"Serie Documental",key:"serieDocumental",sortable:!0},{title:"Título",key:"titulo",sortable:!0},{title:"Años Extremos",key:"anosExtremos",sortable:!0},{title:"Ubicación",key:"ubicacion",sortable:!0},{title:"Conservación",key:"estadoConservacion",sortable:!0},{title:"Acciones",key:"actions",sortable:!1}],u=z(()=>{const t=E.value;return t?I.hasPermission("inventarios:edit")&&(t.estado==="BORRADOR"||I.hasPermission("inventarios:edit:any")):!1}),N=z(()=>{const t=E.value;return t?I.hasPermission("inventarios:edit")&&(t.estado==="BORRADOR"||I.hasPermission("inventarios:edit:any")):!1});function ie(t){switch(t){case"BUENO":return"green";case"REGULAR":return"orange";case"MALO":return"red";default:return"grey"}}async function se(){if(K.value.validate())try{g.value=!0,await C.updateInventario(U.value,n)?v("Inventario actualizado correctamente","success"):v("Error al actualizar el inventario","error")}catch(t){v("Error: "+(t.message||"No se pudo actualizar el inventario"),"error"),console.error("Error al actualizar inventario:",t)}finally{g.value=!1}}function M(t=null){t?(w.value=t.id,Object.keys(r).forEach(e=>{e in t&&(r[e]=t[e])})):(w.value=null,Object.keys(r).forEach(e=>{r[e]=e==="estadoConservacion"?"BUENO":""})),k.value=!0,setTimeout(()=>{A.value&&A.value.resetValidation()},100)}async function de(){if(A.value.validate())try{G.value=!0,w.value?(await C.updateInventarioDetalle(U.value,w.value,r),v("Elemento actualizado correctamente","success")):(await C.addInventarioDetalle(U.value,r),v("Elemento agregado correctamente","success")),await H(),k.value=!1}catch(t){v("Error: "+(t.message||"No se pudo guardar el elemento"),"error"),console.error("Error al guardar detalle:",t)}finally{G.value=!1}}function ue(t){q.value=t,x.value=!0}async function me(){if(q.value)try{L.value=!0,await C.deleteInventarioDetalle(U.value,q.value.id)?(v("Elemento eliminado correctamente","success"),x.value=!1,q.value=null,await H()):v("Error al eliminar el elemento","error")}catch(t){v("Error: "+(t.message||"No se pudo eliminar el elemento"),"error"),console.error("Error al eliminar detalle:",t)}finally{L.value=!1}}async function H(){try{g.value=!0;const t=await C.fetchInventarioById(U.value);t?Object.keys(n).forEach(e=>{e in t&&(n[e]=t[e])}):v("Inventario no encontrado","error")}catch(t){v("Error al cargar el inventario: "+t.message,"error")}finally{g.value=!1}}return pe(()=>E.value,t=>{t&&Object.keys(n).forEach(e=>{e in t&&(n[e]=t[e])})}),be(async()=>{if(!I.hasPermission("inventarios:edit")){v("No tienes permiso para editar inventarios","error"),te.push({name:"inventario-list"});return}await H()}),(t,e)=>(b(),y(ye,{fluid:""},{default:o(()=>[g.value&&!E.value?(b(),y(D,{key:0,class:"pa-5 text-center"},{default:o(()=>[l(Ee,{indeterminate:"",color:"primary"}),e[33]||(e[33]=V("div",{class:"text-body-1 mt-4"},"Cargando inventario...",-1))]),_:1})):E.value?(b(),ge(Ce,{key:1},[l(D,{class:"mb-4"},{default:o(()=>[l(S,{class:"d-flex justify-space-between align-center"},{default:o(()=>[e[35]||(e[35]=V("span",null,"Editar Inventario",-1)),l(c,{color:"secondary","prepend-icon":"mdi-arrow-left",to:{name:"inventario-view",params:{id:E.value.id}}},{default:o(()=>e[34]||(e[34]=[d(" Volver ")])),_:1},8,["to"])]),_:1}),l(B,null,{default:o(()=>[l(_,{ref_key:"form",ref:K,modelValue:P.value,"onUpdate:modelValue":e[17]||(e[17]=a=>P.value=a),onSubmit:De(se,["prevent"])},{default:o(()=>[l(p,null,{default:o(()=>[l(i,{cols:"12",sm:"6"},{default:o(()=>[l(s,{modelValue:n.titulo,"onUpdate:modelValue":e[0]||(e[0]=a=>n.titulo=a),label:"Título del inventario",rules:[a=>!!a||"El título es requerido"],required:"",variant:"outlined",density:"comfortable",disabled:!u.value},null,8,["modelValue","rules","disabled"])]),_:1}),l(i,{cols:"12",sm:"6"},{default:o(()=>[l(s,{modelValue:n.dependencia,"onUpdate:modelValue":e[1]||(e[1]=a=>n.dependencia=a),label:"Dependencia",rules:[a=>!!a||"La dependencia es requerida"],required:"",variant:"outlined",density:"comfortable",disabled:!u.value},null,8,["modelValue","rules","disabled"])]),_:1})]),_:1}),l(p,null,{default:o(()=>[l(i,{cols:"12",sm:"6"},{default:o(()=>[l(s,{modelValue:n.numeroIdentificacion,"onUpdate:modelValue":e[2]||(e[2]=a=>n.numeroIdentificacion=a),label:"Número de Identificación",hint:"Número único de identificación del inventario","persistent-hint":"",variant:"outlined",density:"comfortable",disabled:!u.value},null,8,["modelValue","disabled"])]),_:1}),l(i,{cols:"12",sm:"6"},{default:o(()=>[l(s,{modelValue:n.organoGenerador,"onUpdate:modelValue":e[3]||(e[3]=a=>n.organoGenerador=a),label:"Órgano Generador",hint:"Entidad o dependencia que genera el inventario","persistent-hint":"",variant:"outlined",density:"comfortable",disabled:!u.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),l(p,null,{default:o(()=>[l(i,{cols:"12",sm:"6"},{default:o(()=>[l(s,{modelValue:n.unidadOrganizacion,"onUpdate:modelValue":e[4]||(e[4]=a=>n.unidadOrganizacion=a),label:"Unidad de Organización",variant:"outlined",density:"comfortable",disabled:!u.value},null,8,["modelValue","disabled"])]),_:1}),l(i,{cols:"12",sm:"6"},{default:o(()=>[l(s,{modelValue:n.anio,"onUpdate:modelValue":e[5]||(e[5]=a=>n.anio=a),label:"Año",type:"number",variant:"outlined",density:"comfortable",rules:[a=>!!a||"El año es requerido",a=>a&&a.toString().length===4||"Debe ser un año válido"],required:"",disabled:!u.value},null,8,["modelValue","rules","disabled"])]),_:1})]),_:1}),l(p,null,{default:o(()=>[l(i,{cols:"12",sm:"6"},{default:o(()=>[l(W,{ref_key:"menuFechaInicio",ref:O,modelValue:O.value,"onUpdate:modelValue":e[9]||(e[9]=a=>O.value=a),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto",disabled:!u.value},{activator:o(({props:a})=>[l(s,T({modelValue:n.fechaInicio,"onUpdate:modelValue":e[6]||(e[6]=f=>n.fechaInicio=f),label:"Fecha de Inicio","prepend-inner-icon":"mdi-calendar",readonly:"",variant:"outlined",density:"comfortable"},a,{rules:[f=>!!f||"La fecha de inicio es requerida"],required:"",disabled:!u.value}),null,16,["modelValue","rules","disabled"])]),default:o(()=>[l(h,{modelValue:n.fechaInicio,"onUpdate:modelValue":[e[7]||(e[7]=a=>n.fechaInicio=a),e[8]||(e[8]=a=>O.value=!1)]},null,8,["modelValue"])]),_:1},8,["modelValue","disabled"])]),_:1}),l(i,{cols:"12",sm:"6"},{default:o(()=>[l(W,{ref_key:"menuFechaFin",ref:R,modelValue:R.value,"onUpdate:modelValue":e[13]||(e[13]=a=>R.value=a),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto",disabled:!u.value},{activator:o(({props:a})=>[l(s,T({modelValue:n.fechaFin,"onUpdate:modelValue":e[10]||(e[10]=f=>n.fechaFin=f),label:"Fecha de Fin","prepend-inner-icon":"mdi-calendar",readonly:"",variant:"outlined",density:"comfortable"},a,{rules:[f=>!!f||"La fecha de fin es requerida",f=>!n.fechaInicio||f>=n.fechaInicio||"La fecha de fin debe ser posterior a la fecha de inicio"],required:"",disabled:!u.value}),null,16,["modelValue","rules","disabled"])]),default:o(()=>[l(h,{modelValue:n.fechaFin,"onUpdate:modelValue":[e[11]||(e[11]=a=>n.fechaFin=a),e[12]||(e[12]=a=>R.value=!1)]},null,8,["modelValue"])]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),l(p,null,{default:o(()=>[l(i,{cols:"12",sm:"6"},{default:o(()=>[l(s,{modelValue:n.responsable,"onUpdate:modelValue":e[14]||(e[14]=a=>n.responsable=a),label:"Responsable",hint:"Nombre del responsable del inventario","persistent-hint":"",variant:"outlined",density:"comfortable",rules:[a=>!!a||"El responsable es requerido"],required:"",disabled:!u.value},null,8,["modelValue","rules","disabled"])]),_:1}),l(i,{cols:"12",sm:"6"},{default:o(()=>[l(s,{modelValue:n.cargoResponsable,"onUpdate:modelValue":e[15]||(e[15]=a=>n.cargoResponsable=a),label:"Cargo del Responsable",variant:"outlined",density:"comfortable",disabled:!u.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),l(p,null,{default:o(()=>[l(i,{cols:"12"},{default:o(()=>[l(ee,{modelValue:n.observaciones,"onUpdate:modelValue":e[16]||(e[16]=a=>n.observaciones=a),label:"Observaciones",variant:"outlined","auto-grow":"",rows:"3",disabled:!u.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),u.value?(b(),y(p,{key:0,class:"mt-4"},{default:o(()=>[l(i,{cols:"12",class:"d-flex justify-end"},{default:o(()=>[l(c,{color:"secondary",class:"mr-4",to:{name:"inventario-view",params:{id:E.value.id}}},{default:o(()=>e[36]||(e[36]=[d(" Cancelar ")])),_:1},8,["to"]),l(c,{color:"primary",type:"submit",loading:g.value,disabled:!P.value},{default:o(()=>e[37]||(e[37]=[d(" Guardar Cambios ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})):F("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(D,null,{default:o(()=>[l(S,{class:"d-flex justify-space-between align-center"},{default:o(()=>[e[39]||(e[39]=V("span",{class:"text-h6"},"Detalles del Inventario",-1)),N.value?(b(),y(c,{key:0,color:"primary","prepend-icon":"mdi-plus",onClick:e[18]||(e[18]=a=>M())},{default:o(()=>e[38]||(e[38]=[d(" Agregar Elemento ")])),_:1})):F("",!0)]),_:1}),l(B,null,{default:o(()=>[l(Ue,{headers:re,items:n.detalles||[],loading:g.value,class:"elevation-1"},{"item.estadoConservacion":o(({item:a})=>[l(ke,{color:ie(a.estadoConservacion),"text-color":"white",size:"small"},{default:o(()=>[d(J(a.estadoConservacion),1)]),_:2},1032,["color"])]),"item.actions":o(({item:a})=>[N.value?(b(),y(le,{key:0,text:"Editar"},{activator:o(({props:f})=>[l(c,T({icon:"",size:"small",color:"warning"},f,{onClick:fe=>M(a)}),{default:o(()=>[l(j,null,{default:o(()=>e[40]||(e[40]=[d("mdi-pencil")])),_:1})]),_:2},1040,["onClick"])]),_:2},1024)):F("",!0),N.value?(b(),y(le,{key:1,text:"Eliminar"},{activator:o(({props:f})=>[l(c,T({icon:"",size:"small",color:"error"},f,{class:"ml-2",onClick:fe=>ue(a)}),{default:o(()=>[l(j,null,{default:o(()=>e[41]||(e[41]=[d("mdi-delete")])),_:1})]),_:2},1040,["onClick"])]),_:2},1024)):F("",!0)]),"no-data":o(()=>[V("div",we,[l(j,{size:"large",icon:"mdi-folder-outline",color:"grey"}),e[43]||(e[43]=V("div",{class:"text-body-1 mt-2"},"Este inventario aún no tiene elementos",-1)),N.value?(b(),y(c,{key:0,color:"primary",class:"mt-4",onClick:e[19]||(e[19]=a=>M())},{default:o(()=>e[42]||(e[42]=[d(" Agregar primer elemento ")])),_:1})):F("",!0)])]),_:1},8,["items","loading"])]),_:1})]),_:1})],64)):(b(),y(D,{key:2,class:"pa-5 text-center"},{default:o(()=>[l(j,{size:"large",icon:"mdi-alert-circle",color:"error"}),e[45]||(e[45]=V("div",{class:"text-h6 mt-2"},"Inventario no encontrado",-1)),e[46]||(e[46]=V("div",{class:"text-body-1 mt-2"},"El inventario solicitado no existe o no tienes permiso para editarlo.",-1)),l(c,{color:"primary",class:"mt-4",to:{name:"inventario-list"}},{default:o(()=>e[44]||(e[44]=[d(" Volver al listado ")])),_:1})]),_:1})),l(X,{modelValue:k.value,"onUpdate:modelValue":e[30]||(e[30]=a=>k.value=a),"max-width":"800px"},{default:o(()=>[l(D,null,{default:o(()=>[l(S,null,{default:o(()=>[V("span",qe,J(w.value?"Editar":"Agregar")+" Elemento",1)]),_:1}),l(B,null,{default:o(()=>[l(_,{ref_key:"detalleForm",ref:A,modelValue:$.value,"onUpdate:modelValue":e[28]||(e[28]=a=>$.value=a)},{default:o(()=>[l(p,null,{default:o(()=>[l(i,{cols:"12",sm:"6"},{default:o(()=>[l(s,{modelValue:r.codigo,"onUpdate:modelValue":e[20]||(e[20]=a=>r.codigo=a),label:"Código",variant:"outlined",density:"comfortable",rules:[a=>!!a||"El código es requerido"],required:""},null,8,["modelValue","rules"])]),_:1}),l(i,{cols:"12",sm:"6"},{default:o(()=>[l(s,{modelValue:r.serieDocumental,"onUpdate:modelValue":e[21]||(e[21]=a=>r.serieDocumental=a),label:"Serie Documental",variant:"outlined",density:"comfortable",rules:[a=>!!a||"La serie documental es requerida"],required:""},null,8,["modelValue","rules"])]),_:1})]),_:1}),l(p,null,{default:o(()=>[l(i,{cols:"12"},{default:o(()=>[l(s,{modelValue:r.titulo,"onUpdate:modelValue":e[22]||(e[22]=a=>r.titulo=a),label:"Título",variant:"outlined",density:"comfortable",rules:[a=>!!a||"El título es requerido"],required:""},null,8,["modelValue","rules"])]),_:1})]),_:1}),l(p,null,{default:o(()=>[l(i,{cols:"12",sm:"6"},{default:o(()=>[l(s,{modelValue:r.anosExtremos,"onUpdate:modelValue":e[23]||(e[23]=a=>r.anosExtremos=a),label:"Años Extremos",hint:"Ej: 2010-2015","persistent-hint":"",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1}),l(i,{cols:"12",sm:"6"},{default:o(()=>[l(xe,{modelValue:r.estadoConservacion,"onUpdate:modelValue":e[24]||(e[24]=a=>r.estadoConservacion=a),items:ne,label:"Estado de Conservación",variant:"outlined",density:"comfortable",rules:[a=>!!a||"El estado de conservación es requerido"],required:""},null,8,["modelValue","rules"])]),_:1})]),_:1}),l(p,null,{default:o(()=>[l(i,{cols:"12",sm:"6"},{default:o(()=>[l(s,{modelValue:r.ubicacion,"onUpdate:modelValue":e[25]||(e[25]=a=>r.ubicacion=a),label:"Ubicación",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1}),l(i,{cols:"12",sm:"6"},{default:o(()=>[l(s,{modelValue:r.soporte,"onUpdate:modelValue":e[26]||(e[26]=a=>r.soporte=a),label:"Soporte",hint:"Ej: Papel, Digital, etc.","persistent-hint":"",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1})]),_:1}),l(p,null,{default:o(()=>[l(i,{cols:"12"},{default:o(()=>[l(ee,{modelValue:r.observaciones,"onUpdate:modelValue":e[27]||(e[27]=a=>r.observaciones=a),label:"Observaciones",variant:"outlined","auto-grow":"",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(Y,null,{default:o(()=>[l(Z),l(c,{color:"secondary",onClick:e[29]||(e[29]=a=>k.value=!1)},{default:o(()=>e[47]||(e[47]=[d(" Cancelar ")])),_:1}),l(c,{color:"primary",onClick:de,disabled:!$.value,loading:G.value},{default:o(()=>e[48]||(e[48]=[d(" Guardar ")])),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(X,{modelValue:x.value,"onUpdate:modelValue":e[32]||(e[32]=a=>x.value=a),"max-width":"500"},{default:o(()=>[l(D,null,{default:o(()=>[l(S,{class:"text-h5"},{default:o(()=>e[49]||(e[49]=[d(" Confirmar eliminación ")])),_:1}),l(B,null,{default:o(()=>{var a;return[d(' ¿Está seguro que desea eliminar el elemento "'+J((a=q.value)==null?void 0:a.titulo)+'"? ',1),e[50]||(e[50]=V("div",{class:"red--text mt-2"},"Esta acción no se puede deshacer.",-1))]}),_:1}),l(Y,null,{default:o(()=>[l(Z),l(c,{color:"secondary",onClick:e[31]||(e[31]=a=>x.value=!1)},{default:o(()=>e[51]||(e[51]=[d(" Cancelar ")])),_:1}),l(c,{color:"error",onClick:me,loading:L.value},{default:o(()=>e[52]||(e[52]=[d(" Eliminar ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Me as default};
