import{_ as W,u as G,a as P,r as n,o as j,c as m,w as t,V as F,b as Y,d as l,e as s,f as T,g as D,h as r,i as g,j as h,k as x,l as k,m as q,n as H,p as N,F as J,q as K,s as L,t as S,v as c,x as Q,y as U,z as X}from"./index-DTzO7a71.js";import{u as Z}from"./documents-Dm54GYRR.js";import{u as ee}from"./users-Dkic-ruu.js";import{_ as u}from"./PermissionButton-DANkCNxj.js";import{V as C,a as d}from"./VRow-DteDp9R7.js";import{V as w}from"./VChip-Bftqh3Dm.js";import{V as te}from"./VDataTable-BAdSe95_.js";import"./VSelect-DrkOLv1H.js";import"./VTable-Dw3FHTEb.js";import"./filter-C-DwuyMR.js";const se={key:0,class:"d-flex justify-center align-center pa-4"},ae={class:"text-caption"},oe={class:"text-center pt-2 pb-2"},re={__name:"index",setup(ne){const O=G(),p=Z();ee(),P();const R=Y(),y=n(!1),v=n(!1);n(!1);const V=n({total:0,tags:0});n({total:0});const A=n({total:0,today:0}),E=n([]),_=n([]),b=[{title:"Acción",key:"actionType",align:"center",width:"150"},{title:"Usuario",key:"username",align:"center",width:"150"},{title:"Fecha",key:"timestamp",align:"center",width:"170",sortable:!0}];j(async()=>{await Promise.all([M(),B()])});async function M(){try{y.value=!0;const o=await O.fetchLogs();E.value=o||[];const e=new Date().toISOString().split("T")[0];A.value.today=E.value.filter(a=>a.timestamp&&a.timestamp.startsWith(e)).length,A.value.total=o.length||0}catch(o){console.error("Error al cargar actividades recientes:",o)}finally{y.value=!1}}async function B(){try{v.value=!0,await p.fetchDocuments();const o=[...p.getDocuments()].sort((a,f)=>{const z=new Date(a.uploadDate||a.createdAt||0);return new Date(f.uploadDate||f.createdAt||0)-z});_.value=o.slice(0,5),V.value.total=p.getDocuments().length;const e=new Set;p.getDocuments().forEach(a=>{a.tags&&Array.isArray(a.tags)&&a.tags.forEach(f=>e.add(f.id))}),V.value.tags=e.size}catch(o){console.error("Error al cargar documentos recientes:",o)}finally{v.value=!1}}function I(o){if(!o)return"N/A";const e=new Date(o);return isNaN(e.getTime())?o:e.toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function $(o){return{LOGIN:"success",LOGOUT:"grey",CREATE_DOCUMENT:"primary",UPDATE_DOCUMENT:"info",DELETE_DOCUMENT:"error",DOWNLOAD_DOCUMENT:"purple",VIEW_DOCUMENT:"blue-grey",CREATE_USER:"teal",UPDATE_USER:"amber",DELETE_USER:"deep-orange"}[o]||"grey"}function i(o){R.push({path:o})}return(o,e)=>(l(),m(F,{fluid:""},{default:t(()=>[s(C,{class:"mb-4"},{default:t(()=>[s(d,{cols:"12"},{default:t(()=>[s(T,{elevation:"1",class:"rounded-lg"},{default:t(()=>[s(D,{class:"d-flex align-center"},{default:t(()=>[s(g,{class:"mr-2"},{default:t(()=>e[7]||(e[7]=[r("mdi-lightning-bolt")])),_:1}),e[8]||(e[8]=r(" Acciones Rápidas "))]),_:1}),s(h,null,{default:t(()=>[s(C,{justify:"center",align:"center"},{default:t(()=>[s(d,{cols:"12",sm:"6",md:"3",class:"text-center"},{default:t(()=>[s(u,{permissions:["DOCUMENT_CREATE"],prependIcon:"mdi-magnify",color:"primary",variant:"elevated",size:"large",onClick:e[0]||(e[0]=a=>i("/search-documents")),class:"action-btn"},{default:t(()=>e[9]||(e[9]=[r(" Buscar Documentos ")])),_:1})]),_:1}),s(d,{cols:"12",sm:"6",md:"3",class:"text-center"},{default:t(()=>[s(u,{permissions:["DOCUMENT_CREATE"],prependIcon:"mdi-plus",color:"success",variant:"elevated",size:"large",onClick:e[1]||(e[1]=a=>i("/documents/create")),class:"action-btn"},{default:t(()=>e[10]||(e[10]=[r(" Nuevo Documento ")])),_:1})]),_:1}),s(d,{cols:"12",sm:"6",md:"3",class:"text-center"},{default:t(()=>[s(u,{permissions:["USER_CREATE"],prependIcon:"mdi-account-plus",color:"info",variant:"elevated",size:"large",onClick:e[2]||(e[2]=a=>i("/users/create")),class:"action-btn"},{default:t(()=>e[11]||(e[11]=[r(" Nuevo Usuario ")])),_:1})]),_:1}),s(d,{cols:"12",sm:"6",md:"3",class:"text-center"},{default:t(()=>[s(u,{permissions:["ACTIVITY_LOG_VIEW"],prependIcon:"mdi-history",color:"warning",variant:"elevated",size:"large",onClick:e[3]||(e[3]=a=>i("/activity-logs")),class:"action-btn"},{default:t(()=>e[12]||(e[12]=[r(" Ver Actividades ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(C,null,{default:t(()=>[s(d,{cols:"12",md:"6"},{default:t(()=>[s(T,{elevation:"1",class:"rounded-lg",height:"100%"},{default:t(()=>[s(D,{class:"d-flex align-center"},{default:t(()=>[s(g,{class:"mr-2"},{default:t(()=>e[13]||(e[13]=[r("mdi-file-document-multiple")])),_:1}),e[14]||(e[14]=r(" Documentos Recientes ")),s(k),s(u,{permissions:["DOCUMENT_VIEW"],prependIcon:"mdi-eye",iconButton:!0,color:"primary",onClick:e[4]||(e[4]=a=>i("/documents"))})]),_:1}),v.value?(l(),x("div",se,[s(q,{indeterminate:"",color:"primary"})])):(l(),m(H,{key:1},{default:t(()=>[(l(!0),x(J,null,K(_.value,a=>(l(),m(L,{key:a.id,to:{path:`/documents/${a.id}`},class:"rounded my-1"},{prepend:t(()=>[s(X,{color:"grey-lighten-3",class:"mr-2"},{default:t(()=>[s(g,{color:"primary"},{default:t(()=>e[15]||(e[15]=[r("mdi-file-document-outline")])),_:1})]),_:1})]),default:t(()=>[s(S,null,{default:t(()=>[r(c(a.title),1)]),_:2},1024),s(Q,null,{default:t(()=>[U("span",ae,c(I(a.uploadDate)),1),a.type?(l(),m(w,{key:0,size:"x-small",class:"ml-2"},{default:t(()=>[r(c(a.type.name),1)]),_:2},1024)):N("",!0)]),_:2},1024)]),_:2},1032,["to"]))),128)),_.value.length===0?(l(),m(L,{key:0},{default:t(()=>[s(S,{class:"text-center text-grey"},{default:t(()=>e[16]||(e[16]=[r("No hay documentos disponibles")])),_:1})]),_:1})):N("",!0)]),_:1}))]),_:1})]),_:1}),s(d,{cols:"12",md:"6"},{default:t(()=>[s(T,{elevation:"1",class:"rounded-lg",height:"100%"},{default:t(()=>[s(D,{class:"d-flex align-center"},{default:t(()=>[s(g,{class:"mr-2"},{default:t(()=>e[17]||(e[17]=[r("mdi-history")])),_:1}),e[18]||(e[18]=r(" Actividades Recientes ")),s(k),s(u,{permissions:["ACTIVITY_LOG_VIEW"],prependIcon:"mdi-history",iconButton:!0,color:"warning",onClick:e[5]||(e[5]=a=>i("/activity-logs"))})]),_:1}),s(te,{headers:b,items:E.value,"items-per-page":5,"sort-by":[{key:"timestamp",order:"desc"}],class:"elevation-0",loading:y.value},{"item.actionType":t(({item:a})=>[s(w,{color:$(a.actionType),size:"small",class:"text-uppercase"},{default:t(()=>[r(c(a.actionType),1)]),_:2},1032,["color"])]),"item.user":t(({item:a})=>[r(c(a.user?a.user.username:"Sistema"),1)]),"item.timestamp":t(({item:a})=>[r(c(I(a.timestamp)),1)]),bottom:t(()=>[U("div",oe,[s(u,{permissions:["ACTIVITY_LOG_VIEW"],prependIcon:"mdi-history",iconButton:!0,color:"warning",onClick:e[6]||(e[6]=a=>i("/activity-logs"))})])]),_:1},8,["items","loading"])]),_:1})]),_:1})]),_:1})]),_:1}))}},Ee=W(re,[["__scopeId","data-v-5c2c0a90"]]);export{Ee as default};
