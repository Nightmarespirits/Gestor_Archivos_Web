import{J as X,r as l,u as Y,bb as b,K as f,bc as O}from"./index-DTzO7a71.js";const ee=X("documents",()=>{const i=l([]),v=l(null),r=l(!1),u=l(null),h=l([]),w=l([]),P=l(["Privado","Reservado","Secreto"]),m=Y(),y=new Map,S=t=>`${b}/documents/download/${t}`;function R(){return i.value}function z(){return v.value}function C(){return r.value}function F(){return u.value}function I(){return h.value}function B(){return w.value}function N(){return P.value}function j(t){switch(t){case"Secreto":return"red";case"Reservado":return"orange";case"Privado":default:return"green"}}const c=l({page:0,size:10,totalItems:0,totalPages:0}),d=l({sortBy:"id",direction:"asc"});async function T(){try{r.value=!0;const t=await f.get("/documents",{debug:!0});i.value=t||[]}catch(t){u.value=t.message,console.error("fetchDocuments Error:",t),i.value=[]}finally{r.value=!1}}async function _(t={}){try{r.value=!0;const{page:e=c.value.page,size:a=c.value.size,sortBy:s=d.value.sortBy,direction:o=d.value.direction,filters:n={}}=t;c.value.page=e,c.value.size=a,d.value.sortBy=s,d.value.direction=o;const p=await f.getPaginated("/documents/paginated",{page:e,pageSize:a,sortBy:s,sortDirection:o,filters:n,debug:!0});return i.value=p.content||[],c.value.totalItems=p.totalElements||0,c.value.totalPages=p.totalPages||0,{items:i.value,pagination:{...c.value}}}catch(e){return u.value=e.message,console.error("fetchPaginatedDocuments Error:",e),i.value=[],{items:[],pagination:{...c.value,totalItems:0,totalPages:0}}}finally{r.value=!1}}async function J(t={},e={}){try{r.value=!0;const{title:a,description:s,author:o,fromDate:n,toDate:p,documentTypeId:A,tags:L}=t,{page:$=c.value.page,size:U=c.value.size,sortBy:Q=d.value.sortBy,direction:V=d.value.direction}=e,g={};a&&(g.title=a),s&&(g.description=s),o&&(g.author=o),n&&(g.fromDate=n),p&&(g.toDate=p),A&&(g.documentTypeId=A),L&&L.length>0&&(g.tags=L);const E=await f.getPaginated("/documents/search",{page:$,pageSize:U,sortBy:Q,sortDirection:V,filters:g,debug:!0});return i.value=E.content||[],c.value={page:$,size:U,totalItems:E.totalElements||0,totalPages:E.totalPages||0},{items:i.value,pagination:{...c.value}}}catch(a){return u.value=a.message,console.error("searchDocumentsPaginated Error:",a),i.value=[],{items:[],pagination:{...c.value,totalItems:0,totalPages:0}}}finally{r.value=!1}}async function D(t){try{r.value=!0;const e=await f.get(`/documents/${t}`);return v.value=e,e}catch(e){throw u.value=e.message,e}finally{r.value=!1}}async function M(t){try{r.value=!0;const e=t instanceof FormData?t:new FormData;t instanceof FormData||Object.keys(t).forEach(s=>{if(s==="file")e.append("file",t.file);else if(s==="tags"&&Array.isArray(t.tags))t.tags.forEach(o=>{e.append("tags",o)});else if(s==="security"){if(t.security&&t.security.accessLevel){const o=JSON.stringify(t.security);e.append("security",o)}}else e.append(s,t[s])}),e.has("security.accessLevel")||e.append("security.accessLevel","Privado");const a=await f.post("/documents",e,{isFormData:!0});return await m.createActivityLog("CREATE_DOCUMENT",`Documento "${a.title}" creado`,a.id),a}catch(e){throw u.value=e.message,e}finally{r.value=!1}}async function x(t,e){try{r.value=!0;const a=e instanceof FormData?e:new FormData;e instanceof FormData||Object.keys(e).forEach(o=>{if(o==="file")e.file&&a.append("file",e.file);else if(o==="tags"&&Array.isArray(e.tags))e.tags.forEach(n=>{a.append("tags",n)});else if(o==="security"){if(e.security&&e.security.accessLevel){const n=JSON.stringify(e.security);a.append("security",n)}}else a.append(o,e[o])}),!a.has("security.accessLevel")&&v.value&&v.value.security?a.append("security.accessLevel",v.value.security.accessLevel):a.has("security.accessLevel")||a.append("security.accessLevel","Privado");const s=await f.put(`/documents/${t}`,a,{isFormData:!0,debug:!0});return await m.createActivityLog("UPDATE_DOCUMENT",`Documento "${s.title}" actualizado`,s.id),s}catch(a){throw u.value=a.message,console.error("[updateDocument] Error:",a),a}finally{r.value=!1}}async function G(t){try{r.value=!0;const e=await D(t);return await f.delete(`/documents/${t}`),await m.createActivityLog("DELETE_DOCUMENT",`Documento "${e.title}" eliminado`,t),await T(),!0}catch(e){throw u.value=e.message,e}finally{r.value=!1}}async function H(t){try{r.value=!0;let e=v.value;(!e||e.id!==t)&&(await D(t),e=v.value);const a=await fetch(`${b}/documents/download/${t}`,{method:"GET",headers:O.getAuthHeaders(!1)});if(!a.ok)throw new Error(`Error ${a.status}: ${a.statusText}`);await m.createActivityLog("DOWNLOAD_DOCUMENT",`Documento "${e.title}" descargado`,t);const s=await a.blob(),o=window.URL.createObjectURL(s),n=document.createElement("a");return n.href=o,n.download=e.title||"documento",document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(o),!0}catch(e){throw u.value=e.message,e}finally{r.value=!1}}async function K(t){try{if(r.value=!0,y.has(t))return y.get(t);const e=await fetch(`${b}/documents/download/${t}`,{method:"GET",headers:O.getAuthHeaders(!1)});if(!e.ok)throw new Error(`Error ${e.status}: ${e.statusText}`);const a=await e.blob(),s=a.type||e.headers.get("content-type")||"application/octet-stream",n={url:URL.createObjectURL(a),mimeType:s};return y.set(t,n),n}catch(e){throw u.value=e.message,e}finally{r.value=!1}}function W(t){const e=y.get(t);e&&(URL.revokeObjectURL(e.url),y.delete(t))}async function k(){try{r.value=!0;const t=await f.get("/document-types");return h.value=t,t}catch(t){throw u.value=t.message,t}finally{r.value=!1}}async function q(){try{r.value=!0;const t=await f.get("/tags");return w.value=t,t}catch(t){throw u.value=t.message,t}finally{r.value=!1}}return{documents:i,currentDocument:v,loading:r,error:u,documentTypes:h,tags:w,previewCache:y,accessLevels:P,pagination:c,sortOptions:d,getDocuments:R,getCurrentDocument:z,isLoading:C,getError:F,getDocumentTypes:I,getTags:B,getDocumentDownloadUrl:S,getAccessLevels:N,getSecurityLevelColor:j,fetchDocuments:T,fetchPaginatedDocuments:_,searchDocumentsPaginated:J,fetchDocumentById:D,createDocument:M,updateDocument:x,deleteDocument:G,downloadDocument:H,getFilePreview:K,revokePreviewUrl:W,fetchDocumentTypes:k,fetchTags:q}});export{ee as u};
