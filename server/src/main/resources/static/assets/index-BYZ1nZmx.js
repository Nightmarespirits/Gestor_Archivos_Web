import{u as R,r,A as H,B as G,o as $,c as j,w as t,V as z,d as J,e as a,f as W,g as q,y as E,l as K,C as T,j as Q,D as L,E as x,G as D,h as m,H as w,v as U,I as X}from"./index-DTzO7a71.js";import{V as k,a as f}from"./VRow-DteDp9R7.js";import{V as A}from"./VSelect-DrkOLv1H.js";import{V as b}from"./VDatePicker-CEVfHtFV.js";import{V as Y,a as Z}from"./VDataTable-BAdSe95_.js";import{f as h}from"./index-DlVYjeeE.js";import{l as _}from"./index-BAhycYih.js";import"./VChip-Bftqh3Dm.js";import"./VSheet-D3msx1cx.js";import"./VTable-Dw3FHTEb.js";import"./filter-C-DwuyMR.js";const ee={class:"d-flex align-center justify-end mt-4"},ve={__name:"index",setup(le){const s=R(),d=r(""),p=r(1),v=r(20),c=r(null),u=r(null),i=r(null),V=r(!1),y=r(!1),n=r(!1),P=["LOGIN","LOGOUT","CREATE_DOCUMENT","UPDATE_DOCUMENT","DELETE_DOCUMENT","DOWNLOAD_DOCUMENT","CREATE_USER","UPDATE_USER","DELETE_USER"],S=[{title:"ID",align:"start",key:"id"},{title:"Usuario",key:"user"},{title:"Tipo de Acci칩n",key:"actionType"},{title:"Fecha y Hora",key:"timestamp",sortable:!0},{title:"Direcci칩n IP",key:"ipAddress"}],O=H(()=>d.value?s.logs.filter(o=>o.description.toLowerCase().includes(d.value.toLowerCase())||o.actionType.toLowerCase().includes(d.value.toLowerCase())||o.user.username.toLowerCase().includes(d.value.toLowerCase())):s.logs),M=o=>h(new Date(o),"dd/MM/yyyy HH:mm:ss",{locale:_}),g=async o=>{try{await s.fetchLogs({page:o-1,size:v.value})}catch{n.value=!0}},N=async()=>{p.value=1;try{await s.fetchLogs({page:0,size:v.value})}catch{n.value=!0}},I=async()=>{if(c.value)try{await s.fetchLogsByActionType(c.value)}catch{n.value=!0}else g(p.value)},B=async()=>{if(u.value&&i.value)try{const o=new Date(u.value).toISOString(),e=new Date(i.value).toISOString();await s.fetchLogsByTimeRange(o,e)}catch{n.value=!0}},F=()=>{d.value="",c.value=null,u.value=null,i.value=null,p.value=1,g(1)};return G(()=>s.error,o=>{o&&(n.value=!0)}),$(async()=>{try{await s.fetchLogs(),console.log(JSON.stringify(s.logs,null,3))}catch{n.value=!0}}),(o,e)=>(J(),j(z,{fluid:""},{default:t(()=>[a(k,null,{default:t(()=>[a(f,{cols:"12"},{default:t(()=>[a(W,null,{default:t(()=>[a(q,{class:"d-flex align-center"},{default:t(()=>[e[14]||(e[14]=E("span",{class:"text-h5"},"Historial de Actividades",-1)),a(K),a(T,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=l=>d.value=l),"append-icon":"mdi-magnify",label:"Buscar","single-line":"","hide-details":"",density:"compact",class:"ml-2",style:{"max-width":"300px"}},null,8,["modelValue"])]),_:1}),a(Q,null,{default:t(()=>[a(k,{class:"mb-4"},{default:t(()=>[a(f,{cols:"12",sm:"6",md:"3"},{default:t(()=>[a(A,{modelValue:c.value,"onUpdate:modelValue":[e[1]||(e[1]=l=>c.value=l),I],items:P,label:"Tipo de Acci칩n",clearable:""},null,8,["modelValue"])]),_:1}),a(f,{cols:"12",sm:"6",md:"3"},{default:t(()=>[a(L,{modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=l=>V.value=l),"close-on-content-click":!1},{activator:t(({props:l})=>[a(T,x({modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=C=>u.value=C),label:"Fecha Inicio","prepend-icon":"mdi-calendar",readonly:""},l),null,16,["modelValue"])]),default:t(()=>[a(b,{modelValue:u.value,"onUpdate:modelValue":[e[3]||(e[3]=l=>u.value=l),e[4]||(e[4]=l=>V.value=!1)]},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),a(f,{cols:"12",sm:"6",md:"3"},{default:t(()=>[a(L,{modelValue:y.value,"onUpdate:modelValue":e[9]||(e[9]=l=>y.value=l),"close-on-content-click":!1},{activator:t(({props:l})=>[a(T,x({modelValue:i.value,"onUpdate:modelValue":e[6]||(e[6]=C=>i.value=C),label:"Fecha Fin","prepend-icon":"mdi-calendar",readonly:""},l),null,16,["modelValue"])]),default:t(()=>[a(b,{modelValue:i.value,"onUpdate:modelValue":[e[7]||(e[7]=l=>i.value=l),e[8]||(e[8]=l=>y.value=!1)]},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),a(f,{cols:"12",sm:"6",md:"3",class:"d-flex align-center"},{default:t(()=>[a(D,{color:"primary",onClick:B,disabled:!u.value||!i.value},{default:t(()=>e[15]||(e[15]=[m(" Aplicar Filtro ")])),_:1},8,["disabled"]),a(D,{class:"ml-2",onClick:F,variant:"outlined"},{default:t(()=>e[16]||(e[16]=[m(" Limpiar ")])),_:1})]),_:1})]),_:1}),a(Y,{headers:S,items:O.value,loading:w(s).loading,"items-per-page":v.value,"sort-by":[{key:"timestamp",order:"desc"}],class:"elevation-1"},{"item.timestamp":t(({item:l})=>[m(U(M(l.timestamp)),1)]),"item.user":t(({item:l})=>[m(U(l.username),1)]),_:1},8,["items","loading","items-per-page"]),E("div",ee,[a(Z,{modelValue:p.value,"onUpdate:modelValue":[e[10]||(e[10]=l=>p.value=l),g],length:w(s).pagination.totalPages},null,8,["modelValue","length"]),a(A,{modelValue:v.value,"onUpdate:modelValue":[e[11]||(e[11]=l=>v.value=l),N],items:[10,20,50,100],label:"Items por p치gina",style:{"max-width":"150px"},class:"ml-4"},null,8,["modelValue"])])]),_:1})]),_:1}),a(X,{modelValue:n.value,"onUpdate:modelValue":e[13]||(e[13]=l=>n.value=l),color:"error",timeout:"5000"},{actions:t(()=>[a(D,{color:"white",variant:"text",onClick:e[12]||(e[12]=l=>n.value=!1)},{default:t(()=>e[17]||(e[17]=[m(" Cerrar ")])),_:1})]),default:t(()=>[m(U(w(s).error)+" ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{ve as default};
