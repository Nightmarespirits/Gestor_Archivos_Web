import{aw as le,r as g,aF as P,A as ne,o as oe,c as f,w as t,V as ie,d as p,e as l,f as h,g as L,y as w,p as v,G as u,h as r,j as T,C as F,aH as Z,D as U,E as I,i as D,n as re,s as x,as as se,v as O,ao as de,av as ue,l as ce,I as me}from"./index-DTzO7a71.js";import{u as fe}from"./inventarios-mEqQ-Uto.js";import{V as j,a as C}from"./VRow-DteDp9R7.js";import{V as pe}from"./VSelect-DrkOLv1H.js";import{V as H}from"./VDatePicker-CEVfHtFV.js";import{V as ve}from"./VDataTable-BAdSe95_.js";import{V as S}from"./VTooltip-ZPSecc-u.js";import{V as Ve}from"./VChip-Bftqh3Dm.js";import"./VSheet-D3msx1cx.js";import"./VTable-Dw3FHTEb.js";import"./filter-C-DwuyMR.js";const ye={class:"text-center pa-5"},Be={__name:"index",setup(ge){const A=fe();le();const V=g({show:!1,text:"",color:"success",timeout:3e3}),c=g(!1),k=g(!1),b=g(null),R=g(!1),E=g(!1),o=P({titulo:"",unidadAdministrativa:"",fechaInicio:null,fechaFin:null,estado:null}),K=["BORRADOR","FINALIZADO","APROBADO"],d=P({page:0,size:10,totalItems:0,totalPages:0}),y=P({sortBy:"id",direction:"desc"}),G=[{title:"ID",key:"id",sortable:!0},{title:"Título",key:"titulo",sortable:!0},{title:"Dependencia",key:"dependencia",sortable:!0},{title:"Fecha de Creación",key:"fechaCreacion",sortable:!0},{title:"Estado",key:"estado",sortable:!0},{title:"Responsable",key:"responsable",sortable:!0},{title:"Acciones",key:"actions",sortable:!1}],M=[{id:1,titulo:"Inventario 1",dependencia:"Dependencia 1",fechaCreacion:"2023-01-01",estado:"BORRADOR",responsable:"Responsable 1"},{id:2,titulo:"Inventario 2",dependencia:"Dependencia 2",fechaCreacion:"2023-02-01",estado:"FINALIZADO",responsable:"Responsable 2"},{id:3,titulo:"Inventario 3",dependencia:"Dependencia 3",fechaCreacion:"2023-03-01",estado:"APROBADO",responsable:"Responsable 3"}],z=ne(()=>!0);function q(n){return!0}function J(n){return!0}function B(n){return!0}async function s(){try{c.value=!0;const n=await A.searchInventariosPaginated(o,{page:d.page,size:d.size,sortBy:y.sortBy,direction:y.direction});n&&(d.totalItems=n.pagination.totalItems,d.totalPages=n.pagination.totalPages)}catch(n){m("Error al cargar inventarios: "+n.message,"error")}finally{c.value=!1}}function m(n,e="success",a=3e3){V.value={show:!0,text:n,color:e,timeout:a}}function Q(){o.titulo="",o.unidadAdministrativa="",o.fechaInicio=null,o.fechaFin=null,o.estado=null,s()}function W(n){if(!n)return"";const e=new Date(n);return new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}).format(e)}function X(n){b.value=n,k.value=!0}async function Y(){if(b.value)try{c.value=!0,await A.deleteInventario(b.value.id)?(m("Inventario eliminado correctamente","success"),k.value=!1,b.value=null,await s()):m("Error al eliminar el inventario","error")}catch(n){m("Error al eliminar: "+n.message,"error")}finally{c.value=!1}}function _(n){if(!n)return"grey";switch(n.toUpperCase()){case"BORRADOR":return"blue";case"FINALIZADO":return"green";case"APROBADO":return"purple";case"RECHAZADO":return"red";case"EN_REVISION":return"orange";default:return"grey"}}async function N(n,e){try{c.value=!0,await A.downloadInventario(n,e)||m(`Error al descargar el inventario en formato ${e}`,"error")}catch(a){m("Error al descargar: "+a.message,"error")}finally{c.value=!1}}async function $(n,e){try{c.value=!0,await A.changeInventarioState(n,e),m(`Estado del inventario actualizado a ${e}`,"success"),await s()}catch(a){m("Error al cambiar el estado: "+a.message,"error")}finally{c.value=!1}}function ee(n){d.page=n-1,s()}function ae(n){d.size=n,d.page=0,s()}function te(n){if(n.length>0){const[e]=n;y.sortBy=e.key,y.direction=e.order}else y.sortBy="id",y.direction="desc";s()}return oe(async()=>{await s()}),(n,e)=>(p(),f(ie,{fluid:""},{default:t(()=>[l(h,null,{default:t(()=>[l(L,{class:"d-flex justify-space-between align-center"},{default:t(()=>[e[17]||(e[17]=w("span",null,"Gestión de Inventarios",-1)),z.value?(p(),f(u,{key:0,color:"primary","prepend-icon":"mdi-plus",to:{name:"inventario-create"}},{default:t(()=>e[16]||(e[16]=[r(" Nuevo Inventario ")])),_:1})):v("",!0)]),_:1}),l(T,null,{default:t(()=>[l(j,null,{default:t(()=>[l(C,{cols:"12",sm:"4"},{default:t(()=>[l(F,{modelValue:o.titulo,"onUpdate:modelValue":e[0]||(e[0]=a=>o.titulo=a),label:"Buscar por título","hide-details":"",density:"compact",variant:"outlined","prepend-inner-icon":"mdi-magnify",onKeyup:Z(s,["enter"]),clearable:""},null,8,["modelValue"])]),_:1}),l(C,{cols:"12",sm:"4"},{default:t(()=>[l(F,{modelValue:o.unidadAdministrativa,"onUpdate:modelValue":e[1]||(e[1]=a=>o.unidadAdministrativa=a),label:"Unidad Administrativa","hide-details":"",density:"compact",variant:"outlined",clearable:"",onKeyup:Z(s,["enter"])},null,8,["modelValue"])]),_:1}),l(C,{cols:"12",sm:"4"},{default:t(()=>[l(pe,{modelValue:o.estado,"onUpdate:modelValue":[e[2]||(e[2]=a=>o.estado=a),s],items:K,label:"Estado","hide-details":"",density:"compact",variant:"outlined",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(j,{class:"mt-2"},{default:t(()=>[l(C,{cols:"12",sm:"4"},{default:t(()=>[l(U,{modelValue:R.value,"onUpdate:modelValue":e[7]||(e[7]=a=>R.value=a),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:t(({props:a})=>[l(F,I({modelValue:o.fechaInicio,"onUpdate:modelValue":e[3]||(e[3]=i=>o.fechaInicio=i),label:"Fecha Desde","prepend-inner-icon":"mdi-calendar",readonly:"",density:"compact",variant:"outlined","hide-details":""},a,{clearable:"","onClick:clear":e[4]||(e[4]=i=>o.fechaInicio=null)}),null,16,["modelValue"])]),default:t(()=>[l(H,{modelValue:o.fechaInicio,"onUpdate:modelValue":[e[5]||(e[5]=a=>o.fechaInicio=a),e[6]||(e[6]=a=>R.value=!1)]},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(C,{cols:"12",sm:"4"},{default:t(()=>[l(U,{modelValue:E.value,"onUpdate:modelValue":e[12]||(e[12]=a=>E.value=a),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:t(({props:a})=>[l(F,I({modelValue:o.fechaFin,"onUpdate:modelValue":e[8]||(e[8]=i=>o.fechaFin=i),label:"Fecha Hasta","prepend-inner-icon":"mdi-calendar",readonly:"",density:"compact",variant:"outlined","hide-details":""},a,{clearable:"","onClick:clear":e[9]||(e[9]=i=>o.fechaFin=null)}),null,16,["modelValue"])]),default:t(()=>[l(H,{modelValue:o.fechaFin,"onUpdate:modelValue":[e[10]||(e[10]=a=>o.fechaFin=a),e[11]||(e[11]=a=>E.value=!1)]},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(C,{cols:"12",sm:"4",class:"d-flex justify-end align-center"},{default:t(()=>[l(u,{color:"primary",onClick:s,"prepend-icon":"mdi-filter",class:"mr-2"},{default:t(()=>e[18]||(e[18]=[r(" Filtrar ")])),_:1}),l(u,{color:"secondary",onClick:Q,"prepend-icon":"mdi-refresh"},{default:t(()=>e[19]||(e[19]=[r(" Limpiar ")])),_:1})]),_:1})]),_:1}),l(ve,{headers:G,items:M,loading:c.value,"items-per-page":d.size,page:d.page+1,"server-items-length":d.totalItems,"onUpdate:page":ee,"onUpdate:itemsPerPage":ae,"onUpdate:sortBy":te,class:"mt-4"},{"item.estado":t(({item:a})=>[l(Ve,{color:_(a.estado),"text-color":"white",size:"small"},{default:t(()=>[r(O(a.estado),1)]),_:2},1032,["color"])]),"item.fechaCreacion":t(({item:a})=>[r(O(W(a.fechaCreacion)),1)]),"item.actions":t(({item:a})=>[l(S,{text:"Ver detalles"},{activator:t(({props:i})=>[l(u,I({icon:"",size:"small",color:"info"},i,{to:{name:"inventario-view",params:{id:a.id}}}),{default:t(()=>[l(D,null,{default:t(()=>e[20]||(e[20]=[r("mdi-eye")])),_:1})]),_:2},1040,["to"])]),_:2},1024),q(a)?(p(),f(S,{key:0,text:"Editar"},{activator:t(({props:i})=>[l(u,I({icon:"",size:"small",color:"warning"},i,{class:"ml-2",to:{name:"inventario-edit",params:{id:a.id}}}),{default:t(()=>[l(D,null,{default:t(()=>e[21]||(e[21]=[r("mdi-pencil")])),_:1})]),_:2},1040,["to"])]),_:2},1024)):v("",!0),J(a)?(p(),f(S,{key:1,text:"Eliminar"},{activator:t(({props:i})=>[l(u,I({icon:"",size:"small",color:"error"},i,{class:"ml-2",onClick:Ie=>X(a)}),{default:t(()=>[l(D,null,{default:t(()=>e[22]||(e[22]=[r("mdi-delete")])),_:1})]),_:2},1040,["onClick"])]),_:2},1024)):v("",!0),l(U,null,{activator:t(({props:i})=>[l(u,I({icon:"",size:"small"},i,{class:"ml-2"}),{default:t(()=>[l(D,null,{default:t(()=>e[23]||(e[23]=[r("mdi-dots-vertical")])),_:1})]),_:2},1040)]),default:t(()=>[l(re,{dense:""},{default:t(()=>[l(x,{onClick:i=>N(a.id,"excel"),"prepend-icon":"mdi-file-excel",title:"Descargar Excel"},null,8,["onClick"]),l(x,{onClick:i=>N(a.id,"pdf"),"prepend-icon":"mdi-file-pdf-box",title:"Descargar PDF"},null,8,["onClick"]),B(a)?(p(),f(se,{key:0})):v("",!0),a.estado==="BORRADOR"&&B(a)?(p(),f(x,{key:1,onClick:i=>$(a.id,"FINALIZADO"),"prepend-icon":"mdi-check-circle",title:"Finalizar inventario"},null,8,["onClick"])):v("",!0),a.estado==="FINALIZADO"&&B(a)?(p(),f(x,{key:2,onClick:i=>$(a.id,"APROBADO"),"prepend-icon":"mdi-check-circle-outline",title:"Aprobar inventario"},null,8,["onClick"])):v("",!0)]),_:2},1024)]),_:2},1024)]),"no-data":t(()=>[w("div",ye,[l(D,{size:"large",icon:"mdi-file-document-outline",color:"grey"}),e[25]||(e[25]=w("div",{class:"text-body-1 mt-2"},"No se encontraron inventarios",-1)),z.value?(p(),f(u,{key:0,color:"primary",class:"mt-4",to:{name:"inventario-create"}},{default:t(()=>e[24]||(e[24]=[r(" Crear nuevo inventario ")])),_:1})):v("",!0)])]),_:1},8,["loading","items-per-page","page","server-items-length"])]),_:1})]),_:1}),l(de,{modelValue:k.value,"onUpdate:modelValue":e[14]||(e[14]=a=>k.value=a),"max-width":"500"},{default:t(()=>[l(h,null,{default:t(()=>[l(L,{class:"text-h5"},{default:t(()=>e[26]||(e[26]=[r(" Confirmar eliminación ")])),_:1}),l(T,null,{default:t(()=>{var a;return[r(' ¿Está seguro que desea eliminar el inventario "'+O((a=b.value)==null?void 0:a.titulo)+'"? ',1),e[27]||(e[27]=w("div",{class:"red--text mt-2"},"Esta acción no se puede deshacer.",-1))]}),_:1}),l(ue,null,{default:t(()=>[l(ce),l(u,{color:"secondary",onClick:e[13]||(e[13]=a=>k.value=!1)},{default:t(()=>e[28]||(e[28]=[r(" Cancelar ")])),_:1}),l(u,{color:"error",onClick:Y},{default:t(()=>e[29]||(e[29]=[r(" Eliminar ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(me,{modelValue:V.value.show,"onUpdate:modelValue":e[15]||(e[15]=a=>V.value.show=a),color:V.value.color,timeout:V.value.timeout},{default:t(()=>[r(O(V.value.text),1)]),_:1},8,["modelValue","color","timeout"])]),_:1}))}};export{Be as default};
