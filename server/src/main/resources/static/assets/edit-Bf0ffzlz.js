import{aw as B,A as n,aU as N,r as f,o as U,B as k,c as d,w as o,V as I,b as _,d as m,e as l,f as P,g as z,y as q,G as V,h as g,j as F,p as x,aq as G,C as p}from"./index-DTzO7a71.js";import{u as L}from"./registro-transferencia-D8l4MZon.js";import{V as j}from"./VAlert-WIuVYfyH.js";import{V as M}from"./VSkeletonLoader-DHz2ZGEv.js";import{V as h}from"./VForm-Cr0IhdhJ.js";import{V as $,a as s}from"./VRow-DteDp9R7.js";import{V as b}from"./VSelect-DrkOLv1H.js";import{V as Z}from"./VTextarea-BbRLHrOO.js";import"./VChip-Bftqh3Dm.js";const H={class:"d-flex flex-column flex-sm-row gap-2 mt-5"},oe={__name:"edit",setup(J){const T=N(),C=_(),c=L(),R=B(),i=n(()=>T.params.id),D=n(()=>c.isLoading()),u=f(null),y=f(null),v=n(()=>c.getCurrentRegistroTransferencia()),r=f({codigo:"",numero:"",fecha:"",dependenciaOrigen:null,dependenciaDestino:null,responsable:"",totalDocumentos:0,observaciones:"",estado:"BORRADOR"}),O=f([{id:1,nombre:"Dirección General"},{id:2,nombre:"Departamento de Archivo"},{id:3,nombre:"Departamento de Logística"},{id:4,nombre:"Departamento de Administración"}]),A=n(()=>R.hasPermission("APROBAR_REGISTROS")),S=n(()=>R.hasPermission("EDITAR_ESTADO_REGISTROS")||A.value),E=n(()=>{const t=["BORRADOR","FINALIZADO"];return A.value&&t.push("APROBADO"),t});U(async()=>{try{await c.fetchRegistroTransferenciaById(i.value),v.value||(u.value="No se encontró el registro de transferencia solicitado")}catch(t){u.value=`Error al cargar el registro: ${t.message}`}}),k(v,t=>{if(t&&(r.value={...t},r.value.fecha&&typeof r.value.fecha=="string")){const a=new Date(r.value.fecha);isNaN(a.getTime())||(r.value.fecha=a.toISOString().substr(0,10))}},{immediate:!0});async function w(){if(y.value.validate())try{await c.updateRegistroTransferencia(i.value,r.value)&&(alert("Registro de transferencia actualizado con éxito"),C.push({name:"registro-transferencia-detalle",params:{id:i.value}}))}catch(t){u.value=`Error al actualizar el registro: ${t.message}`,console.error("Error:",t)}}return(t,a)=>(m(),d(I,{fluid:""},{default:o(()=>[l(P,null,{default:o(()=>[l(z,{class:"d-flex justify-space-between"},{default:o(()=>[a[9]||(a[9]=q("span",null,"Editar Registro de Transferencia",-1)),l(V,{color:"error",variant:"outlined","prepend-icon":"mdi-arrow-left",to:{name:"registro-transferencia-detalle",params:{id:i.value}},class:"ml-2"},{default:o(()=>a[8]||(a[8]=[g(" Cancelar ")])),_:1},8,["to"])]),_:1}),l(F,null,{default:o(()=>[u.value?(m(),d(j,{key:0,type:"error",title:"Error",text:u.value,class:"mb-4"},null,8,["text"])):x("",!0),D.value&&!v.value?(m(),d(M,{key:1,type:"card-heading, form"})):(m(),d(h,{key:2,ref_key:"form",ref:y,onSubmit:G(w,["prevent"])},{default:o(()=>[l($,null,{default:o(()=>[l(s,{cols:"12",md:"6"},{default:o(()=>[l(p,{modelValue:r.value.codigo,"onUpdate:modelValue":a[0]||(a[0]=e=>r.value.codigo=e),label:"Código",rules:[e=>!!e||"Código es requerido"],required:"",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),l(s,{cols:"12",md:"6"},{default:o(()=>[l(p,{modelValue:r.value.numero,"onUpdate:modelValue":a[1]||(a[1]=e=>r.value.numero=e),label:"Número",rules:[e=>!!e||"Número es requerido"],required:"",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),l(s,{cols:"12",md:"6"},{default:o(()=>[l(p,{modelValue:r.value.fecha,"onUpdate:modelValue":a[2]||(a[2]=e=>r.value.fecha=e),label:"Fecha",type:"date",rules:[e=>!!e||"Fecha es requerida"],required:"",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),l(s,{cols:"12",md:"6"},{default:o(()=>[l(b,{modelValue:r.value.dependenciaOrigen,"onUpdate:modelValue":a[3]||(a[3]=e=>r.value.dependenciaOrigen=e),items:O.value,label:"Dependencia Origen","item-title":"nombre","item-value":"id",rules:[e=>!!e||"Dependencia origen es requerida"],required:"",variant:"outlined"},null,8,["modelValue","items","rules"])]),_:1}),l(s,{cols:"12",md:"6"},{default:o(()=>[l(b,{modelValue:r.value.dependenciaDestino,"onUpdate:modelValue":a[4]||(a[4]=e=>r.value.dependenciaDestino=e),items:O.value,label:"Dependencia Destino","item-title":"nombre","item-value":"id",rules:[e=>!!e||"Dependencia destino es requerida"],required:"",variant:"outlined"},null,8,["modelValue","items","rules"])]),_:1}),l(s,{cols:"12",md:"6"},{default:o(()=>[l(p,{modelValue:r.value.responsable,"onUpdate:modelValue":a[5]||(a[5]=e=>r.value.responsable=e),label:"Responsable",rules:[e=>!!e||"Responsable es requerido"],required:"",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),S.value?(m(),d(s,{key:0,cols:"12",md:"6"},{default:o(()=>[l(b,{modelValue:r.value.estado,"onUpdate:modelValue":a[6]||(a[6]=e=>r.value.estado=e),items:E.value,label:"Estado",rules:[e=>!!e||"Estado es requerido"],required:"",variant:"outlined"},null,8,["modelValue","items","rules"])]),_:1})):x("",!0),l(s,{cols:"12"},{default:o(()=>[l(Z,{modelValue:r.value.observaciones,"onUpdate:modelValue":a[7]||(a[7]=e=>r.value.observaciones=e),label:"Observaciones",variant:"outlined",rows:"3"},null,8,["modelValue"])]),_:1})]),_:1}),q("div",H,[l(V,{color:"primary",type:"submit",size:"large",loading:D.value,"prepend-icon":"mdi-content-save"},{default:o(()=>a[10]||(a[10]=[g(" Guardar Cambios ")])),_:1},8,["loading"]),l(V,{color:"secondary",variant:"outlined",size:"large",to:{name:"registro-transferencia-detalle",params:{id:i.value}}},{default:o(()=>a[11]||(a[11]=[g(" Cancelar ")])),_:1},8,["to"])])]),_:1},512))]),_:1})]),_:1})]),_:1}))}};export{oe as default};
