import{A as Z,aU as L,r,o as h,c as P,w as t,V as ee,b as ae,d as j,e as a,f as A,g as S,y as z,G as V,h as d,j as B,p as le,C as i,i as $,v as w,ao as oe,aq as te,av as ne,l as re,bw as ue}from"./index-DTzO7a71.js";import{u as de}from"./catalogo-transferencia-D9ScGTOQ.js";import{V as ie}from"./VAlert-WIuVYfyH.js";import{V as M,a as u}from"./VRow-DteDp9R7.js";import{V as se}from"./VDataTable-BAdSe95_.js";import{V as me}from"./VForm-Cr0IhdhJ.js";import{V as R}from"./VTextarea-BbRLHrOO.js";import{f as ce}from"./index-DlVYjeeE.js";import"./VSelect-DrkOLv1H.js";import"./VChip-Bftqh3Dm.js";import"./VTable-Dw3FHTEb.js";import"./filter-C-DwuyMR.js";const Ie={__name:"detalles",setup(fe){const G=L();ae();const f=de(),{showSuccess:g,showError:C,showConfirm:O}=ue(),m=Z(()=>G.params.id),D=r(!1),y=r(null),b=r([]),v=r(!1),p=r(!1),U=r(!1),k=r(!1),T=r(null),n=r({catalogoId:null,numeroItem:null,numeroCaja:"",numeroTomoPaquete:"",numeroUnidadDocumental:"",fechaUnidadDocumental:null,cantidadFolios:0,alcanceContenido:"",observaciones:""}),s=r({page:0,size:10,totalItems:0,totalPages:0}),I=r("");let E=null;function _(){clearTimeout(E),E=setTimeout(()=>{c()},500)}const H=[{title:"Nº Item",key:"numeroItem",sortable:!0},{title:"Nº Caja",key:"numeroCaja",sortable:!0},{title:"Nº Tomo/Paquete",key:"numeroTomoPaquete",sortable:!0},{title:"Nº Unidad Documental",key:"numeroUnidadDocumental",sortable:!0},{title:"Fecha",key:"fechaUnidadDocumental",sortable:!0},{title:"Contenido",key:"alcanceContenido",sortable:!1},{title:"Folios",key:"cantidadFolios",sortable:!0},{title:"Acciones",key:"actions",sortable:!1}];h(async()=>{await c()});async function c(){try{D.value=!0;const o=await f.getDetallesByCatalogo(m.value);b.value=o||[],s.value={...s.value,totalItems:b.value.length}}catch(o){y.value=`Error al cargar detalles: ${o.message}`,console.error("Error:",o)}finally{D.value=!1}}function J(o){s.value.page=o.page-1,s.value.size=o.itemsPerPage,c()}function F(o=null){o?(p.value=!0,n.value={...o}):(p.value=!1,q()),v.value=!0}function K(o){F(o)}function N(){v.value=!1,q()}function q(){n.value={catalogoId:null,numeroItem:null,numeroCaja:"",numeroTomoPaquete:"",numeroUnidadDocumental:"",fechaUnidadDocumental:null,cantidadFolios:0,alcanceContenido:"",observaciones:""}}async function x(){if(!T.value||!T.value.validate()){C("Por favor complete todos los campos requeridos");return}try{U.value=!0;const o={...n.value,catalogoId:m.value};p.value&&n.value.id?(await f.updateDetalle(m.value,n.value.id,o),g("Detalle actualizado correctamente")):(await f.addDetalle(m.value,o),g("Detalle añadido correctamente")),await c(),N()}catch(o){C(`Error al guardar el detalle: ${o.message}`),console.error("Error:",o)}finally{U.value=!1}}async function Q(o){if(await O({title:"Confirmar eliminación",message:"¿Está seguro que desea eliminar este detalle? Esta acción no se puede deshacer.",confirmText:"Eliminar",cancelText:"Cancelar",confirmColor:"error"}))try{k.value=!0,await f.deleteDetalle(m.value,o.id),g("Detalle eliminado correctamente"),await c()}catch(l){C(`Error al eliminar el detalle: ${l.message}`),console.error("Error:",l)}finally{k.value=!1}}function W(o){if(!o)return"";try{return ce(new Date(o),"dd/MM/yyyy")}catch(e){return console.error("Error formatting date:",e),o}}function X(o,e){return o?o.length>e?o.substring(0,e)+"...":o:""}return(o,e)=>(j(),P(ee,{fluid:""},{default:t(()=>[a(A,null,{default:t(()=>[a(S,{class:"d-flex justify-space-between"},{default:t(()=>[e[12]||(e[12]=z("span",null,"Detalles del Catálogo de Transferencia",-1)),a(V,{color:"secondary",variant:"outlined","prepend-icon":"mdi-arrow-left",to:{name:"catalogo-transferencia-detalle",params:{id:o.id}},class:"ml-2"},{default:t(()=>e[11]||(e[11]=[d(" Volver al Catálogo ")])),_:1},8,["to"])]),_:1}),a(B,null,{default:t(()=>[y.value?(j(),P(ie,{key:0,type:"error",title:"Error",text:y.value,class:"mb-4"},null,8,["text"])):le("",!0),a(M,{class:"mb-4"},{default:t(()=>[a(u,{cols:"12",md:"4"},{default:t(()=>[a(i,{modelValue:I.value,"onUpdate:modelValue":[e[0]||(e[0]=l=>I.value=l),_],label:"Buscar","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),a(u,{cols:"12",md:"8",class:"d-flex justify-end"},{default:t(()=>[a(V,{color:"primary","prepend-icon":"mdi-plus",onClick:e[1]||(e[1]=l=>F())},{default:t(()=>e[13]||(e[13]=[d(" Añadir Detalle ")])),_:1})]),_:1})]),_:1}),a(se,{headers:H,items:b.value,loading:D.value,"items-per-page":s.value.size,"server-items-length":s.value.totalItems,"onUpdate:options":J,class:"elevation-1"},{"item.fechaUnidadDocumental":t(({item:l})=>[d(w(l.fechaUnidadDocumental?W(l.fechaUnidadDocumental):"-"),1)]),"item.alcanceContenido":t(({item:l})=>[d(w(X(l.alcanceContenido,30)),1)]),"item.actions":t(({item:l})=>[a($,{size:"small",class:"me-2",onClick:Y=>K(l)},{default:t(()=>e[14]||(e[14]=[d(" mdi-pencil ")])),_:2},1032,["onClick"]),a($,{size:"small",onClick:Y=>Q(l)},{default:t(()=>e[15]||(e[15]=[d(" mdi-delete ")])),_:2},1032,["onClick"])]),_:1},8,["items","loading","items-per-page","server-items-length"])]),_:1})]),_:1}),a(oe,{modelValue:v.value,"onUpdate:modelValue":e[10]||(e[10]=l=>v.value=l),"max-width":"800px"},{default:t(()=>[a(A,null,{default:t(()=>[a(S,null,{default:t(()=>[z("span",null,w(p.value?"Editar":"Añadir")+" Detalle",1)]),_:1}),a(B,null,{default:t(()=>[a(me,{ref_key:"detalleForm",ref:T,onSubmit:te(x,["prevent"])},{default:t(()=>[a(M,null,{default:t(()=>[a(u,{cols:"12",md:"6"},{default:t(()=>[a(i,{modelValue:n.value.numeroItem,"onUpdate:modelValue":e[2]||(e[2]=l=>n.value.numeroItem=l),label:"Número de Item",type:"number",rules:[l=>!!l||"Número de item es requerido"],required:"",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),a(u,{cols:"12",md:"6"},{default:t(()=>[a(i,{modelValue:n.value.numeroCaja,"onUpdate:modelValue":e[3]||(e[3]=l=>n.value.numeroCaja=l),label:"Número de Caja",variant:"outlined"},null,8,["modelValue"])]),_:1}),a(u,{cols:"12",md:"6"},{default:t(()=>[a(i,{modelValue:n.value.numeroTomoPaquete,"onUpdate:modelValue":e[4]||(e[4]=l=>n.value.numeroTomoPaquete=l),label:"Número de Tomo/Paquete",variant:"outlined"},null,8,["modelValue"])]),_:1}),a(u,{cols:"12",md:"6"},{default:t(()=>[a(i,{modelValue:n.value.numeroUnidadDocumental,"onUpdate:modelValue":e[5]||(e[5]=l=>n.value.numeroUnidadDocumental=l),label:"Número de Unidad Documental",variant:"outlined"},null,8,["modelValue"])]),_:1}),a(u,{cols:"12",md:"6"},{default:t(()=>[a(i,{modelValue:n.value.fechaUnidadDocumental,"onUpdate:modelValue":e[6]||(e[6]=l=>n.value.fechaUnidadDocumental=l),label:"Fecha de Unidad Documental",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),a(u,{cols:"12",md:"6"},{default:t(()=>[a(i,{modelValue:n.value.cantidadFolios,"onUpdate:modelValue":e[7]||(e[7]=l=>n.value.cantidadFolios=l),label:"Cantidad de Folios",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),a(u,{cols:"12"},{default:t(()=>[a(R,{modelValue:n.value.alcanceContenido,"onUpdate:modelValue":e[8]||(e[8]=l=>n.value.alcanceContenido=l),label:"Alcance y Contenido",variant:"outlined",rows:"3"},null,8,["modelValue"])]),_:1}),a(u,{cols:"12"},{default:t(()=>[a(R,{modelValue:n.value.observaciones,"onUpdate:modelValue":e[9]||(e[9]=l=>n.value.observaciones=l),label:"Observaciones",variant:"outlined",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1}),a(ne,null,{default:t(()=>[a(re),a(V,{color:"secondary",variant:"text",onClick:N},{default:t(()=>e[16]||(e[16]=[d(" Cancelar ")])),_:1}),a(V,{color:"primary",onClick:x,loading:U.value},{default:t(()=>e[17]||(e[17]=[d(" Guardar ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Ie as default};
