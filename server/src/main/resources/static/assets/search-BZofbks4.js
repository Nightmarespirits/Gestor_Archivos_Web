import{L as fe,M as ge,aG as ye,A as W,aj as k,al as be,O as De,e as a,E as oe,F as re,as as he,a5 as Ve,_ as Te,r as s,o as we,B as Pe,c as J,w as n,V as xe,b as ke,d as Q,f as ne,g as se,h as b,i as Ce,j as ue,C as U,aH as Ee,G as X,y as Y,v as E,aq as Se,I as Be}from"./index-DTzO7a71.js";import{u as Ie}from"./documents-Dm54GYRR.js";import{_ as q}from"./PermissionButton-DANkCNxj.js";import{V as A,a as h}from"./VRow-DteDp9R7.js";import{V as ie}from"./VSelect-DrkOLv1H.js";import{c as _e,b as Ue,d as Ne,e as Re,u as Fe,p as Oe,f as qe,g as Ae,h as ze,i as Ge,j as He,k as Me,l as de,m as ce,n as me,o as je,q as Le,r as $e}from"./VDataTable-BAdSe95_.js";import{V as ve}from"./VTable-Dw3FHTEb.js";import{V as pe}from"./VChip-Bftqh3Dm.js";import"./filter-C-DwuyMR.js";const Ke=ge({itemsLength:{type:[Number,String],required:!0},...$e(),...Le(),...je()},"VDataTableServer"),We=fe()({name:"VDataTableServer",props:Ke(),emits:{"update:modelValue":l=>!0,"update:page":l=>!0,"update:itemsPerPage":l=>!0,"update:sortBy":l=>!0,"update:options":l=>!0,"update:expanded":l=>!0,"update:groupBy":l=>!0},setup(l,V){let{attrs:S,slots:o}=V;const{groupBy:v}=_e(l),{sortBy:c,multiSort:T,mustSort:w}=Ue(l),{page:p,itemsPerPage:g}=Ne(l),{disableSort:B}=ye(l),I=W(()=>parseInt(l.itemsLength,10)),{columns:i,headers:y}=Re(l,{groupBy:v,showSelect:k(l,"showSelect"),showExpand:k(l,"showExpand")}),{items:d}=Fe(l,i),{toggleSort:P}=Oe({sortBy:c,multiSort:T,mustSort:w,page:p}),{opened:x,isGroupOpen:D,toggleGroup:m,extractRows:z}=qe({groupBy:v,sortBy:c,disableSort:B}),{pageCount:G,setItemsPerPage:N}=Ae({page:p,itemsPerPage:g,itemsLength:I}),{flatItems:R}=ze(d,v,x),{isSelected:H,select:C,selectAll:M,toggleSelect:F,someSelected:j,allSelected:L}=Ge(l,{allItems:d,currentPage:d}),{isExpanded:$,toggleExpand:K}=He(l),O=W(()=>z(d.value));Me({page:p,itemsPerPage:g,sortBy:c,groupBy:v,search:k(l,"search")}),Ve("v-data-table",{toggleSort:P,sortBy:c}),be({VDataTableRows:{hideNoData:k(l,"hideNoData"),noDataText:k(l,"noDataText"),loading:k(l,"loading"),loadingText:k(l,"loadingText")}});const u=W(()=>({page:p.value,itemsPerPage:g.value,sortBy:c.value,pageCount:G.value,toggleSort:P,setItemsPerPage:N,someSelected:j.value,allSelected:L.value,isSelected:H,select:C,selectAll:M,toggleSelect:F,isExpanded:$,toggleExpand:K,isGroupOpen:D,toggleGroup:m,items:O.value.map(r=>r.raw),internalItems:O.value,groupedItems:R.value,columns:i.value,headers:y.value}));De(()=>{const r=de.filterProps(l),e=ce.filterProps(l),t=me.filterProps(l),f=ve.filterProps(l);return a(ve,oe({class:["v-data-table",{"v-data-table--loading":l.loading},l.class],style:l.style},f,{fixedHeader:l.fixedHeader||l.sticky}),{top:()=>{var _;return(_=o.top)==null?void 0:_.call(o,u.value)},default:()=>{var _,Z,ee,ae,te,le;return o.default?o.default(u.value):a(re,null,[(_=o.colgroup)==null?void 0:_.call(o,u.value),!l.hideDefaultHeader&&a("thead",{key:"thead",class:"v-data-table__thead",role:"rowgroup"},[a(ce,e,o)]),(Z=o.thead)==null?void 0:Z.call(o,u.value),!l.hideDefaultBody&&a("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[(ee=o["body.prepend"])==null?void 0:ee.call(o,u.value),o.body?o.body(u.value):a(me,oe(S,t,{items:R.value}),o),(ae=o["body.append"])==null?void 0:ae.call(o,u.value)]),(te=o.tbody)==null?void 0:te.call(o,u.value),(le=o.tfoot)==null?void 0:le.call(o,u.value)])},bottom:()=>o.bottom?o.bottom(u.value):!l.hideDefaultFooter&&a(re,null,[a(he,null,null),a(de,r,{prepend:o["footer.prepend"]})])})})}}),Je=["onClick"],Qe=["title"],Xe={__name:"search",setup(l){const V=Ie(),S=ke(),o=s(""),v=s(""),c=s(""),T=s(null),w=s(null),p=s(""),g=s(""),B=s([]),I=s([]),i=s(!1),y=s({show:!1,text:"",color:"success",timeout:3e3}),d=s([]),P=s(1),x=s(10),D=s(0),m=s([{key:"uploadDate",order:"desc"}]),z=[{title:"ID",key:"id",align:"start",sortable:!0},{title:"Título",key:"title",align:"start",sortable:!0,width:"20%"},{title:"Descripción",key:"description",align:"start",sortable:!0,width:"25%"},{title:"Tipo",key:"documentType",align:"center",sortable:!0},{title:"Fecha de Subida",key:"uploadDate",align:"center",sortable:!0},{title:"Autor",key:"authorName",align:"center",sortable:!0},{title:"Acciones",key:"actions",align:"center",sortable:!1}];we(async()=>{i.value=!0;try{await Promise.all([R(),H(),N()])}catch(r){console.error("Error durante la inicialización:",r),u("Error al cargar datos. Por favor, inténtelo de nuevo.")}finally{i.value=!1}}),Pe([T,w,p,g,c,v],()=>{C()});async function G(r){console.log("Opciones de tabla actualizadas:",r),P.value=r.page,x.value=r.itemsPerPage,r.sortBy&&r.sortBy.length>0?m.value=r.sortBy:m.value=[{key:"uploadDate",order:"desc"}],await C()}async function N(){var r;try{i.value=!0;const e={page:Math.max(0,P.value-1),size:x.value,sortBy:m.value.length>0?m.value[0].key:"id",direction:m.value.length>0?m.value[0].order:"asc"};console.log("Cargando documentos con paginación:",e);const t=await V.fetchPaginatedDocuments(e);return d.value=t.items||[],D.value=((r=t.pagination)==null?void 0:r.totalItems)||0,console.log("Documentos cargados:",d.value.length,"de",D.value,"total"),d.value}catch(e){return console.error("Error al cargar documentos:",e),u("Error al cargar documentos. Por favor, inténtelo de nuevo."),d.value=[],D.value=0,[]}finally{i.value=!1}}async function R(){try{B.value=await V.fetchDocumentTypes()||[]}catch(r){console.error("Error al cargar tipos de documentos:",r),B.value=[]}}async function H(){try{I.value=await V.fetchTags()||[]}catch(r){console.error("Error al cargar etiquetas:",r),I.value=[]}}async function C(){var r;try{i.value=!0;const e={};o.value.trim()&&(e.title=o.value.trim()),v.value.trim()&&(e.description=v.value.trim()),c.value.trim()&&(e.author=c.value.trim()),p.value&&(e.fromDate=p.value),g.value&&(e.toDate=g.value),T.value&&(e.documentTypeId=T.value.id),w.value&&(e.tags=[w.value.name]);const t={page:Math.max(0,P.value-1),size:x.value,sortBy:m.value.length>0?m.value[0].key:"id",direction:m.value.length>0?m.value[0].order:"asc"};console.log("Realizando búsqueda con parámetros:",{searchParams:e,paginationOptions:t});let f;return Object.keys(e).length===0?f=await V.fetchPaginatedDocuments(t):f=await V.searchDocumentsPaginated(e,t),console.log("Resultados de búsqueda:",f),d.value=f.items||[],D.value=((r=f.pagination)==null?void 0:r.totalItems)||0,d.value}catch(e){return console.error("Error en la búsqueda:",e),u("Error al realizar la búsqueda. Por favor, inténtelo de nuevo."),d.value=[],D.value=0,[]}finally{i.value=!1}}function M(){o.value="",v.value="",c.value="",T.value=null,w.value=null,p.value="",g.value="",N()}function F(r){S.push({name:"DocumentDetail",params:{id:r}})}function j(r){S.push({name:"EditDocument",params:{id:r},query:{edit:!0}})}function L(){S.push({name:"CreateDocument"})}async function $(r){try{await V.downloadDocument(r),O("Documento descargado correctamente")}catch(e){console.error("Error al descargar documento:",e),u("Error al descargar documento. Por favor, inténtelo de nuevo.")}}function K(r){if(!r)return"N/A";const e=new Date(r);return new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(e)}function O(r){y.value={show:!0,text:r,color:"success",timeout:3e3}}function u(r){y.value={show:!0,text:r,color:"error",timeout:5e3}}return(r,e)=>(Q(),J(xe,{fluid:""},{default:n(()=>[a(A,null,{default:n(()=>[a(h,{cols:"12"},{default:n(()=>[a(ne,{class:"mb-4"},{default:n(()=>[a(se,{class:"headline d-flex align-center"},{default:n(()=>[a(Ce,{class:"mr-2"},{default:n(()=>e[11]||(e[11]=[b("mdi-text-box-search-outline")])),_:1}),e[12]||(e[12]=b(" Búsqueda de Documentos "))]),_:1}),a(ue,null,{default:n(()=>[a(A,null,{default:n(()=>[a(h,{cols:"12",md:"4"},{default:n(()=>[a(U,{modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=t=>o.value=t),label:"Buscar por título","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"comfortable","hide-details":"",onKeyup:Ee(C,["enter"]),clearable:""},null,8,["modelValue"])]),_:1}),a(h,{cols:"12",md:"4"},{default:n(()=>[a(ie,{modelValue:T.value,"onUpdate:modelValue":e[1]||(e[1]=t=>T.value=t),items:B.value,"item-title":"name","item-value":"id",label:"Tipo de documento",variant:"outlined",density:"comfortable","hide-details":"","prepend-inner-icon":"mdi-file-document-outline","return-object":"",clearable:""},null,8,["modelValue","items"])]),_:1}),a(h,{cols:"12",md:"4"},{default:n(()=>[a(ie,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=t=>w.value=t),items:I.value,"item-title":"name","item-value":"id",label:"Etiqueta",variant:"outlined",density:"comfortable","hide-details":"","prepend-inner-icon":"mdi-tag-outline","return-object":"",clearable:""},null,8,["modelValue","items"])]),_:1})]),_:1}),a(A,null,{default:n(()=>[a(h,{cols:"12",md:"3"},{default:n(()=>[a(U,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=t=>v.value=t),label:"Buscar por descripción","prepend-inner-icon":"mdi-text-box-search",variant:"outlined",density:"comfortable","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),a(h,{cols:"12",md:"3"},{default:n(()=>[a(U,{modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=t=>c.value=t),label:"Buscar por autor (nombre o apellidos)","prepend-inner-icon":"mdi-account",variant:"outlined",density:"comfortable","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),a(h,{cols:"12",md:"3"},{default:n(()=>[a(U,{modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=t=>p.value=t),label:"Desde fecha",type:"date",variant:"outlined",density:"comfortable","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),a(h,{cols:"12",md:"3"},{default:n(()=>[a(U,{modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=t=>g.value=t),label:"Hasta fecha",type:"date",variant:"outlined",density:"comfortable","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(A,{class:"mt-4"},{default:n(()=>[a(h,{cols:"12",md:"4",class:"d-flex align-center"},{default:n(()=>[a(X,{color:"primary",class:"mr-2","prepend-icon":"mdi-magnify",onClick:C},{default:n(()=>e[13]||(e[13]=[b(" Buscar ")])),_:1}),a(X,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:M},{default:n(()=>e[14]||(e[14]=[b(" Limpiar ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(ne,null,{default:n(()=>[a(se,{class:"d-flex justify-space-between align-center"},{default:n(()=>[Y("span",null,"Resultados ("+E(D.value)+" en total)",1),a(q,{permissions:["DOCUMENT_CREATE"],color:"primary","prepend-icon":"mdi-file-plus",onClick:L},{default:n(()=>e[15]||(e[15]=[b(" Nuevo Documento ")])),_:1})]),_:1}),a(ue,null,{default:n(()=>[a(We,{"items-per-page":x.value,"onUpdate:itemsPerPage":e[7]||(e[7]=t=>x.value=t),page:P.value,"onUpdate:page":e[8]||(e[8]=t=>P.value=t),headers:z,"items-length":D.value,items:d.value,loading:i.value,"onUpdate:options":G,class:"elevation-1",hover:"","no-data-text":"No se encontraron documentos","no-results-text":"No se encontraron resultados"},{"item.title":n(({item:t})=>[Y("a",{href:"#",class:"text-decoration-none text-primary",onClick:Se(f=>F(t.id),["prevent"])},E(t.title),9,Je)]),"item.documentType":n(({item:t})=>[t.documentType?(Q(),J(pe,{key:0,color:"primary",size:"small"},{default:n(()=>[b(E(t.documentType),1)]),_:2},1024)):(Q(),J(pe,{key:1,color:"grey",size:"small"},{default:n(()=>e[16]||(e[16]=[b(" Sin tipo ")])),_:1}))]),"item.uploadDate":n(({item:t})=>[b(E(K(t.uploadDate)),1)]),"item.description":n(({item:t})=>[Y("span",{class:"text-truncate d-inline-block",style:{"max-width":"200px"},title:t.description},E(t.description||"Sin descripción"),9,Qe)]),"item.actions":n(({item:t})=>[a(q,{permissions:["DOCUMENT_READ"],color:"info",onClick:f=>F(t.id),disabled:i.value,tooltip:"Ver documento",prependIcon:"mdi-eye",iconButton:!0,variant:"plain"},null,8,["onClick","disabled"]),a(q,{permissions:["FILE_DOWNLOAD"],prependIcon:"mdi-download",variant:"plain",color:"success",onClick:f=>$(t.id),disabled:i.value,tooltip:"Descargar documento"},null,8,["onClick","disabled"]),a(q,{permissions:["DOCUMENT_UPDATE"],prependIcon:"mdi-pencil",variant:"plain",color:"primary",onClick:f=>j(t.id),disabled:i.value,tooltip:"Editar documento"},null,8,["onClick","disabled"])]),_:1},8,["items-per-page","page","items-length","items","loading"])]),_:1})]),_:1})]),_:1})]),_:1}),a(Be,{modelValue:y.value.show,"onUpdate:modelValue":e[10]||(e[10]=t=>y.value.show=t),color:y.value.color,timeout:y.value.timeout},{actions:n(()=>[a(X,{variant:"text",onClick:e[9]||(e[9]=t=>y.value.show=!1)},{default:n(()=>e[17]||(e[17]=[b(" Cerrar ")])),_:1})]),default:n(()=>[b(E(y.value.text)+" ",1)]),_:1},8,["modelValue","color","timeout"])]),_:1}))}},sa=Te(Xe,[["__scopeId","data-v-32a161db"]]);export{sa as default};
