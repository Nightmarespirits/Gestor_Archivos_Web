import{_ as se,a as ne,r as V,A as N,aU as ie,o as de,c as b,w as l,V as me,b as fe,d as i,k as w,e as t,y as d,m as pe,F as I,f as S,j as P,G as x,h as a,l as M,g as q,i as s,v as n,p as U,as as X,n as R,s as f,t as p,x as v,E as ve,q as ce,az as W,ao as Y,C as ye,av as ge,b9 as Ve,ba as De,I as be}from"./index-DTzO7a71.js";import{u as we}from"./documents-Dm54GYRR.js";import{_ as D}from"./PermissionButton-DANkCNxj.js";import{V as C,a as c}from"./VRow-DteDp9R7.js";import{V as Z}from"./VChip-Bftqh3Dm.js";import{V as xe}from"./VTooltip-ZPSecc-u.js";import{V as h}from"./VAlert-WIuVYfyH.js";import{V as Ce}from"./VForm-Cr0IhdhJ.js";const ke={class:"d-flex align-center"},Ee={class:"text-body-1"},_e={class:"d-flex flex-wrap gap-1 mt-1"},Le={key:0},Te={class:"text-center"},Fe={class:"mb-4"},Ne=["src"],Ie={__name:"[id]",setup(Se){const k=we();ne();const ee=ie(),A=fe(),r=V(null),y=V(!0),L=V(!1),E=V(!1),g=V({show:!1,text:"",color:"success",timeout:3e3}),O=V(""),$=V(!1),j=V({url:"",mimeType:""}),_=N(()=>ee.params.id),G=N(()=>r.value?(r.value.format||"").toLowerCase().includes("pdf"):!1),H=N(()=>r.value?(r.value.format||"").toLowerCase().startsWith("image/"):!1),z=N(()=>j.value.url),T=N(()=>{var u;return((u=r.value)==null?void 0:u.metadata)||null});de(async()=>{await le()});async function le(){try{y.value=!0,r.value=await k.fetchDocumentById(_.value),j.value=await k.getFilePreview(_.value)}catch(u){B("Error al cargar el documento: "+u.message),r.value=null}finally{y.value=!1}}function J(){A.back()}function te(){A.push(`/documents/${_.value}/edit`)}async function F(){try{y.value=!0,await k.downloadDocument(_.value),Q("Documento descargado correctamente")}catch(u){B("Error al descargar el documento: "+u.message)}finally{y.value=!1}}function ae(){L.value=!0}async function oe(){try{y.value=!0,await k.deleteDocument(_.value,O.value),Q(`Documento "${r.value.title}" eliminado correctamente.`),L.value=!1,setTimeout(()=>{A.push("/search-documents")},1500)}catch(u){B("Error al eliminar el documento: "+u.message)}finally{y.value=!1}}function re(){k.revokePreviewUrl(_.value)}function K(u){if(!u)return"Fecha no disponible";const e=new Date(u),o={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"};return new Intl.DateTimeFormat("es-ES",o).format(e)}function ue(u){return k.getSecurityLevelColor(u)}function Q(u){g.value={show:!0,text:u,color:"success",timeout:3e3}}function B(u){g.value={show:!0,text:u,color:"error",timeout:5e3}}return(u,e)=>(i(),b(me,{fluid:""},{default:l(()=>[y.value?(i(),b(C,{key:0},{default:l(()=>[t(c,{cols:"12",class:"d-flex justify-center align-center pa-8"},{default:l(()=>[t(pe,{indeterminate:"",color:"primary",size:"64"}),e[12]||(e[12]=d("span",{class:"ml-4 text-h6"},"Cargando documento...",-1))]),_:1})]),_:1})):r.value?(i(),w(I,{key:1},[t(C,null,{default:l(()=>[t(c,{cols:"12"},{default:l(()=>[t(S,{class:"mb-4"},{default:l(()=>[t(P,null,{default:l(()=>[d("div",ke,[t(x,{variant:"text","prepend-icon":"mdi-arrow-left",onClick:J},{default:l(()=>e[13]||(e[13]=[a("Volver")])),_:1}),t(M),t(D,{permissions:["FILE_DOWNLOAD"],color:"primary","prepend-icon":"mdi-download",class:"mr-2",onClick:F},{default:l(()=>e[14]||(e[14]=[a(" Descargar ")])),_:1}),t(D,{permissions:["DOCUMENT_UPDATE"],color:"warning","prepend-icon":"mdi-pencil",class:"mr-2",onClick:te},{default:l(()=>e[15]||(e[15]=[a(" Editar ")])),_:1}),t(D,{permissions:["DOCUMENT_DELETE"],color:"error","prepend-icon":"mdi-delete",onClick:ae},{default:l(()=>e[16]||(e[16]=[a(" Eliminar ")])),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),t(C,null,{default:l(()=>[t(c,{cols:"12",md:"8"},{default:l(()=>[t(S,null,{default:l(()=>[t(q,{class:"d-flex align-center"},{default:l(()=>[t(s,{class:"mr-2"},{default:l(()=>e[17]||(e[17]=[a("mdi-file-document-outline")])),_:1}),a(" "+n(r.value.title),1)]),_:1}),t(P,null,{default:l(()=>[t(C,null,{default:l(()=>[t(c,{cols:"12"},{default:l(()=>[e[18]||(e[18]=d("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Descripción",-1)),d("p",Ee,n(r.value.description||"Sin descripción"),1)]),_:1})]),_:1}),t(X,{class:"my-4"}),t(C,null,{default:l(()=>[t(c,{cols:"12",md:"6"},{default:l(()=>[e[31]||(e[31]=d("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Información del Documento",-1)),t(R,{density:"compact"},{default:l(()=>[t(f,null,{prepend:l(()=>[t(s,{color:"primary"},{default:l(()=>e[19]||(e[19]=[a("mdi-calendar")])),_:1})]),default:l(()=>[t(p,null,{default:l(()=>e[20]||(e[20]=[a("Fecha de subida")])),_:1}),t(v,null,{default:l(()=>[a(n(K(r.value.uploadDate)),1)]),_:1})]),_:1}),t(f,null,{prepend:l(()=>[t(s,{color:"primary"},{default:l(()=>e[21]||(e[21]=[a("mdi-file-outline")])),_:1})]),default:l(()=>[t(p,null,{default:l(()=>e[22]||(e[22]=[a("Formato")])),_:1}),t(v,null,{default:l(()=>[a(n(r.value.format||"Desconocido"),1)]),_:1})]),_:1}),t(f,null,{prepend:l(()=>[t(s,{color:"primary"},{default:l(()=>e[23]||(e[23]=[a("mdi-tag-outline")])),_:1})]),default:l(()=>[t(p,null,{default:l(()=>e[24]||(e[24]=[a("Tipo de documento")])),_:1}),t(v,null,{default:l(()=>[a(n(r.value.documentType?r.value.documentType:"Sin tipo"),1)]),_:1})]),_:1}),t(f,null,{prepend:l(()=>[t(s,{color:"primary"},{default:l(()=>e[25]||(e[25]=[a("mdi-shield-outline")])),_:1})]),default:l(()=>[t(p,null,{default:l(()=>e[26]||(e[26]=[a("Nivel de Acceso")])),_:1}),t(v,null,{default:l(()=>{var o;return[t(Z,{color:ue((o=r.value.security)==null?void 0:o.accessLevel),size:"small",class:"mr-2"},{default:l(()=>{var m;return[a(n(((m=r.value.security)==null?void 0:m.accessLevel)||"Privado"),1)]}),_:1},8,["color"]),t(xe,{location:"bottom"},{activator:l(({props:m})=>[t(s,ve(m,{size:"small"}),{default:l(()=>e[27]||(e[27]=[a("mdi-information-outline")])),_:2},1040)]),default:l(()=>[e[28]||(e[28]=d("span",null,[a(" Privado: Visible para todos los usuarios"),d("br"),a(" Reservado: Visible para gestores y administradores"),d("br"),a(" Secreto: Visible solo para administradores ")],-1))]),_:1})]}),_:1})]),_:1}),t(f,null,{prepend:l(()=>[t(s,{color:"primary"},{default:l(()=>e[29]||(e[29]=[a("mdi-numeric")])),_:1})]),default:l(()=>[t(p,null,{default:l(()=>e[30]||(e[30]=[a("Versión")])),_:1}),t(v,null,{default:l(()=>[a(n(r.value.versionNumber||"1"),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(c,{cols:"12",md:"6"},{default:l(()=>[e[36]||(e[36]=d("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Información Adicional",-1)),t(R,{density:"compact"},{default:l(()=>[t(f,null,{prepend:l(()=>[t(s,{color:"primary"},{default:l(()=>e[32]||(e[32]=[a("mdi-account")])),_:1})]),default:l(()=>[t(p,null,{default:l(()=>e[33]||(e[33]=[a("Autor")])),_:1}),t(v,null,{default:l(()=>[a(n(r.value.authorName?r.value.authorName:"Desconocido"),1)]),_:1})]),_:1}),t(f,null,{prepend:l(()=>[t(s,{color:"primary"},{default:l(()=>e[34]||(e[34]=[a("mdi-tag-multiple-outline")])),_:1})]),default:l(()=>[t(p,null,{default:l(()=>e[35]||(e[35]=[a("Etiquetas")])),_:1}),t(v,null,{default:l(()=>[d("div",_e,[(i(!0),w(I,null,ce(r.value.tags,o=>(i(),b(Z,{size:"small",color:"secondary",class:"mr-1 mb-1"},{default:l(()=>[a(n(o),1)]),_:2},1024))),256)),!r.value.tags||r.value.tags.length===0?(i(),w("span",Le,"Sin etiquetas")):U("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(X,{class:"my-4"}),T.value?(i(),b(C,{key:0},{default:l(()=>[t(c,{cols:"12"},{default:l(()=>[e[43]||(e[43]=d("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Metadatos",-1)),t(R,{density:"compact"},{default:l(()=>[t(f,null,{prepend:l(()=>[t(s,{color:"primary"},{default:l(()=>e[37]||(e[37]=[a("mdi-key-outline")])),_:1})]),default:l(()=>[t(p,null,{default:l(()=>e[38]||(e[38]=[a("Palabras clave")])),_:1}),t(v,null,{default:l(()=>[a(n(T.value.keywords||"Sin palabras clave"),1)]),_:1})]),_:1}),t(f,null,{prepend:l(()=>[t(s,{color:"primary"},{default:l(()=>e[39]||(e[39]=[a("mdi-office-building-outline")])),_:1})]),default:l(()=>[t(p,null,{default:l(()=>e[40]||(e[40]=[a("Departamento")])),_:1}),t(v,null,{default:l(()=>[a(n(T.value.department||"General"),1)]),_:1})]),_:1}),T.value.expirationDate?(i(),b(f,{key:0},{prepend:l(()=>[t(s,{color:"primary"},{default:l(()=>e[41]||(e[41]=[a("mdi-calendar-clock")])),_:1})]),default:l(()=>[t(p,null,{default:l(()=>e[42]||(e[42]=[a("Fecha de expiración")])),_:1}),t(v,null,{default:l(()=>[a(n(K(T.value.expirationDate)),1)]),_:1})]),_:1})):U("",!0)]),_:1})]),_:1})]),_:1})):U("",!0)]),_:1})]),_:1})]),_:1}),t(c,{cols:"12",md:"4"},{default:l(()=>[t(S,{height:"100%"},{default:l(()=>[t(q,{class:"d-flex align-center"},{default:l(()=>[t(s,{class:"mr-2"},{default:l(()=>e[44]||(e[44]=[a("mdi-eye")])),_:1}),e[45]||(e[45]=a(" Vista previa "))]),_:1}),t(P,{class:"d-flex flex-column align-center justify-center",style:{height:"calc(100% - 64px)"}},{default:l(()=>[G.value?(i(),w(I,{key:0},[t(W,{src:"@/assets/pdf-preview.png","max-height":"200",contain:"",class:"mb-4"}),t(D,{permissions:["DOCUMENT_READ"],color:"primary","prepend-icon":"mdi-eye",onClick:e[0]||(e[0]=o=>E.value=!0),class:"mr-2"},{default:l(()=>e[46]||(e[46]=[a("Ver PDF")])),_:1}),t(D,{permissions:["FILE_DOWNLOAD"],color:"secondary","prepend-icon":"mdi-download",onClick:F},{default:l(()=>e[47]||(e[47]=[a("Descargar")])),_:1})],64)):H.value?(i(),w(I,{key:1},[t(W,{src:z.value,"max-height":"300",contain:"",class:"mb-4",onClick:e[1]||(e[1]=o=>E.value=!0),style:{cursor:"pointer"}},null,8,["src"]),t(D,{permissions:["DOCUMENT_READ"],color:"primary","prepend-icon":"mdi-fullscreen",onClick:e[2]||(e[2]=o=>E.value=!0),class:"mr-2"},{default:l(()=>e[48]||(e[48]=[a("Maximizar")])),_:1}),t(D,{permissions:["FILE_DOWNLOAD"],color:"secondary","prepend-icon":"mdi-download",onClick:F},{default:l(()=>e[49]||(e[49]=[a("Descargar")])),_:1})],64)):(i(),w(I,{key:2},[t(s,{size:"100",color:"grey lighten-1",class:"mb-4"},{default:l(()=>e[50]||(e[50]=[a("mdi-file-document-outline")])),_:1}),e[52]||(e[52]=d("div",{class:"text-body-1 text-center"},"No hay vista previa disponible para este tipo de archivo.",-1)),t(D,{permissions:["FILE_DOWNLOAD"],color:"primary","prepend-icon":"mdi-download",class:"mt-4",onClick:F},{default:l(()=>e[51]||(e[51]=[a("Descargar archivo")])),_:1})],64))]),_:1})]),_:1})]),_:1})]),_:1})],64)):(i(),b(C,{key:2},{default:l(()=>[t(c,{cols:"12"},{default:l(()=>[t(h,{type:"error",title:"Error",text:"No se pudo encontrar el documento solicitado.",class:"mb-4"}),d("div",Te,[t(x,{color:"primary","prepend-icon":"mdi-arrow-left",onClick:J},{default:l(()=>e[53]||(e[53]=[a("Volver a la lista de documentos")])),_:1})])]),_:1})]),_:1})),t(Y,{modelValue:L.value,"onUpdate:modelValue":e[6]||(e[6]=o=>L.value=o),"max-width":"500px"},{default:l(()=>[t(S,null,{default:l(()=>[t(q,{class:"text-h5"},{default:l(()=>e[54]||(e[54]=[a("Confirmar eliminación")])),_:1}),t(P,null,{default:l(()=>{var o;return[d("p",Fe,'¿Está seguro que desea eliminar el documento "'+n((o=r.value)==null?void 0:o.title)+'"?',1),t(h,{type:"warning",variant:"tonal",class:"mb-4"},{default:l(()=>e[55]||(e[55]=[a(" Esta acción no se puede deshacer. ")])),_:1}),t(Ce,{ref:"deleteForm",modelValue:$.value,"onUpdate:modelValue":e[4]||(e[4]=m=>$.value=m)},{default:l(()=>[t(ye,{modelValue:O.value,"onUpdate:modelValue":e[3]||(e[3]=m=>O.value=m),label:"Contraseña de administrador",type:"password",rules:[m=>!!m||"La contraseña es requerida"],required:""},null,8,["modelValue","rules"])]),_:1},8,["modelValue"])]}),_:1}),t(ge,null,{default:l(()=>[t(M),t(x,{color:"primary",variant:"text",onClick:e[5]||(e[5]=o=>L.value=!1)},{default:l(()=>e[56]||(e[56]=[a(" Cancelar ")])),_:1}),t(x,{color:"error",variant:"elevated",onClick:oe,loading:y.value,disabled:!$.value},{default:l(()=>e[57]||(e[57]=[a(" Eliminar ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Y,{modelValue:E.value,"onUpdate:modelValue":[e[8]||(e[8]=o=>E.value=o),e[9]||(e[9]=o=>{o||re()})],fullscreen:""},{default:l(()=>[t(S,null,{default:l(()=>[t(Ve,{color:"primary"},{default:l(()=>[t(x,{icon:"",onClick:e[7]||(e[7]=o=>E.value=!1)},{default:l(()=>[t(s,null,{default:l(()=>e[58]||(e[58]=[a("mdi-close")])),_:1})]),_:1}),t(De,null,{default:l(()=>{var o;return[a("Vista previa: "+n((o=r.value)==null?void 0:o.title),1)]}),_:1}),t(M),t(x,{"prepend-icon":"mdi-download",onClick:F,color:"white",variant:"text"},{default:l(()=>e[59]||(e[59]=[a(" Descargar ")])),_:1})]),_:1}),t(P,{class:"d-flex justify-center align-center pa-0",style:{height:"calc(100vh - 64px)"}},{default:l(()=>[G.value?(i(),w("iframe",{key:0,src:z.value,width:"100%",height:"100%",style:{border:"none"},type:"application/pdf"},null,8,Ne)):H.value?(i(),b(W,{key:1,src:z.value,"max-height":"90vh",contain:"",class:"mx-auto"},null,8,["src"])):U("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(be,{modelValue:g.value.show,"onUpdate:modelValue":e[11]||(e[11]=o=>g.value.show=o),color:g.value.color,timeout:g.value.timeout},{actions:l(()=>[t(x,{variant:"text",onClick:e[10]||(e[10]=o=>g.value.show=!1)},{default:l(()=>e[60]||(e[60]=[a("Cerrar")])),_:1})]),default:l(()=>[a(n(g.value.text)+" ",1)]),_:1},8,["modelValue","color","timeout"])]),_:1}))}},qe=se(Ie,[["__scopeId","data-v-365ca982"]]);export{qe as default};
