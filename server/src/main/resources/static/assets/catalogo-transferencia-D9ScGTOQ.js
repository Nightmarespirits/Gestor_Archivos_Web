import{J as S,r as f,u as _,K as i,bb as B}from"./index-DTzO7a71.js";const I=S("catalogoTransferencia",()=>{const c=f([]),n=f(null),r=f(!1),l=f(null),g=_();function C(){return c.value}function E(){return n.value}function w(){return r.value}function A(){return l.value}const u=f({page:0,size:10,totalItems:0,totalPages:0}),v=f({sortBy:"id",direction:"desc"});async function y(){try{r.value=!0;const e=await i.get("/catalogo-transferencia",{debug:!0});return c.value=e||[],e}catch(e){return l.value=e.message,console.error("fetchCatalogosTransferencia Error:",e),c.value=[],[]}finally{r.value=!1}}async function p(e){try{r.value=!0;const a=await i.get(`/catalogo-transferencia/${e}`);return n.value=a,a}catch(a){return l.value=a.message,console.error("fetchCatalogoTransferenciaById Error:",a),null}finally{r.value=!1}}async function $(e){try{r.value=!0;const a=await i.post("/catalogo-transferencia",e);return a&&a.id&&(await y(),await g.createActivityLog("CREATE_CATALOG_TRANSFERENCY",`Catalgo de transferencia "${a.id}" creado`)),a}catch(a){throw l.value=a.message,console.error("createCatalogoTransferencia Error:",a),a}finally{r.value=!1}}async function h(e,a){try{r.value=!0;const t=n.value||await p(e),s=t?t.estado:null,o=await i.put(`/catalogo-transferencia/${e}`,a);if(o){n.value&&n.value.id===e&&(n.value=o);const d=c.value.findIndex(L=>L.id===e);d!==-1&&(c.value[d]=o);let T=`Catálogo de Transferencia "${o.numero||o.codigo}" actualizado`;s&&o.estado&&s!==o.estado&&(T+=`. Estado cambiado de ${s} a ${o.estado}`),await g.logActivity({action:"UPDATE",entityType:"CATALOGO_TRANSFERENCIA",entityId:e,details:T})}return o}catch(t){throw l.value=t.message,console.error("updateCatalogoTransferencia Error:",t),t}finally{r.value=!1}}async function m(e){try{r.value=!0;const a=c.value.find(t=>t.id===e)||(n.value&&n.value.id===e?n.value:null);return await i.delete(`/catalogo-transferencia/${e}`),c.value=c.value.filter(t=>t.id!==e),n.value&&n.value.id===e&&(n.value=null),a&&await g.logActivity({action:"DELETE",entityType:"CATALOGO_TRANSFERENCIA",entityId:e,details:`Catálogo de Transferencia "${a.numero||a.codigo||e}" eliminado`}),!0}catch(a){return l.value=a.message,console.error("deleteCatalogoTransferencia Error:",a),!1}finally{r.value=!1}}async function b(e={}){try{r.value=!0;const a={page:e.page!==void 0?e.page:u.value.page,size:e.size!==void 0?e.size:u.value.size,sortBy:e.sortBy||v.value.sortBy,direction:e.direction||v.value.direction};e.unidad&&(a.unidad=e.unidad),e.titulo&&(a.titulo=e.titulo),e.estado&&(a.estado=e.estado);const t=await i.get("/catalogo-transferencia/search",{params:a,debug:!0});return t&&t.content?(c.value=t.content||[],u.value={page:t.number||0,size:t.size||10,totalItems:t.totalElements||0,totalPages:t.totalPages||0},t):{content:[],number:0,size:u.value.size,totalElements:0,totalPages:0}}catch(a){return l.value=a.message,console.error("searchCatalogos Error:",a),{content:[],number:0,size:u.value.size,totalElements:0,totalPages:0}}finally{r.value=!1}}async function D(e){try{return r.value=!0,await i.get(`/catalogo-transferencia/${e}/detalles`)||[]}catch(a){return l.value=a.message,console.error(`getDetallesByCatalogo Error para catálogo ID ${e}:`,a),[]}finally{r.value=!1}}async function R(e,a){try{return r.value=!0,await i.post(`/catalogo-transferencia/${e}/detalles`,a)}catch(t){throw l.value=t.message,console.error(`Error al añadir detalle al catálogo ID ${e}:`,t),t}finally{r.value=!1}}async function x(e,a,t){try{return r.value=!0,await i.put(`/catalogo-transferencia/${e}/detalles/${a}`,t)}catch(s){throw l.value=s.message,console.error(`Error al actualizar detalle ID ${a} del catálogo ID ${e}:`,s),s}finally{r.value=!1}}async function z(e){try{r.value=!0;const a=await fetch(`${B}/catalogo-transferencia/${e}/export-excel`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"application/json"}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const t=await a.blob(),s=window.URL.createObjectURL(t),o=document.createElement("a");o.href=s,o.download=`catalogo_transferencia_${e}_${Date.now()}.xlsx`,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(s);try{await g.logActivity("EXPORT_CATALOG_TRANSFERENCY",`Catálogo de transferencia "${e}" exportado a Excel`)}catch(d){console.warn("Error al registrar actividad de exportación:",d)}}catch(a){throw l.value=a.message,console.error(`exportCatalogoToExcel Error para catálogo ID ${e}:`,a),a}finally{r.value=!1}}return{catalogosTransferencia:c,currentCatalogoTransferencia:n,loading:r,error:l,activityLogsStore:g,getCatalogosTransferencia:C,getCurrentCatalogoTransferencia:E,isLoading:w,getError:A,fetchCatalogosTransferencia:y,fetchCatalogoTransferenciaById:p,createCatalogoTransferencia:$,updateCatalogoTransferencia:h,deleteCatalogoTransferencia:m,searchCatalogos:b,getDetallesByCatalogo:D,addDetalle:R,updateDetalle:x,exportCatalogoToExcel:z,pagination:u,sortOptions:v}});export{I as u};
