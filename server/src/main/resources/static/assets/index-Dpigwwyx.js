import{aw as J,r as S,A as C,aU as K,o as Q,b as W,c as d,w as e,V as X,d as s,k as B,f as V,e as t,y as m,m as Y,F as h,g as F,v as i,h as r,G as x,j as P,p,n as k,s as u,t as y,x as g,i as c,D as L,E as T}from"./index-DTzO7a71.js";import{u as ee}from"./inventarios-mEqQ-Uto.js";import{V as z}from"./VChip-Bftqh3Dm.js";import{V as _,a as w}from"./VRow-DteDp9R7.js";import{V as te}from"./VDataTable-BAdSe95_.js";import"./VSelect-DrkOLv1H.js";import"./VTable-Dw3FHTEb.js";import"./filter-C-DwuyMR.js";const ae={class:"text-h5"},ne={key:0},oe={class:"text-center pa-5"},ve={__name:"index",setup(re){const b=ee(),I=J(),$=S({show:!1,text:"",color:"success",timeout:3e3}),U=K(),j=W(),f=S(!1),D=C(()=>Number(U.params.id)),o=C(()=>b.getCurrentInventario()),E=C(()=>{const n=o.value;return n?I.hasPermission("inventarios:edit")&&(n.estado==="BORRADOR"||I.hasPermission("inventarios:edit:any")):!1}),M=C(()=>{const n=o.value;return n?!!(n.estado==="BORRADOR"&&I.hasPermission("inventarios:finalize")||n.estado==="FINALIZADO"&&I.hasPermission("inventarios:approve")):!1}),Z=[{title:"Código",key:"codigo",sortable:!0},{title:"Serie Documental",key:"serieDocumental",sortable:!0},{title:"Título",key:"titulo",sortable:!0},{title:"Años Extremos",key:"anosExtremos",sortable:!0},{title:"Ubicación",key:"ubicacion",sortable:!0},{title:"Conservación",key:"estadoConservacion",sortable:!0}];function A(n){if(!n)return"No especificado";const a=new Date(n);return new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}).format(a)}function G(n){if(!n)return"No especificado";const a=new Date(n);return new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(a)}function q(n){switch(n){case"BUENO":return"green";case"REGULAR":return"orange";case"MALO":return"red";default:return"grey"}}function H(n){return b.getInventarioStateColor(n)}async function R(n){try{f.value=!0,await b.downloadInventario(D.value,n)||v(`Error al descargar el inventario en formato ${n}`,"error")}catch(a){v("Error al descargar: "+a.message,"error")}finally{f.value=!1}}async function N(n){try{f.value=!0,await b.changeInventarioState(D.value,n),v(`Estado del inventario actualizado a ${n}`,"success"),await O()}catch(a){v("Error al cambiar el estado: "+a.message,"error")}finally{f.value=!1}}async function O(){try{f.value=!0,await b.fetchInventarioById(D.value)||v("Inventario no encontrado","error")}catch(n){v("Error al cargar el inventario: "+n.message,"error")}finally{f.value=!1}}function v(n,a="success",l=3e3){$.value={show:!0,text:n,color:a,timeout:l}}return Q(async()=>{if(!I.hasPermission("inventarios:view")){v("No tienes permiso para ver inventarios","error"),j.push({name:"inventario-list"});return}await O()}),(n,a)=>(s(),d(X,{fluid:""},{default:e(()=>[f.value?(s(),d(V,{key:0,class:"pa-5 text-center"},{default:e(()=>[t(Y,{indeterminate:"",color:"primary"}),a[4]||(a[4]=m("div",{class:"text-body-1 mt-4"},"Cargando inventario...",-1))]),_:1})):o.value?(s(),B(h,{key:1},[t(V,{class:"mb-4"},{default:e(()=>[t(F,{class:"d-flex justify-space-between align-center"},{default:e(()=>[m("div",null,[m("span",ae,i(o.value.titulo),1),t(z,{color:H(o.value.estado),"text-color":"white",class:"ml-2",size:"small"},{default:e(()=>[r(i(o.value.estado),1)]),_:1},8,["color"])]),t(x,{color:"secondary","prepend-icon":"mdi-arrow-left",to:{name:"inventario-list"}},{default:e(()=>a[5]||(a[5]=[r(" Volver ")])),_:1})]),_:1}),t(P,null,{default:e(()=>[t(_,null,{default:e(()=>[t(w,{cols:"12",md:"6"},{default:e(()=>[t(k,null,{default:e(()=>[t(u,null,{prepend:e(()=>[t(c,{icon:"mdi-office-building"})]),default:e(()=>[t(y,null,{default:e(()=>a[6]||(a[6]=[r("Dependencia")])),_:1}),t(g,null,{default:e(()=>[r(i(o.value.dependencia),1)]),_:1})]),_:1}),t(u,null,{prepend:e(()=>[t(c,{icon:"mdi-identifier"})]),default:e(()=>[t(y,null,{default:e(()=>a[7]||(a[7]=[r("Número de Identificación")])),_:1}),t(g,null,{default:e(()=>[r(i(o.value.numeroIdentificacion||"No especificado"),1)]),_:1})]),_:1}),t(u,null,{prepend:e(()=>[t(c,{icon:"mdi-account"})]),default:e(()=>[t(y,null,{default:e(()=>a[8]||(a[8]=[r("Responsable")])),_:1}),t(g,null,{default:e(()=>[r(i(o.value.responsable)+" ",1),o.value.cargoResponsable?(s(),B("span",ne,"("+i(o.value.cargoResponsable)+")",1)):p("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),t(w,{cols:"12",md:"6"},{default:e(()=>[t(k,null,{default:e(()=>[t(u,null,{prepend:e(()=>[t(c,{icon:"mdi-calendar-range"})]),default:e(()=>[t(y,null,{default:e(()=>a[9]||(a[9]=[r("Período")])),_:1}),t(g,null,{default:e(()=>[r(i(A(o.value.fechaInicio))+" - "+i(A(o.value.fechaFin)),1)]),_:1})]),_:1}),t(u,null,{prepend:e(()=>[t(c,{icon:"mdi-calendar"})]),default:e(()=>[t(y,null,{default:e(()=>a[10]||(a[10]=[r("Año")])),_:1}),t(g,null,{default:e(()=>[r(i(o.value.anio),1)]),_:1})]),_:1}),t(u,null,{prepend:e(()=>[t(c,{icon:"mdi-calendar-clock"})]),default:e(()=>[t(y,null,{default:e(()=>a[11]||(a[11]=[r("Fecha de creación")])),_:1}),t(g,null,{default:e(()=>[r(i(G(o.value.fechaCreacion)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o.value.observaciones?(s(),d(_,{key:0},{default:e(()=>[t(w,{cols:"12"},{default:e(()=>[t(k,null,{default:e(()=>[t(u,null,{prepend:e(()=>[t(c,{icon:"mdi-note-text"})]),default:e(()=>[t(y,null,{default:e(()=>a[12]||(a[12]=[r("Observaciones")])),_:1}),t(g,null,{default:e(()=>[r(i(o.value.observaciones),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):p("",!0),t(_,{class:"mt-2"},{default:e(()=>[t(w,{cols:"12",class:"d-flex justify-end"},{default:e(()=>[E.value?(s(),d(x,{key:0,color:"warning",class:"mx-2",to:{name:"inventario-edit",params:{id:o.value.id}},"prepend-icon":"mdi-pencil"},{default:e(()=>a[13]||(a[13]=[r(" Editar ")])),_:1},8,["to"])):p("",!0),t(L,null,{activator:e(({props:l})=>[t(x,T({color:"primary","prepend-icon":"mdi-download"},l,{class:"mx-2"}),{default:e(()=>a[14]||(a[14]=[r(" Descargar ")])),_:2},1040)]),default:e(()=>[t(k,null,{default:e(()=>[t(u,{onClick:a[0]||(a[0]=l=>R("excel")),"prepend-icon":"mdi-file-excel",title:"Descargar Excel"}),t(u,{onClick:a[1]||(a[1]=l=>R("pdf")),"prepend-icon":"mdi-file-pdf-box",title:"Descargar PDF"})]),_:1})]),_:1}),M.value?(s(),d(L,{key:1},{activator:e(({props:l})=>[t(x,T({color:"success","prepend-icon":"mdi-check-circle"},l,{class:"mx-2"}),{default:e(()=>a[15]||(a[15]=[r(" Cambiar Estado ")])),_:2},1040)]),default:e(()=>[t(k,null,{default:e(()=>[o.value.estado==="BORRADOR"?(s(),d(u,{key:0,onClick:a[2]||(a[2]=l=>N("FINALIZADO")),"prepend-icon":"mdi-check-circle",title:"Finalizar inventario"})):p("",!0),o.value.estado==="FINALIZADO"?(s(),d(u,{key:1,onClick:a[3]||(a[3]=l=>N("APROBADO")),"prepend-icon":"mdi-check-circle-outline",title:"Aprobar inventario"})):p("",!0)]),_:1})]),_:1})):p("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),t(V,null,{default:e(()=>[t(F,null,{default:e(()=>a[16]||(a[16]=[m("span",{class:"text-h6"},"Detalles del Inventario",-1)])),_:1}),t(P,null,{default:e(()=>[t(te,{headers:Z,items:o.value.detalles||[],loading:f.value,class:"elevation-1"},{"item.estadoConservacion":e(({item:l})=>[t(z,{color:q(l.estadoConservacion),"text-color":"white",size:"small"},{default:e(()=>[r(i(l.estadoConservacion),1)]),_:2},1032,["color"])]),"no-data":e(()=>[m("div",oe,[t(c,{size:"large",icon:"mdi-folder-outline",color:"grey"}),a[18]||(a[18]=m("div",{class:"text-body-1 mt-2"},"Este inventario aún no tiene elementos",-1)),E.value?(s(),d(x,{key:0,color:"primary",class:"mt-4",to:{name:"inventario-edit",params:{id:o.value.id}}},{default:e(()=>a[17]||(a[17]=[r(" Agregar elementos ")])),_:1},8,["to"])):p("",!0)])]),_:1},8,["items","loading"])]),_:1})]),_:1})],64)):(s(),d(V,{key:2,class:"pa-5 text-center"},{default:e(()=>[t(c,{size:"large",icon:"mdi-alert-circle",color:"error"}),a[20]||(a[20]=m("div",{class:"text-h6 mt-2"},"Inventario no encontrado",-1)),a[21]||(a[21]=m("div",{class:"text-body-1 mt-2"},"El inventario solicitado no existe o no tienes permiso para verlo.",-1)),t(x,{color:"primary",class:"mt-4",to:{name:"inventario-list"}},{default:e(()=>a[19]||(a[19]=[r(" Volver al listado ")])),_:1})]),_:1}))]),_:1}))}};export{ve as default};
