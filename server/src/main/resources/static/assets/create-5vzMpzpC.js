import{aw as ee,A as le,r as g,c as x,w as o,V as ae,b as oe,d as b,e as l,f as D,g as U,y as t,G as m,h as c,j as y,aq as I,C as i,as as ne,l as A,k as P,F as te,q as ue,v as s,ao as q,av as L,H as v,bw as re}from"./index-DTzO7a71.js";import{u as de}from"./catalogo-transferencia-D9ScGTOQ.js";import{V as M}from"./VForm-Cr0IhdhJ.js";import{V as $,a as u}from"./VRow-DteDp9R7.js";import{V as ie}from"./VSelect-DrkOLv1H.js";import{V as w}from"./VTextarea-BbRLHrOO.js";import{V as se}from"./VTable-Dw3FHTEb.js";import{V as me}from"./VAlert-WIuVYfyH.js";import{f as j}from"./index-DlVYjeeE.js";import"./VChip-Bftqh3Dm.js";const ce={class:"d-flex flex-column flex-sm-row gap-2 mt-5"},fe={class:"text-h5"},xe={__name:"create",setup(ve){const z=oe(),S=de(),O=ee(),{confirmDialog:f,showSuccess:E,showError:C,showInfo:B,showConfirm:G}=re(),F=le(()=>S.isLoading()),N=g(null),V=g(!1),p=g(-1),H=["PAPEL","DIGITAL","AUDIOVISUAL","MICROFILM","OTRO"];function Y(){const d=new Date().toLocaleDateString("es-ES"),e=new Date().getFullYear(),a=O.user;return{nombreEntidad:"Ministerio de Defensa",unidadOrganizacion:"Dirección de Tesorería",seccion:"Tesorería",nivelDescripcion:"Pieza documental compuesta",serieDocumental:"Expediente de ",codigoReferencia:`REF-${e}-`,soporte:"PAPEL",volumenMetrosLineales:null,responsableSeccion:"Jefe de Tesorería",inventarioElaboradoPor:a==null?void 0:a.fullName,numeroAnioRemision:`${e}`,lugarFechaElaboracion:`Lima, ${d}`,vistoBuenoResponsable:"",observaciones:"",detalles:[]}}const n=g(Y()),r=g({id:null,numeroItem:null,numeroCaja:"",numeroTomoPaquete:"",numeroUnidadDocumental:"",fechaUnidadDocumental:null,alcanceContenido:"",informacionAdicional:"",cantidadFolios:null,observaciones:""});async function J(){const{valid:d}=await N.value.validate();if(!d){C("Por favor corrija los errores en el formulario");return}if(n.value.detalles.length===0){C("Debe agregar al menos un ítem al catálogo");return}try{B("Guardando catálogo...",0),await S.createCatalogoTransferencia(n.value)?(E("Catálogo de transferencia creado correctamente"),setTimeout(()=>{z.push({name:"catalogo-transferencia-list"})},1500)):C("No se pudo crear el catálogo de transferencia")}catch(e){console.error("Error al crear catálogo:",e),C("Error al crear el catálogo: "+e.message)}}function k(){p.value>=0?n.value.detalles[p.value]={...r.value}:n.value.detalles.push({...r.value}),R()}function K(d){p.value=d,r.value={...n.value.detalles[d]},V.value=!0}async function Q(d){await G({title:"Confirmar eliminación",message:"¿Está seguro de eliminar este detalle?",confirmText:"Eliminar",cancelText:"Cancelar",confirmColor:"error"})&&(n.value.detalles.splice(d,1),E("Detalle eliminado correctamente"))}function R(){V.value=!1,p.value=-1,X()}function W(){const d=new Date().getFullYear(),e=n.value.detalles.length+1;return{numeroItem:e,numeroCaja:`C-${e.toString().padStart(3,"0")}`,numeroTomoPaquete:`T-${e.toString().padStart(3,"0")}`,numeroUnidadDocumental:`UD-${d}-${e.toString().padStart(3,"0")}`,fechaUnidadDocumental:null,alcanceContenido:"",informacionAdicional:"",cantidadFolios:1,observaciones:""}}function X(){r.value=W()}function Z(d){if(!d)return"-";try{return typeof d=="string"?j(new Date(d),"dd/MM/yyyy"):j(d,"dd/MM/yyyy")}catch{return d}}function _(d,e){return d?d.length<=e?d:`${d.slice(0,e)}...`:""}return(d,e)=>(b(),x(ae,{fluid:""},{default:o(()=>[l(D,null,{default:o(()=>[l(U,{class:"d-flex justify-space-between"},{default:o(()=>[e[27]||(e[27]=t("span",null,"Crear Catálogo de Transferencia",-1)),l(m,{color:"error",variant:"outlined","prepend-icon":"mdi-arrow-left",to:{name:"catalogo-transferencia-list"},class:"ml-2"},{default:o(()=>e[26]||(e[26]=[c(" Cancelar ")])),_:1})]),_:1}),l(y,null,{default:o(()=>[l(M,{ref_key:"form",ref:N,onSubmit:I(J,["prevent"])},{default:o(()=>[l($,null,{default:o(()=>[l(u,{cols:"12",md:"6"},{default:o(()=>[l(i,{modelValue:n.value.nombreEntidad,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value.nombreEntidad=a),label:"Nombre Entidad",rules:[a=>!!a||"Nombre de entidad es requerido"],required:"",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(i,{modelValue:n.value.unidadOrganizacion,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.unidadOrganizacion=a),label:"Unidad de Organización",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(i,{modelValue:n.value.seccion,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.seccion=a),label:"Sección",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(i,{modelValue:n.value.nivelDescripcion,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.nivelDescripcion=a),label:"Nivel de Descripción",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(i,{modelValue:n.value.serieDocumental,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.serieDocumental=a),label:"Serie Documental",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(i,{modelValue:n.value.codigoReferencia,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.codigoReferencia=a),label:"Código de Referencia",required:"",rules:[a=>!!a||"Código de referencia es requerido"],variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(ie,{modelValue:n.value.soporte,"onUpdate:modelValue":e[6]||(e[6]=a=>n.value.soporte=a),items:H,label:"Soporte",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(i,{modelValue:n.value.volumenMetrosLineales,"onUpdate:modelValue":e[7]||(e[7]=a=>n.value.volumenMetrosLineales=a),label:"Volumen (metros lineales)",type:"number",step:"0.01",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(i,{modelValue:n.value.responsableSeccion,"onUpdate:modelValue":e[8]||(e[8]=a=>n.value.responsableSeccion=a),label:"Responsable de Sección",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(i,{modelValue:n.value.inventarioElaboradoPor,"onUpdate:modelValue":e[9]||(e[9]=a=>n.value.inventarioElaboradoPor=a),label:"Elaborado por",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(i,{modelValue:n.value.numeroAnioRemision,"onUpdate:modelValue":e[10]||(e[10]=a=>n.value.numeroAnioRemision=a),label:"Número/Año Remisión",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(i,{modelValue:n.value.lugarFechaElaboracion,"onUpdate:modelValue":e[11]||(e[11]=a=>n.value.lugarFechaElaboracion=a),label:"Lugar y fecha de elaboración",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(i,{modelValue:n.value.vistoBuenoResponsable,"onUpdate:modelValue":e[12]||(e[12]=a=>n.value.vistoBuenoResponsable=a),label:"Visto Bueno Responsable",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12"},{default:o(()=>[l(w,{modelValue:n.value.observaciones,"onUpdate:modelValue":e[13]||(e[13]=a=>n.value.observaciones=a),label:"Observaciones",variant:"outlined",rows:"3"},null,8,["modelValue"])]),_:1})]),_:1}),l(ne,{class:"my-6"}),e[33]||(e[33]=t("h3",{class:"text-h5 mb-4"},"Detalles del Catálogo",-1)),l(D,{variant:"outlined",class:"mb-4"},{default:o(()=>[l(U,{class:"d-flex align-center"},{default:o(()=>[e[29]||(e[29]=t("span",null,"Lista de Ítems",-1)),l(A),l(m,{color:"primary",variant:"text",size:"small","prepend-icon":"mdi-plus",onClick:e[14]||(e[14]=a=>V.value=!0)},{default:o(()=>e[28]||(e[28]=[c(" Añadir Ítem ")])),_:1})]),_:1}),l(y,null,{default:o(()=>[n.value.detalles.length>0?(b(),x(se,{key:0},{default:o(()=>[e[30]||(e[30]=t("thead",null,[t("tr",null,[t("th",null,"Nº Item"),t("th",null,"Nº Caja"),t("th",null,"Nº Tomo/Paquete"),t("th",null,"Nº Unidad Documental"),t("th",null,"Fecha"),t("th",null,"Contenido"),t("th",null,"Folios"),t("th",null,"Acciones")])],-1)),t("tbody",null,[(b(!0),P(te,null,ue(n.value.detalles,(a,T)=>(b(),P("tr",{key:T},[t("td",null,s(a.numeroItem),1),t("td",null,s(a.numeroCaja),1),t("td",null,s(a.numeroTomoPaquete),1),t("td",null,s(a.numeroUnidadDocumental),1),t("td",null,s(a.fechaUnidadDocumental?Z(a.fechaUnidadDocumental):"-"),1),t("td",null,s(a.alcanceContenido?_(a.alcanceContenido,30):"-"),1),t("td",null,s(a.cantidadFolios),1),t("td",null,[l(m,{icon:"mdi-pencil",size:"x-small",variant:"text",color:"primary",onClick:h=>K(T)},null,8,["onClick"]),l(m,{icon:"mdi-delete",size:"x-small",variant:"text",color:"error",onClick:h=>Q(T)},null,8,["onClick"])])]))),128))])]),_:1})):(b(),x(me,{key:1,type:"info",text:"No hay detalles agregados. Haga clic en 'Añadir Ítem' para agregar el primer detalle al catálogo.",variant:"tonal",class:"mt-2"}))]),_:1})]),_:1}),t("div",ce,[l(m,{color:"primary",type:"submit",size:"large",loading:F.value,"prepend-icon":"mdi-content-save"},{default:o(()=>e[31]||(e[31]=[c(" Guardar Catálogo ")])),_:1},8,["loading"]),l(m,{color:"secondary",variant:"outlined",size:"large",loading:F.value,to:{name:"catalogo-transferencia-list"}},{default:o(()=>e[32]||(e[32]=[c(" Cancelar ")])),_:1},8,["loading"])])]),_:1},512)]),_:1})]),_:1}),l(q,{modelValue:V.value,"onUpdate:modelValue":e[24]||(e[24]=a=>V.value=a),"max-width":"800px"},{default:o(()=>[l(D,null,{default:o(()=>[l(U,null,{default:o(()=>[c(s(p.value>=0?"Editar":"Añadir")+" Ítem ",1)]),_:1}),l(y,null,{default:o(()=>[l(M,{onSubmit:I(k,["prevent"])},{default:o(()=>[l($,null,{default:o(()=>[l(u,{cols:"12",md:"4"},{default:o(()=>[l(i,{modelValue:r.value.numeroItem,"onUpdate:modelValue":e[15]||(e[15]=a=>r.value.numeroItem=a),label:"Número de Item",type:"number",rules:[a=>!!a||"Número de item es requerido"],required:"",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",md:"4"},{default:o(()=>[l(i,{modelValue:r.value.numeroCaja,"onUpdate:modelValue":e[16]||(e[16]=a=>r.value.numeroCaja=a),label:"Número de Caja",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:o(()=>[l(i,{modelValue:r.value.numeroTomoPaquete,"onUpdate:modelValue":e[17]||(e[17]=a=>r.value.numeroTomoPaquete=a),label:"Número de Tomo/Paquete",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(i,{modelValue:r.value.numeroUnidadDocumental,"onUpdate:modelValue":e[18]||(e[18]=a=>r.value.numeroUnidadDocumental=a),label:"Número de Unidad Documental",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(i,{modelValue:r.value.fechaUnidadDocumental,"onUpdate:modelValue":e[19]||(e[19]=a=>r.value.fechaUnidadDocumental=a),label:"Fecha de Unidad Documental",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(w,{modelValue:r.value.alcanceContenido,"onUpdate:modelValue":e[20]||(e[20]=a=>r.value.alcanceContenido=a),label:"Alcance y Contenido",variant:"outlined",rows:"3"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(w,{modelValue:r.value.informacionAdicional,"onUpdate:modelValue":e[21]||(e[21]=a=>r.value.informacionAdicional=a),label:"Información Adicional",variant:"outlined",rows:"3"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(i,{modelValue:r.value.cantidadFolios,"onUpdate:modelValue":e[22]||(e[22]=a=>r.value.cantidadFolios=a),label:"Cantidad de Folios",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(w,{modelValue:r.value.observaciones,"onUpdate:modelValue":e[23]||(e[23]=a=>r.value.observaciones=a),label:"Observaciones",variant:"outlined",rows:"3"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(L,null,{default:o(()=>[l(A),l(m,{variant:"text",onClick:R},{default:o(()=>e[34]||(e[34]=[c(" Cancelar ")])),_:1}),l(m,{color:"primary",onClick:k},{default:o(()=>e[35]||(e[35]=[c(" Guardar ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(q,{modelValue:v(f).show,"onUpdate:modelValue":e[25]||(e[25]=a=>v(f).show=a),"max-width":"500px"},{default:o(()=>[l(D,null,{default:o(()=>[l(U,null,{default:o(()=>[t("span",fe,s(v(f).title),1)]),_:1}),l(y,null,{default:o(()=>[c(s(v(f).message),1)]),_:1}),l(L,null,{default:o(()=>[l(A),l(m,{color:"grey",variant:"text",onClick:v(f).onCancel},{default:o(()=>[c(s(v(f).cancelText),1)]),_:1},8,["onClick"]),l(m,{color:v(f).confirmColor,variant:"text",onClick:v(f).onConfirm},{default:o(()=>[c(s(v(f).confirmText),1)]),_:1},8,["color","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{xe as default};
