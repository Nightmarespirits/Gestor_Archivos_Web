import{_ as O,aw as Q,a as W,r as n,o as X,k as Y,e as a,w as o,f as y,ao as $,I as Z,b as h,d as k,y as ee,h as d,j as x,C as m,H as p,c as D,v as T,g as q,aq as B,av as F,l as _,G as g}from"./index-DTzO7a71.js";import{u as le}from"./users-Dkic-ruu.js";import{_ as U}from"./PermissionButton-DANkCNxj.js";import{V as w,a as s}from"./VRow-DteDp9R7.js";import{V as ae}from"./VDataTable-BAdSe95_.js";import{V as N}from"./VChip-Bftqh3Dm.js";import{V as z}from"./VForm-Cr0IhdhJ.js";import{V as G}from"./VSelect-DrkOLv1H.js";import{V as oe}from"./VSwitch-DBlCe_KO.js";import"./VTable-Dw3FHTEb.js";import"./filter-C-DwuyMR.js";const te={__name:"index",setup(re){const u=le();Q();const E=h();W();const I=n(null),S=n(null),C=n(""),V=n(!1),b=n(!1),v=n([]),i=n({username:"",fullName:"",email:"",password:"",roleId:null}),r=n({id:null,username:"",fullName:"",email:"",status:!0,roleId:null}),c=n({show:!1,text:"",color:"success",timeout:3e3}),M=[{title:"ID",key:"id",sortable:!0},{title:"Usuario",key:"username",sortable:!0},{title:"Nombre Completo",key:"fullName",sortable:!0},{title:"Correo Electrónico",key:"email",sortable:!0},{title:"Rol",key:"role",sortable:!1},{title:"Estado",key:"status",sortable:!0},{title:"Fecha Creación",key:"createdAt",sortable:!0},{title:"Acciones",key:"actions",sortable:!1,align:"end"}];X(async()=>{try{await j(),await u.fetchUsers()}catch(t){f(`Error al cargar datos: ${t.message}`,"error")}});function P(t){switch(t){case"ADMIN":return"primary";case"Usuario":return"info";default:return"grey"}}async function j(){try{console.log("Cargando roles desde store..."),v.value=await u.fetchRoles(),console.log("Roles cargados:",v.value)}catch(t){console.error("Error al cargar roles:",t),v.value=[]}}function H(){E.push("/users/create")}function L(t){E.push(`/users/${t.id}/edit`)}async function R(){try{const{valid:t}=await I.value.validate();if(!t)return;await u.createUser(i.value),V.value=!1,f("Usuario creado exitosamente","success")}catch(t){f(`Error al crear usuario: ${t.message}`,"error")}}async function A(){try{const{valid:t}=await S.value.validate();if(!t)return;await u.updateUser(r.value.id,{fullName:r.value.fullName,email:r.value.email,status:r.value.status,roleId:r.value.roleId}),b.value=!1,f("Usuario actualizado exitosamente","success")}catch(t){f(`Error al actualizar usuario: ${t.message}`,"error")}}async function J(t){try{await u.updateUser(t.id,{fullName:t.fullName,email:t.email,status:!t.status,roleId:t.role.id}),f(`Usuario ${t.status?"desactivado":"activado"} exitosamente`,"success")}catch(l){f(`Error al cambiar estado del usuario: ${l.message}`,"error")}}function f(t,l="success",e=3e3){c.value={show:!0,text:t,color:l,timeout:e}}return(t,l)=>(k(),Y("div",null,[a(w,{class:"mb-4"},{default:o(()=>[a(s,{cols:"8"},{default:o(()=>l[17]||(l[17]=[ee("h1",{class:"text-h4"},"Gestión de Usuarios",-1)])),_:1}),a(s,{cols:"4",class:"d-flex justify-end"},{default:o(()=>[a(U,{permissions:["USER_CREATE"],color:"primary",prependIcon:"mdi-account-plus",onClick:H},{default:o(()=>l[18]||(l[18]=[d(" Nuevo Usuario ")])),_:1})]),_:1})]),_:1}),a(y,null,{default:o(()=>[a(x,null,{default:o(()=>[a(m,{modelValue:C.value,"onUpdate:modelValue":l[0]||(l[0]=e=>C.value=e),"prepend-inner-icon":"mdi-magnify",label:"Buscar usuario","single-line":"","hide-details":"",clearable:"",variant:"outlined",density:"compact",class:"mb-4"},null,8,["modelValue"]),a(ae,{headers:M,items:p(u).users,search:C.value,loading:p(u).loading,"items-per-page":10,class:"elevation-1"},{"item.status":o(({item:e})=>[a(N,{color:e.status?"success":"error",text:e.status?"Activo":"Inactivo",size:"small"},null,8,["color","text"])]),"item.role":o(({item:e})=>[e.role?(k(),D(N,{key:0,color:P(e.role.name),size:"small"},{default:o(()=>[d(T(e.role.name),1)]),_:2},1032,["color"])):(k(),D(N,{key:1,color:"grey",size:"small"},{default:o(()=>l[19]||(l[19]=[d(" Sin rol ")])),_:1}))]),"item.actions":o(({item:e})=>[a(U,{permissions:["USER_UPDATE"],prependIcon:"mdi-pencil",iconButton:!0,color:"primary",onClick:K=>L(e),disabled:p(u).loading,tooltip:"Editar",variant:"plain"},null,8,["onClick","disabled"]),a(U,{permissions:["USER_UPDATE"],prependIcon:e.status?"mdi-account-cancel":"mdi-account-check",iconButton:!0,color:e.status?"error":"success",onClick:K=>J(e),disabled:p(u).loading,tooltip:e.status?"Desactivar":"Activar",variant:"plain"},null,8,["prependIcon","color","onClick","disabled","tooltip"])]),_:1},8,["items","search","loading"])]),_:1})]),_:1}),a($,{modelValue:V.value,"onUpdate:modelValue":l[7]||(l[7]=e=>V.value=e),"max-width":"600px"},{default:o(()=>[a(y,null,{default:o(()=>[a(q,{class:"text-h5"},{default:o(()=>l[20]||(l[20]=[d("Crear Nuevo Usuario")])),_:1}),a(x,null,{default:o(()=>[a(z,{ref_key:"createForm",ref:I,onSubmit:B(R,["prevent"])},{default:o(()=>[a(w,null,{default:o(()=>[a(s,{cols:"12"},{default:o(()=>[a(m,{modelValue:i.value.username,"onUpdate:modelValue":l[1]||(l[1]=e=>i.value.username=e),label:"Nombre de Usuario",rules:[e=>!!e||"Nombre de usuario es obligatorio"],required:""},null,8,["modelValue","rules"])]),_:1}),a(s,{cols:"12"},{default:o(()=>[a(m,{modelValue:i.value.fullName,"onUpdate:modelValue":l[2]||(l[2]=e=>i.value.fullName=e),label:"Nombre Completo",rules:[e=>!!e||"Nombre completo es obligatorio"],required:""},null,8,["modelValue","rules"])]),_:1}),a(s,{cols:"12"},{default:o(()=>[a(m,{modelValue:i.value.email,"onUpdate:modelValue":l[3]||(l[3]=e=>i.value.email=e),label:"Correo Electrónico",type:"email",rules:[e=>!!e||"Correo electrónico es obligatorio",e=>/.+@.+\..+/.test(e)||"Correo electrónico debe ser válido"],required:""},null,8,["modelValue","rules"])]),_:1}),a(s,{cols:"12"},{default:o(()=>[a(m,{modelValue:i.value.password,"onUpdate:modelValue":l[4]||(l[4]=e=>i.value.password=e),label:"Contraseña",type:"password",rules:[e=>!!e||"Contraseña es obligatoria",e=>e.length>=6||"La contraseña debe tener al menos 6 caracteres"],required:""},null,8,["modelValue","rules"])]),_:1}),a(s,{cols:"12"},{default:o(()=>[a(G,{modelValue:i.value.roleId,"onUpdate:modelValue":l[5]||(l[5]=e=>i.value.roleId=e),items:v.value,"item-title":"name","item-value":"id",label:"Rol",rules:[e=>!!e||"Rol es obligatorio"],required:""},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),a(F,null,{default:o(()=>[a(_),a(g,{color:"error",text:"",onClick:l[6]||(l[6]=e=>V.value=!1)},{default:o(()=>l[21]||(l[21]=[d("Cancelar")])),_:1}),a(U,{permissions:["USER_CREATE"],color:"primary",text:"",onClick:R,loading:p(u).loading},{default:o(()=>l[22]||(l[22]=[d(" Guardar ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a($,{modelValue:b.value,"onUpdate:modelValue":l[14]||(l[14]=e=>b.value=e),"max-width":"600px"},{default:o(()=>[a(y,null,{default:o(()=>[a(q,{class:"text-h5"},{default:o(()=>l[23]||(l[23]=[d("Editar Usuario")])),_:1}),a(x,null,{default:o(()=>[a(z,{ref_key:"editForm",ref:S,onSubmit:B(A,["prevent"])},{default:o(()=>[a(w,null,{default:o(()=>[a(s,{cols:"12"},{default:o(()=>[a(m,{modelValue:r.value.username,"onUpdate:modelValue":l[8]||(l[8]=e=>r.value.username=e),label:"Nombre de Usuario",disabled:""},null,8,["modelValue"])]),_:1}),a(s,{cols:"12"},{default:o(()=>[a(m,{modelValue:r.value.fullName,"onUpdate:modelValue":l[9]||(l[9]=e=>r.value.fullName=e),label:"Nombre Completo",rules:[e=>!!e||"Nombre completo es obligatorio"],required:""},null,8,["modelValue","rules"])]),_:1}),a(s,{cols:"12"},{default:o(()=>[a(m,{modelValue:r.value.email,"onUpdate:modelValue":l[10]||(l[10]=e=>r.value.email=e),label:"Correo Electrónico",type:"email",rules:[e=>!!e||"Correo electrónico es obligatorio",e=>/.+@.+\..+/.test(e)||"Correo electrónico debe ser válido"],required:""},null,8,["modelValue","rules"])]),_:1}),a(s,{cols:"12"},{default:o(()=>[a(G,{modelValue:r.value.roleId,"onUpdate:modelValue":l[11]||(l[11]=e=>r.value.roleId=e),items:v.value,"item-title":"name","item-value":"id",label:"Rol",rules:[e=>!!e||"Rol es obligatorio"],required:""},null,8,["modelValue","items","rules"])]),_:1}),a(s,{cols:"12"},{default:o(()=>[a(oe,{modelValue:r.value.status,"onUpdate:modelValue":l[12]||(l[12]=e=>r.value.status=e),color:"success",label:"Estado: Activo/Inactivo","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1}),a(F,null,{default:o(()=>[a(_),a(g,{color:"error",text:"",onClick:l[13]||(l[13]=e=>b.value=!1)},{default:o(()=>l[24]||(l[24]=[d("Cancelar")])),_:1}),a(g,{color:"primary",text:"",onClick:A,loading:p(u).loading},{default:o(()=>l[25]||(l[25]=[d(" Actualizar ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Z,{modelValue:c.value.show,"onUpdate:modelValue":l[16]||(l[16]=e=>c.value.show=e),color:c.value.color,timeout:c.value.timeout},{actions:o(()=>[a(g,{variant:"text",onClick:l[15]||(l[15]=e=>c.value.show=!1)},{default:o(()=>l[26]||(l[26]=[d(" Cerrar ")])),_:1})]),default:o(()=>[d(T(c.value.text)+" ",1)]),_:1},8,["modelValue","color","timeout"])]))}},be=O(te,[["__scopeId","data-v-30da7358"]]);export{be as default};
